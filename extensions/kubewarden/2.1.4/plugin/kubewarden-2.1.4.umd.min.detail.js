(("undefined"!==typeof self?self:this)["webpackJsonpkubewarden_2_1_4"]=("undefined"!==typeof self?self:this)["webpackJsonpkubewarden_2_1_4"]||[]).push([[2],{"00ce":function(e,t,r){"use strict";var a=function(){var e=this,t=e._self._c;return e.$fetchState.pending||e.refreshingCharts?t("Loading",{attrs:{mode:"relative"}}):t("div",[e.showChecklist?t("TraceChecklist",{attrs:{"controller-app":e.controllerApp,"controller-chart":e.controllerChart,"tracing-configuration":e.tracingConfiguration,"jaeger-query-svc":e.jaegerQuerySvc,"open-tel-svc":e.openTelSvc,"outdated-telemetry-spec":e.outdatedTelemetrySpec,"unsupported-telemetry-spec":e.unsupportedTelemetrySpec,"incomplete-telemetry-spec":e.incompleteTelemetrySpec}}):!e.showChecklist&&e.emptyPolicies?t("Banner",{attrs:{color:"error",label:e.t("kubewarden.tracing.noRelatedPolicies")}}):e.showTable?t("SortableTable",{attrs:{rows:e.filteredValidations,headers:e.TRACE_HEADERS,"table-actions":!1,"row-actions":!1,"key-field":"id","default-sort-by":"startTime","sub-expandable":!0,"sub-expand-column":!0,"sub-rows":!0,paging:!0,"rows-per-page":e.rowsPerPage},scopedSlots:e._u([{key:"col:mode",fn:function({row:r}){return[t("td",[t("BadgeState",{staticClass:"text-capitalize",attrs:{label:r.mode,color:e.modeColor(r.mode)}})],1)]}},{key:"col:name",fn:function({row:r}){return[t("td",{staticClass:"text-bold"},[e._v(" "+e._s(r.name)+" ")])]}},{key:"col:namespace",fn:function({row:r}){return[t("td",[e._v(" "+e._s(r.namespace?r.namespace:"-")+" ")])]}},{key:"col:startTime",fn:function({row:r}){return[t("td",[e._v(" "+e._s(e.formatTime(r.startTime))+" ")])]}},{key:"col:duration",fn:function({row:r}){return[t("td",[e._v(" "+e._s(e.duration(r.duration))+" ")])]}},{key:"sub-row",fn:function({row:r,fullColspan:a}){return[t("td",{staticClass:"sub-row",attrs:{colspan:a}},[t("div",{staticClass:"details"},[t("section",{staticClass:"col"},[t("div",{staticClass:"title"},[e._v(" Response Message ")]),t("span",{staticClass:"text-info text-capitalize"},[e._v(" "+e._s(r.responseMessage?r.responseMessage:"-")+" ")])]),t("section",{staticClass:"col"},[t("div",{staticClass:"title"},[e._v(" Response Code ")]),t("span",{staticClass:"text-info"},[e._v(" "+e._s(r.responseCode?r.responseCode:"-")+" ")])]),t("section",{staticClass:"col"},[t("div",{staticClass:"title"},[e._v(" Mutated ")]),t("span",{staticClass:"text-info"},[e._v(" "+e._s(r.mutated)+" ")])])])])]}}])}):t("Banner",{attrs:{color:"warning",label:e.t(e.emptyTracesLabel)}})],1)},i=[],o=r("9ce4"),n=r("330a"),l=r.n(n),s=r("d1f7"),c=r.n(s),d=r("050d"),u=r.n(d),p=r("be6d"),v=r.n(p),h=r("907c"),m=r("4ac6"),f=r("2359"),b=r("a8b9"),g=r("f17a"),y=r("6418"),k=r("15ca"),w=r("0fb1"),_=r("5191"),S=r("90cd"),C=r("5136"),T=r("7d99"),O=r.n(T),A=r("37ef"),R=r.n(A),E=r("e4c5"),j=r.n(E);u.a.extend(j.a);const P=1e3,x=1e3*P,M=60*x,N=60*M,D=24*N,L=[{unit:"d",microseconds:D,ofPrevious:24},{unit:"h",microseconds:N,ofPrevious:60},{unit:"m",microseconds:M,ofPrevious:60},{unit:"s",microseconds:x,ofPrevious:1e3},{unit:"ms",microseconds:P,ofPrevious:1e3},{unit:"Î¼s",microseconds:1,ofPrevious:1e3}];function $(e){const[t,r]=O()(L,({microseconds:t},r)=>r<L.length-1&&t>e);if(1e3===t.ofPrevious)return`${R()(e/t.microseconds,2)}${t.unit}`;const a=Math.floor(e/t.microseconds),i=`${a}${t.unit}`,o=Math.round(e/r.microseconds%t.ofPrevious),n=`${o}${r.unit}`;return 0===o?i:`${i} ${n}`}var I=function(){var e=this,t=e._self._c;return t("div",[t("p",{staticClass:"checklist__description mb-20",attrs:{"data-testid":"kw-tracing-checklist-description"}},[e._v(" "+e._s(e.t("kubewarden.tracing.description"))+" ")]),t("div",{staticClass:"checklist__prereq mb-20"},[t("h2",[e._v(e._s(e.t("kubewarden.tracing.prerequisites.label")))]),t("p",[e._v(e._s(e.t("kubewarden.tracing.prerequisites.description")))])]),t("Banner",{attrs:{color:"warning",label:e.t("kubewarden.tracing.prerequisites.warning")}}),t("div",{staticClass:"checklist__container mt-20 mb-20"},[t("div",{staticClass:"checklist__step mt-20 mb-20",attrs:{"data-testid":"kw-tracing-checklist-step-open-tel"}},[t("i",{staticClass:"icon mr-10",class:e.badgeIcon(e.openTelSvc)}),t("p",{directives:[{name:"clean-html",rawName:"v-clean-html",value:e.t("kubewarden.tracing.openTelemetry",{},!0),expression:"t('kubewarden.tracing.openTelemetry', {}, true)"}]})]),t("div",{staticClass:"checklist__step mb-20",attrs:{"data-testid":"kw-tracing-checklist-step-jaeger"}},[t("i",{staticClass:"icon mr-10",class:e.badgeIcon(e.jaegerQuerySvc)}),t("p",{directives:[{name:"clean-html",rawName:"v-clean-html",value:e.t("kubewarden.tracing.jaeger",{},!0),expression:"t('kubewarden.tracing.jaeger', {}, true)"}],attrs:{p:""}})]),t("div",[e.outdatedTelemetrySpec?t("Banner",{attrs:{color:"error",label:e.t("kubewarden.tracing.prerequisites.outdated")}}):e._e(),e.unsupportedTelemetrySpec?t("Banner",{attrs:{color:"error",label:e.t("kubewarden.tracing.prerequisites.unsupported")}}):e._e(),e.incompleteTelemetrySpec?t("Banner",{attrs:{color:"error",label:e.t("kubewarden.tracing.prerequisites.incomplete")}}):e._e()],1),t("div",{staticClass:"checklist__step mb-20",attrs:{"data-testid":"kw-tracing-checklist-step-config"}},[t("i",{staticClass:"icon mr-10",class:e.badgeIcon(e.tracingEnabled)}),t("div",{staticClass:"checklist__config"},[t("p",{directives:[{name:"clean-html",rawName:"v-clean-html",value:e.t("kubewarden.tracing.config.label",{},!0),expression:"t('kubewarden.tracing.config.label', {}, true)"}]}),t("button",{directives:[{name:"clean-tooltip",rawName:"v-clean-tooltip",value:e.controllerLinkTooltip,expression:"controllerLinkTooltip"}],staticClass:"btn role-primary ml-10",attrs:{"data-testid":"kw-tracing-checklist-step-config-button",disabled:e.controllerLinkDisabled},on:{click:e.controllerAppRoute}},[e._v(" "+e._s(e.t("kubewarden.tracing.config.link"))+" ")])])])])],1)},q=[],B=r("da25"),G={props:{controllerApp:{type:Object,default:null},controllerChart:{type:Object,default:null},tracingConfiguration:{type:Object,default:null},jaegerQuerySvc:{type:Object,default:null},openTelSvc:{type:Object,default:null},outdatedTelemetrySpec:{type:Boolean,default:!1},unsupportedTelemetrySpec:{type:Boolean,default:!1},incompleteTelemetrySpec:{type:Boolean,default:!1}},components:{Banner:y["a"]},computed:{...Object(o["b"])(["currentCluster"]),controllerLinkTooltip(){return this.openTelSvc&&this.jaegerQuerySvc?this.controllerApp&&this.controllerChart?null:this.t("kubewarden.monitoring.prerequisites.tooltips.chartError",{chart:"Kubewarden Controller"},!0):this.t("kubewarden.monitoring.prerequisites.tooltips.prerequisites")},controllerLinkDisabled(){return!this.openTelSvc||!this.jaegerQuerySvc||!this.controllerApp||!this.controllerChart},tracingEnabled(){return this.tracingConfiguration?this.tracingConfiguration.enabled:null}},methods:{badgeIcon(e){return{"icon-dot-open":!e,"icon-checkmark":e,"text-success":e}},controllerAppRoute(){if(this.controllerApp){var e,t,r,a,i,o,n;const l=null===(e=this.controllerApp.spec)||void 0===e||null===(e=e.chart)||void 0===e?void 0:e.metadata,s={[B["g"]]:null===l||void 0===l||null===(t=l.annotations)||void 0===t?void 0:t[m["c"].NAMESPACE],[B["f"]]:null===l||void 0===l||null===(r=l.annotations)||void 0===r?void 0:r[m["c"].RELEASE_NAME],[B["o"]]:null===l||void 0===l||null===(a=l.annotations)||void 0===a?void 0:a["catalog.cattle.io/upstream-version"],[B["i"]]:null===l||void 0===l||null===(i=l.annotations)||void 0===i?void 0:i[m["c"].SOURCE_REPO_NAME],[B["j"]]:null===l||void 0===l||null===(o=l.annotations)||void 0===o?void 0:o[m["c"].SOURCE_REPO_TYPE],[B["d"]]:null===l||void 0===l?void 0:l.name};this.$router.push({name:"c-cluster-apps-charts-install",params:{cluster:(null===(n=this.currentCluster)||void 0===n?void 0:n.id)||"_"},query:s})}}}},V=G,U=(r("7d12"),r("d802")),Y=Object(U["a"])(V,I,q,!1,null,"f489d41c",null),z=Y.exports;u.a.extend(v.a);var H={props:{resource:{type:String,default:()=>""},relatedPolicies:{type:Array,default:()=>[]},policy:{type:Object,default:()=>{}}},components:{BadgeState:g["a"],Banner:y["a"],Loading:k["a"],SortableTable:w["a"],TraceChecklist:z},mixins:[f["a"]],async fetch(){const e=[h["a"].APP,h["a"].CLUSTER_REPO,h["z"]],t=[];for(const r of e)this.$store.getters["cluster/canList"](r)&&t.push(this.$fetchType(r));if(await Object(b["a"])(t),this.jaegerQuerySvc){const e={store:this.$store,queryService:this.jaegerQuerySvc,resource:this.resource,relatedPolicies:null,policy:null};this.resource===S["f"].POLICY_SERVER?e.relatedPolicies=this.relatedPolicies:e.policy=this.policy,this.specificValidations=await Object(C["b"])(e)}this.controllerApp&&await this.controllerApp.fetchValues(!0)},data(){return{MODE_MAP:S["o"],TRACE_HEADERS:_["h"],OPERATION_MAP:S["p"],specificValidations:null,outdatedTelemetrySpec:!1,unsupportedTelemetrySpec:!1,incompleteTelemetrySpec:!1}},computed:{...Object(o["b"])(["currentCluster"]),...Object(o["b"])({charts:"catalog/charts",refreshingCharts:"kubewarden/refreshingCharts"}),allApps(){return this.$store.getters["cluster/all"](h["a"].APP)},allServices(){return this.$store.getters["cluster/all"](h["z"])},controllerApp(){var e;return null===(e=this.allApps)||void 0===e?void 0:e.find(e=>{var t;return(null===e||void 0===e||null===(t=e.spec)||void 0===t||null===(t=t.chart)||void 0===t||null===(t=t.metadata)||void 0===t?void 0:t.name)===S["h"].CONTROLLER})},controllerChart(){var e;return null===(e=this.charts)||void 0===e?void 0:e.find(e=>e.chartName===S["h"].CONTROLLER)},groupField(){return this.isPolicyServer?"policy_id":null},isPolicyServer(){return this.resource===S["f"].POLICY_SERVER},emptyPolicies(){return this.resource===S["f"].POLICY_SERVER?l()(this.relatedPolicies):l()(this.policy)},emptyTraces(){return l()(this.filteredValidations)},emptyTracesLabel(){return this.resource===S["f"].POLICY_SERVER?"kubewarden.tracing.noRelatedTraces":"kubewarden.tracing.noTraces"},rowsPerPage(){return this.isPolicyServer?40:20},tracingConfiguration(){var e,t;if(!this.controllerApp)return null;const r=null===(e=this.controllerApp)||void 0===e||null===(e=e.spec)||void 0===e||null===(e=e.chart)||void 0===e||null===(e=e.metadata)||void 0===e?void 0:e.version,a=null===(t=this.controllerApp)||void 0===t||null===(t=t.values)||void 0===t?void 0:t.telemetry;if(c.a.gte(r,"4.0.0-0")){var i,o;const e=void 0===(null===a||void 0===a?void 0:a.tracing)||"boolean"===typeof(null===a||void 0===a?void 0:a.tracing),t=!(null===a||void 0===a||null===(i=a.sidecar)||void 0===i||null===(i=i.tracing)||void 0===i||null===(i=i.jaeger)||void 0===i||!i.endpoint);return"custom"===(null===a||void 0===a?void 0:a.mode)?(this.unsupportedTelemetrySpec=!0,null):e?!0!==(null===a||void 0===a?void 0:a.tracing)||t?!0!==(null===a||void 0===a?void 0:a.tracing)?null:null===a||void 0===a||null===(o=a.sidecar)||void 0===o?void 0:o.tracing:(this.incompleteTelemetrySpec=!0,null):(this.outdatedTelemetrySpec=!0,null)}var n;return null===a||void 0===a||null===(n=a.tracing)||void 0===n?void 0:n.enabled},jaegerServices(){var e;return null===(e=this.allServices)||void 0===e?void 0:e.filter(e=>{var t;return"jaeger"===(null===e||void 0===e||null===(t=e.metadata)||void 0===t||null===(t=t.labels)||void 0===t?void 0:t["app.kubernetes.io/part-of"])})},jaegerQuerySvc(){return l()(this.jaegerServices)?null:this.jaegerServices.find(e=>{var t;const r=null===e||void 0===e||null===(t=e.spec)||void 0===t?void 0:t.ports;if(r.length)return r.find(e=>16685===e.port||16686===e.port)})},openTelemetryServices(){var e;return null===(e=this.allServices)||void 0===e?void 0:e.filter(e=>{var t;return"opentelemetry-operator"===(null===e||void 0===e||null===(t=e.metadata)||void 0===t||null===(t=t.labels)||void 0===t?void 0:t[m["h"].MANAGED_NAME])})},openTelSvc(){return l()(this.openTelemetryServices)?null:this.openTelemetryServices.find(e=>{var t;const r=null===e||void 0===e||null===(t=e.spec)||void 0===t?void 0:t.ports;if(r.length)return r.find(e=>8080===e.port)})},showChecklist(){return!this.openTelSvc||!this.jaegerQuerySvc||!this.tracingConfiguration},showTable(){return!this.emptyPolicies&&!this.showChecklist&&!this.emptyTraces},filteredValidations(){return l()(this.specificValidations)?[]:this.specificValidations.flatMap(e=>{var t;return(null===(t=this.currentCluster)||void 0===t?void 0:t.id)===e.cluster?e.traces:[]})}},methods:{modeColor(e){return this.MODE_MAP[e]},opColor(e){return this.OPERATION_MAP[e]},formatTime(e){return u()(e/1e3)},duration(e){return $(e)}}},Q=H,F=(r("44da"),Object(U["a"])(Q,a,i,!1,null,"7b599723",null));t["a"]=F.exports},"284d":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e._self._c;return e.$fetchState.pending?t("Loading"):t("div",[e.policyGauges?[t("div",{staticClass:"row"},[[t("div",{staticClass:"col span-6"},[t("h3",{attrs:{"data-testid":"kw-ps-detail-status-title"}},[e._v(" "+e._s(e.t("kubewarden.policyServer.policyGauge.byStatus"))+" ")]),t("div",{staticClass:"gauges mb-20"},e._l(e.policyGauges,(function(r,a){return t("CountGauge",{key:a,attrs:{total:e.relatedPoliciesTotal,useful:r.count||0,graphical:!1,"primary-color-var":"--sizzle-"+r.color,name:a}})})),1)])],e.emptyTraces?e._e():[t("div",{staticClass:"col span-6"},[t("h3",[e._v(" "+e._s(e.t("kubewarden.policyServer.policyGauge.traces"))+" ")]),t("div",{staticClass:"gauges mb-20"},e._l(e.tracesGauges,(function(r,a){return t("CountGauge",{key:a,attrs:{useful:r.count||0,total:e.traceGaugeTotals,graphical:!1,"primary-color-var":"--sizzle-"+r.color,name:a}})})),1)])]],2)]:e._e(),t("ResourceTabs",{attrs:{mode:e.mode},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},[t("Tab",{attrs:{name:"related-policies",label:"Policies",weight:99},scopedSlots:e._u([{key:"default",fn:function(){return[t("ResourceTable",{attrs:{rows:e.relatedPolicies||[],headers:e.RELATED_HEADERS,groupable:!0,"group-by":e.groupPreference,"table-actions":!0,"data-testid":"kw-ps-detail-related-policies-list"},scopedSlots:e._u([{key:"col:operation",fn:function({row:r}){return[t("td",[t("BadgeState",{attrs:{"data-testid":`kw-ps-detail-${r.id}-state`,label:r.operation,color:e.color(r.operation)}})],1)]}}])})]},proxy:!0}])}),t("Tab",{staticClass:"relative",attrs:{name:"policy-tracing",label:"Tracing",weight:98}},[t("TraceTable",{attrs:{resource:e.resource,"related-policies":e.relatedPolicies}})],1),t("Tab",{staticClass:"relative",attrs:{name:"policy-metrics",label:"Metrics",weight:97},scopedSlots:e._u([{key:"default",fn:function(r){return[t("MetricsTab",{attrs:{resource:e.resource,"policy-server-obj":e.value,active:r.active}})]}}])})],1)],2)},i=[],o=r("9ce4"),n=r("330a"),l=r.n(n),s=r("da25"),c=r("a8b9"),d=r("305c"),u=r("5000"),p=r("74c2"),v=r("15ca"),h=r("c422"),m=r("126f"),f=r("38de"),b=r("5191"),g=r("3f46"),y=r("00ce"),k={name:"PolicyServer",components:{CountGauge:p["a"],Loading:v["a"],MetricsTab:g["a"],ResourceTabs:h["a"],ResourceTable:m["a"],Tab:f["a"],TraceTable:y["a"]},mixins:[d["a"]],props:{mode:{type:String,default:s["r"]},resource:{type:String,default:null},value:{type:Object,required:!0}},async fetch(){const e=await Object(c["a"])({relatedPolicies:this.value.allRelatedPolicies(),policyGauges:this.value.policyGauges()}),t=(e,t)=>{l()(t)||(this[e]=t)};t("relatedPolicies",e.relatedPolicies),t("policyGauges",e.policyGauges)},data(){return{RELATED_HEADERS:b["f"],policyGauges:null,relatedPolicies:null,reloadRequired:!1}},computed:{...Object(o["b"])(["currentCluster"]),...Object(o["b"])({policyTraces:"kubewarden/policyTraces"}),_group:Object(u["m"])(u["e"]),filteredTraces(){return l()(this.policyTraces)?null:this.policyTraces.filter(e=>{var t;if((null===(t=this.currentCluster)||void 0===t?void 0:t.id)===e.cluster)return e})},emptyTraces(){return l()(this.filteredTraces)},groupPreference(){const e="namespace"===this._group?"kind":null;return e},relatedPoliciesTotal(){return l()(this.relatedPolicies)?0:this.relatedPolicies.length},tracesGauges(){return this.emptyTraces?null:this.value.tracesGauges(this.filteredTraces)},traceGaugeTotals(){var e;return this.emptyTraces?0:null===(e=this.filteredTraces)||void 0===e?void 0:e.flatMap(e=>e.traces).length}},methods:{hasNamespaceSelector(e){return e.namespaceSelector}}},w=k,_=(r("2a13"),r("d802")),S=Object(_["a"])(w,a,i,!1,null,"a88dafa8",null);t["default"]=S.exports},"2a13":function(e,t,r){"use strict";r("b7b9")},"3f46":function(e,t,r){"use strict";var a=function(){var e=this,t=e._self._c;return e.$fetchState.pending?t("Loading",{attrs:{mode:"relative"}}):t("div",[e.showChecklist?t("MetricsChecklist",{attrs:{"cattle-dashboard-ns":e.cattleDashboardNs,"conflicting-grafana-dashboards":e.conflictingGrafanaDashboards,"controller-app":e.controllerApp,"controller-chart":e.controllerChart,"kubewarden-service-monitor":e.kubewardenServiceMonitor,"kubewarden-dashboards":e.kubewardenGrafanaDashboards,"metrics-configuration":e.metricsConfiguration,"monitoring-app":e.monitoringApp,"monitoring-chart":e.monitoringChart,"open-tel-svc":e.openTelSvc,"policy-obj":e.policyObj,"policy-server-obj":e.policyServerObj,"outdated-telemetry-spec":e.outdatedTelemetrySpec,"unsupported-telemetry-spec":e.unsupportedTelemetrySpec},on:{updateServiceMonitors:e.updateServiceMonitors}}):e._e(),e.showChecklist?e._e():[e.monitoringApp&&!e.metricsProxy?t("Banner",{attrs:{color:"error",label:e.t("kubewarden.monitoring.warning.noProxy")}}):e._e(),e.metricsProxy&&e.active?t("DashboardMetrics",{attrs:{"data-testid":"kw-ps-metrics-dashboard","detail-url":e.metricsProxy,"summary-url":e.metricsProxy,vars:{policy_name:e.policyName},"graph-height":"825px"}}):e._e()]],2)},i=[],o=r("9ce4"),n=r("330a"),l=r.n(n),s=r("44db"),c=r.n(s),d=r("d1f7"),u=r.n(d),p=r("907c"),v=r("4ac6"),h=r("b45b"),m=r("f390"),f=r("a8b9"),b=r("2359"),g=r("c389"),y=r("15ca"),k=r("6418"),w=r("90cd"),_=r("e9a3"),S=r("541d");async function C(e){const{store:t,type:r}=e;try{const e=await T(t);if(!l()(e)){const t=`/api/v1/namespaces/${e.metadata.namespace}/services`,a=`/http:${e.metadata.name}:80/proxy`,i=`/d/${r}?orgId=1&kiosk`;return t+a+i}}catch(a){Object(_["a"])({error:a,store:t,type:"warning"})}return null}async function T(e){try{return await e.dispatch("cluster/find",{type:p["z"],id:"cattle-monitoring-system/rancher-monitoring-grafana"},{root:!0})}catch(t){Object(_["a"])({error:t,store:e,type:"warning"})}}async function O(e){try{return await e.dispatch("cluster/findMatching",{type:p["b"],selector:"kubewarden/part-of=cattle-kubewarden-system"})}catch(t){Object(_["a"])({error:t,store:e,type:"warning"})}}async function A(e){const{store:t,monitoringApp:a,controllerApp:i}=e;if(a&&i){const e=Object.values(w["n"]);for(const l of e){var o;const e=await r("cb8a")(`./${l}.json`),s=l+".json",c=await O(t);if(c&&(null===c||void 0===c||null===(o=c.metadata)||void 0===o?void 0:o.name)===l)return;const d={[w["m"].DASHBOARD]:l,[w["m"].PART_OF]:i.metadata.namespace,[w["m"].APP]:"rancher-monitoring-grafana",[w["m"].GRAFANA_DASHBOARD]:"1","app.kubernetes.io/instance":a.metadata.name},u={[w["e"].NAME]:a.metadata.name,[w["e"].NAMESPACE]:a.metadata.namespace},v=await t.dispatch("cluster/create",{type:p["b"],metadata:{annotations:u,labels:d,name:l,namespace:"cattle-dashboards"},data:{[s]:JSON.stringify(e)}});try{await v.save()}catch(n){Object(_["a"])({error:n,store:t})}}}}function R(e){const{policyObj:t,policyServerObj:r,allServiceMonitors:a}=e;if(!l()(a)){var i;const e=t?null===(i=t.spec)||void 0===i?void 0:i.policyServer:null===r||void 0===r?void 0:r.id;return null===a||void 0===a?void 0:a.find(t=>{var r;return(null===t||void 0===t||null===(r=t.spec)||void 0===r||null===(r=r.selector)||void 0===r||null===(r=r.matchLabels)||void 0===r?void 0:r["app"])==="kubewarden-policy-server-"+e})}}async function E(e){const{store:t,policyObj:r,policyServerObj:a,controllerNs:i,serviceMonitor:o}=e;if(t.getters["cluster/schemaFor"](p["m"].SERVICEMONITOR)){var n;const e=r?null===(n=r.spec)||void 0===n?void 0:n.policyServer:null===a||void 0===a?void 0:a.id,s={kind:"ServiceMonitor",type:p["m"].SERVICEMONITOR,metadata:{name:e,namespace:i},spec:{endpoints:[{interval:"10s",port:"metrics"}],namespaceSelector:{matchNames:[i]},selector:{matchLabels:{app:"kubewarden-policy-server-"+e}}}};if(!o){const e=await t.dispatch("cluster/create",s);try{await e.save()}catch(l){Object(_["a"])({error:l,store:t})}}}}var j=r("5136"),P=function(){var e=this,t=e._self._c;return t("div",{staticClass:"checklist__container"},[t("div",{staticClass:"checklist__prereq mb-20"},[t("h2",[e._v(e._s(e.t("kubewarden.monitoring.prerequisites.label")))]),t("p",[e._v(e._s(e.t("kubewarden.monitoring.prerequisites.description")))])]),t("Banner",{attrs:{color:"warning",label:e.t("kubewarden.monitoring.prerequisites.warning")}}),t("div",{staticClass:"mt-20 mb-20"},[t("div",{staticClass:"checklist__step mt-20 mb-20",attrs:{"data-testid":"kw-monitoring-checklist-step-open-tel"}},[t("i",{staticClass:"icon mr-10",class:e.badgeIcon(e.openTelSvc)}),t("p",{directives:[{name:"clean-html",rawName:"v-clean-html",value:e.t("kubewarden.tracing.openTelemetry",{},!0),expression:"t('kubewarden.tracing.openTelemetry', {}, true)"}]})]),t("div",{staticClass:"checklist__step mb-20",attrs:{"data-testid":"kw-monitoring-checklist-step-monitoring-app"}},[t("i",{staticClass:"icon mr-10",class:e.badgeIcon(e.monitoringApp)}),t("div",{staticClass:"checklist__config"},[t("p",{directives:[{name:"clean-html",rawName:"v-clean-html",value:e.t("kubewarden.monitoring.prerequisites.monitoringApp.label",{},!0),expression:"t('kubewarden.monitoring.prerequisites.monitoringApp.label', {}, true)"}],attrs:{p:""}}),e.monitoringApp?e._e():t("button",{directives:[{name:"clean-tooltip",rawName:"v-clean-tooltip",value:e.monitoringLinkTooltip,expression:"monitoringLinkTooltip"}],staticClass:"btn role-primary ml-10",attrs:{"data-testid":"kw-monitoring-checklist-step-config-button",disabled:!e.monitoringChart},on:{click:function(t){return e.monitoringAppRoute()}}},[e._v(" "+e._s(e.monitoringChartLink)+" ")])])]),t("div",{staticClass:"checklist__step mb-20",attrs:{"data-testid":"kw-monitoring-checklist-step-service-monitor-map"}},[t("i",{staticClass:"icon mr-10",class:e.badgeIcon(e.kubewardenServiceMonitor)}),t("div",{staticClass:"checklist__config"},[t("p",{directives:[{name:"clean-html",rawName:"v-clean-html",value:e.t("kubewarden.monitoring.prerequisites.serviceMonitor.label",{},!0),expression:"t('kubewarden.monitoring.prerequisites.serviceMonitor.label', {}, true)"}],attrs:{p:""}}),e.kubewardenServiceMonitor?e._e():t("AsyncButton",{directives:[{name:"clean-tooltip",rawName:"v-clean-tooltip",value:e.serviceMonitorsTooltip,expression:"serviceMonitorsTooltip"}],staticClass:"ml-10",attrs:{"data-testid":"kw-monitoring-checklist-step-service-monitor-button",mode:"serviceMonitor",disabled:e.serviceMonitorButtonDisabled},on:{click:e.addServiceMonitor}})],1)]),t("div",{staticClass:"checklist__step mb-20",attrs:{"data-testid":"kw-monitoring-checklist-step-config-map"}},[t("i",{staticClass:"icon mr-10",class:e.badgeIcon(e.hasKubewardenDashboards)}),t("div",{staticClass:"checklist__config"},[t("p",{directives:[{name:"clean-html",rawName:"v-clean-html",value:e.t("kubewarden.monitoring.prerequisites.configMap.label",{},!0),expression:"t('kubewarden.monitoring.prerequisites.configMap.label', {}, true)"}],attrs:{p:""}}),e.hasKubewardenDashboards?e._e():t("AsyncButton",{directives:[{name:"clean-tooltip",rawName:"v-clean-tooltip",value:e.dashboardsTooltip,expression:"dashboardsTooltip"}],staticClass:"ml-10",attrs:{"data-testid":"kw-monitoring-checklist-step-config-map-button",mode:"grafanaDashboard",disabled:e.dashboardButtonDisabled},on:{click:e.addDashboards}})],1)]),e.showConflictingDashboardsBanner?t("Banner",{attrs:{color:"error"}},[t("div",{staticClass:"conflicting-banner"},[t("p",[e._v(" "+e._s(e.t("kubewarden.monitoring.prerequisites.configMap.conflictingDashboardsBanner",{count:e.conflictingGrafanaDashboards.length},!0))+" ")]),e._l(e.conflictingGrafanaDashboards,(function(r){return t("n-link",{key:r.metadata.name,staticClass:"text-bold",attrs:{to:r.detailLocation}},[e._v(" "+e._s(r.metadata.name)+" ")])}))],2)]):e._e(),t("div",[e.outdatedTelemetrySpec?t("Banner",{attrs:{color:"error",label:e.t("kubewarden.monitoring.prerequisites.outdated")}}):e._e(),e.unsupportedTelemetrySpec?t("Banner",{attrs:{color:"error",label:e.t("kubewarden.monitoring.prerequisites.unsupported")}}):e._e()],1),t("div",{staticClass:"checklist__step mb-20",attrs:{"data-testid":"kw-monitoring-checklist-step-controller-config"}},[t("i",{staticClass:"icon mr-10",class:e.badgeIcon(e.metricsConfiguration)}),t("div",{staticClass:"checklist__config"},[t("p",{directives:[{name:"clean-html",rawName:"v-clean-html",value:e.t("kubewarden.monitoring.prerequisites.controllerConfig.label",{},!0),expression:"t('kubewarden.monitoring.prerequisites.controllerConfig.label', {}, true)"}],attrs:{p:""}}),e.metricsConfiguration?e._e():t("button",{directives:[{name:"clean-tooltip",rawName:"v-clean-tooltip",value:e.controllerLinkTooltip,expression:"controllerLinkTooltip"}],staticClass:"btn role-primary ml-10",attrs:{"data-testid":"kw-monitoring-checklist-step-config-button",disabled:e.controllerLinkDisabled},on:{click:function(t){return e.controllerAppRoute()}}},[e._v(" "+e._s(e.t("kubewarden.monitoring.prerequisites.controllerConfig.button"))+" ")])])])],1)],1)},x=[],M=r("da25"),N=r("d709"),D={props:{cattleDashboardNs:{type:Object,default:null},conflictingGrafanaDashboards:{type:Array,default:null},controllerApp:{type:Object,default:null},controllerChart:{type:Object,default:null},kubewardenServiceMonitor:{type:Object,default:null},kubewardenDashboards:{type:Array,default:null},metricsConfiguration:{type:Object,default:null},monitoringApp:{type:Object,default:null},monitoringChart:{type:Object,default:null},openTelSvc:{type:Object,default:null},policyObj:{type:Object,default:null},policyServerObj:{type:Object,default:null},outdatedTelemetrySpec:{type:Boolean,default:!1},unsupportedTelemetrySpec:{type:Boolean,default:!1}},components:{AsyncButton:N["b"],Banner:k["a"]},computed:{...Object(o["b"])(["currentCluster"]),...Object(o["b"])({t:"i18n/t"}),controllerLinkDisabled(){return!this.openTelSvc||!this.monitoringApp||!this.hasKubewardenDashboards||!this.controllerChart||!this.controllerApp},controllerLinkTooltip(){return this.controllerLinkDisabled?this.t("kubewarden.monitoring.prerequisites.tooltips.prerequisites"):this.controllerChart?null:this.t("kubewarden.monitoring.prerequisites.tooltips.chartError",{chart:"Kubewarden Controller"},!0)},dashboardsTooltip(){return this.monitoringApp?this.monitoringApp&&l()(this.cattleDashboardNs)?this.t("kubewarden.monitoring.prerequisites.tooltips.nsNotFound"):null:this.t("kubewarden.monitoring.prerequisites.tooltips.appNotInstalled",{app:"Rancher Monitoring"},!0)},dashboardButtonDisabled(){return!this.monitoringApp||l()(this.cattleDashboardNs)||!this.hasKubewardenDashboards&&!!this.conflictingGrafanaDashboards.length},hasKubewardenDashboards(){return!l()(this.kubewardenDashboards)},monitoringChartLink(){return this.monitoringApp?this.t("kubewarden.monitoring.prerequisites.monitoringApp.edit"):this.t("kubewarden.monitoring.prerequisites.monitoringApp.install")},monitoringLinkTooltip(){return this.monitoringChart?null:this.t("kubewarden.monitoring.prerequisites.tooltips.chartError",{chart:"Rancher Monitoring"},!0)},serviceMonitorButtonDisabled(){return!this.controllerApp||!this.monitoringApp},serviceMonitorsTooltip(){return this.monitoringApp?!this.kubewardenServiceMonitor&&this.controllerApp?this.t("kubewarden.monitoring.prerequisites.tooltips.monitorsNotFound",{namespace:null===(e=this.controllerApp.metadata)||void 0===e?void 0:e.namespace},!0):null:this.t("kubewarden.monitoring.prerequisites.tooltips.prerequisites");var e},showConflictingDashboardsBanner(){return!this.hasKubewardenDashboards&&!l()(this.conflictingGrafanaDashboards)}},methods:{async addDashboards(e){try{await A({store:this.$store,monitoringApp:this.monitoringApp,controllerApp:this.controllerApp}),e(!0)}catch(t){Object(_["a"])({error:t,store:this.$store}),e(!1)}},async addServiceMonitor(e){try{var t;await E({store:this.$store,policyObj:this.policyObj,policyServerObj:this.policyServerObj,controllerNs:null===(t=this.controllerApp)||void 0===t||null===(t=t.metadata)||void 0===t?void 0:t.namespace,serviceMonitor:this.kubewardenServiceMonitor}),this.$emit("updateServiceMonitors"),e(!0)}catch(r){Object(_["a"])({error:r,store:this.$store}),e(!1)}},badgeIcon(e){if(Array.isArray(e)){const t=l()(e);return{"icon-dot-open":t,"icon-checkmark":!t,"text-success":!t}}return{"icon-dot-open":!e,"icon-checkmark":e,"text-success":e}},monitoringAppRoute(){if(!this.monitoringApp&&this.monitoringChart&&this.monitoringChart.goToInstall(),this.monitoringApp){var e,t,r,a,i,o,n;const l={[M["g"]]:null===(e=this.monitoringApp.metadata)||void 0===e?void 0:e.namespace,[M["f"]]:null===(t=this.monitoringApp.metadata)||void 0===t?void 0:t.name,[M["o"]]:null===(r=this.monitoringApp.spec)||void 0===r||null===(r=r.chart)||void 0===r||null===(r=r.metadata)||void 0===r?void 0:r.version,[M["i"]]:null===(a=this.monitoringApp.spec)||void 0===a||null===(a=a.chart)||void 0===a||null===(a=a.metadata)||void 0===a||null===(a=a.annotations)||void 0===a?void 0:a[v["c"].SOURCE_REPO_NAME],[M["j"]]:null===(i=this.monitoringApp.spec)||void 0===i||null===(i=i.chart)||void 0===i||null===(i=i.metadata)||void 0===i||null===(i=i.annotations)||void 0===i?void 0:i[v["c"].SOURCE_REPO_TYPE],[M["d"]]:null===(o=this.monitoringApp.spec)||void 0===o||null===(o=o.chart)||void 0===o||null===(o=o.metadata)||void 0===o?void 0:o.name};this.$router.push({name:"c-cluster-apps-charts-install",params:{cluster:(null===(n=this.currentCluster)||void 0===n?void 0:n.id)||"_"},query:l})}},controllerAppRoute(){if(this.controllerApp){var e,t,r,a,i,o,n;const l=null===(e=this.controllerApp.spec)||void 0===e||null===(e=e.chart)||void 0===e?void 0:e.metadata,s={[M["g"]]:null===l||void 0===l||null===(t=l.annotations)||void 0===t?void 0:t[v["c"].NAMESPACE],[M["f"]]:null===l||void 0===l||null===(r=l.annotations)||void 0===r?void 0:r[v["c"].RELEASE_NAME],[M["o"]]:null===l||void 0===l||null===(a=l.annotations)||void 0===a?void 0:a["catalog.cattle.io/upstream-version"],[M["i"]]:null===l||void 0===l||null===(i=l.annotations)||void 0===i?void 0:i[v["c"].SOURCE_REPO_NAME],[M["j"]]:null===l||void 0===l||null===(o=l.annotations)||void 0===o?void 0:o[v["c"].SOURCE_REPO_TYPE],[M["d"]]:null===l||void 0===l?void 0:l.name};this.$router.push({name:"c-cluster-apps-charts-install",params:{cluster:(null===(n=this.currentCluster)||void 0===n?void 0:n.id)||"_"},query:s})}}}},L=D,$=(r("6403"),r("d802")),I=Object($["a"])(L,P,x,!1,null,"52eaefc6",null),q=I.exports,B={props:{active:{type:Boolean,default:null},resource:{type:String,default:null},policyObj:{type:Object,default:null},policyServerObj:{type:Object,default:null}},components:{Banner:k["a"],DashboardMetrics:g["a"],Loading:y["a"],MetricsChecklist:q},mixins:[b["a"]],async fetch(){this.debouncedRefreshCharts=c()((e=!1)=>{Object(S["d"])({store:this.$store,chartName:"rancher-monitoring",init:e})},500);const e=[{name:p["a"].APP,property:this.allApps},{name:p["a"].CLUSTER_REPO,property:this.allRepos},{name:p["b"],property:this.allConfigMaps},{name:w["f"].POLICY_SERVER,property:this.allPolicyServers},{name:p["m"].SERVICEMONITOR,property:this.allServiceMonitors},{name:p["n"],property:this.allNamespaces},{name:p["z"],property:this.allServices}],t=[];for(const i of e)l()(i.property)&&this.$store.getters["cluster/canList"](i.name)&&t.push(this.$fetchType(i.name));if(await Object(f["a"])(t),this.showChecklist&&!this.monitoringChart&&this.debouncedRefreshCharts(!0),this.monitoringStatus.installed)try{var r;if(this.metricsProxy=await C({store:this.$store,type:this.METRICS_TYPE}),this.metricsProxy)this.metricsService=await Object(h["b"])("v2",this.$store,null===(r=this.currentCluster)||void 0===r?void 0:r.id,this.metricsProxy)}catch(a){const e={_statusText:"Error",message:"Error fetching Grafana Service: "+a};Object(_["a"])({error:e,store:this.$store})}},data(){const e=this.resource===w["f"].POLICY_SERVER?w["n"].POLICY_SERVER:w["n"].POLICY;return{METRICS_TYPE:e,[p["a"].APP]:null,[p["a"].CLUSTER_REPO]:null,[p["b"]]:null,[p["m"].SERVICEMONITOR]:null,[p["z"]]:null,metricsProxy:null,metricsService:null,debouncedRefreshCharts:null,outdatedTelemetrySpec:!1,unsupportedTelemetrySpec:!1}},watch:{async grafanaService(){var e;this.metricsProxy||(this.metricsProxy=await C({store:this.$store,type:this.METRICS_TYPE}),this.metricsProxy&&(this.metricsService=await Object(h["b"])("v2",this.$store,null===(e=this.currentCluster)||void 0===e?void 0:e.id,this.metricsProxy)))},async controllerApp(){this.controllerApp&&await this.controllerApp.fetchValues(!0)}},computed:{...Object(o["b"])(["currentCluster","productId"]),...Object(o["b"])({charts:"catalog/charts"}),...Object(m["b"])(),policyName(){return Object(j["a"])(this.policyObj)},allApps(){return this.$store.getters["cluster/all"](p["a"].APP)},allRepos(){return this.$store.getters["cluster/all"](p["a"].CLUSTER_REPO)},allConfigMaps(){return this.$store.getters["cluster/all"](p["b"])},allNamespaces(){return this.$store.getters["cluster/all"](p["n"])},allPolicyServers(){return this.$store.getters["cluster/all"](w["f"].POLICY_SERVER)},allServiceMonitors(){return this.$store.getters["cluster/all"](p["m"].SERVICEMONITOR)},allServices(){return this.$store.getters["cluster/all"](p["z"])},cattleDashboardNs(){var e;return null===(e=this.allNamespaces)||void 0===e?void 0:e.find(e=>{var t;return"cattle-dashboards"===(null===e||void 0===e||null===(t=e.metadata)||void 0===t?void 0:t.name)})},conflictingGrafanaDashboards(){var e;return null===(e=this.allConfigMaps)||void 0===e?void 0:e.filter(e=>{var t;const r=null===e||void 0===e||null===(t=e.metadata)||void 0===t?void 0:t.name;if(r)return r===w["n"].POLICY_SERVER||r===w["n"].POLICY})},controllerApp(){var e;return null===(e=this.allApps)||void 0===e?void 0:e.find(e=>{var t;return(null===e||void 0===e||null===(t=e.spec)||void 0===t||null===(t=t.chart)||void 0===t||null===(t=t.metadata)||void 0===t?void 0:t.name)===w["h"].CONTROLLER})},controllerChart(){var e;return null===(e=this.charts)||void 0===e?void 0:e.find(e=>e.chartName===w["h"].CONTROLLER)},grafanaService(){var e;const t=null===(e=this.allServices)||void 0===e?void 0:e.filter(e=>{var t;return"rancher-monitoring"===(null===e||void 0===e||null===(t=e.metadata)||void 0===t||null===(t=t.labels)||void 0===t?void 0:t["app.kubernetes.io/instance"])});return null===t||void 0===t?void 0:t.find(e=>{var t;return"grafana"===(null===e||void 0===e||null===(t=e.metadata)||void 0===t||null===(t=t.labels)||void 0===t?void 0:t["app.kubernetes.io/name"])})},kubewardenGrafanaDashboards(){var e;return null===(e=this.allConfigMaps)||void 0===e?void 0:e.filter(e=>{var t;return null===e||void 0===e||null===(t=e.metadata)||void 0===t||null===(t=t.labels)||void 0===t?void 0:t[w["m"].DASHBOARD]})},kubewardenServiceMonitor(){var e;return R({policyObj:this.policyObj,policyServerObj:this.policyServerObj,controllerNs:null===(e=this.controllerApp)||void 0===e||null===(e=e.metadata)||void 0===e?void 0:e.namespace,allServiceMonitors:this.allServiceMonitors})},metricsConfiguration(){var e,t;if(!this.controllerApp)return console.log("# 0"),null;const r=null===(e=this.controllerApp)||void 0===e||null===(e=e.spec)||void 0===e||null===(e=e.chart)||void 0===e||null===(e=e.metadata)||void 0===e?void 0:e.version,a=null===(t=this.controllerApp)||void 0===t||null===(t=t.values)||void 0===t?void 0:t.telemetry;if(u.a.gte(r,"4.0.0-0")){const e=void 0===(null===a||void 0===a?void 0:a.metrics)||"boolean"===typeof(null===a||void 0===a?void 0:a.metrics);return"custom"===(null===a||void 0===a?void 0:a.mode)?(this.unsupportedTelemetrySpec=!0,null):e?!0!==(null===a||void 0===a?void 0:a.metrics)?null:null===a||void 0===a?void 0:a.metrics:(this.outdatedTelemetrySpec=!0,null)}var i;return null===a||void 0===a||null===(i=a.metrics)||void 0===i?void 0:i.enabled},monitoringApp(){var e;return null===(e=this.allApps)||void 0===e?void 0:e.find(e=>{var t;return"rancher-monitoring"===(null===e||void 0===e||null===(t=e.spec)||void 0===t||null===(t=t.chart)||void 0===t||null===(t=t.metadata)||void 0===t?void 0:t.name)})},monitoringChart(){var e;return null===(e=this.charts)||void 0===e?void 0:e.find(e=>"rancher-monitoring"===e.chartName)},openTelemetryServices(){return this.allServices?this.allServices.filter(e=>{var t;return"opentelemetry-operator"===(null===e||void 0===e||null===(t=e.metadata)||void 0===t||null===(t=t.labels)||void 0===t?void 0:t[v["h"].MANAGED_NAME])}):null},openTelSvc(){return l()(this.openTelemetryServices)?null:this.openTelemetryServices.find(e=>{var t;const r=null===e||void 0===e||null===(t=e.spec)||void 0===t?void 0:t.ports;if(r.length)return r.find(e=>8080===e.port)})},policyServerSvcs(){if(!l()(this.allPolicyServers)){const t=this.allPolicyServers.map(e=>{var t;return null===e||void 0===e||null===(t=e.metadata)||void 0===t?void 0:t.name}),r=[];for(const a of t){var e;r.push(null===(e=this.allServices)||void 0===e?void 0:e.find(e=>{var t;return(null===e||void 0===e||null===(t=e.metadata)||void 0===t||null===(t=t.labels)||void 0===t?void 0:t.app)==="kubewarden-policy-server-"+a}))}return r}return null},showChecklist(){const e=!l()(this.kubewardenGrafanaDashboards);return!this.openTelSvc||!this.monitoringApp||!this.kubewardenServiceMonitor||!this.metricsConfiguration||!e}},methods:{async updateServiceMonitors(){await this.$fetchType(p["m"].SERVICEMONITOR)}}},G=B,V=Object($["a"])(G,a,i,!1,null,null,null);t["a"]=V.exports},"44da":function(e,t,r){"use strict";r("5cfc")},5136:function(e,t,r){"use strict";r.d(t,"b",(function(){return s})),r.d(t,"a",(function(){return c}));var a=r("330a"),i=r.n(a),o=r("90cd");function n(e,t){const r=null===e||void 0===e?void 0:e.links["view"],a=r.lastIndexOf("/");return l(r.slice(0,a),"http",null===e||void 0===e?void 0:e.metadata.name,t)}function l(e,t,r,a,i){const o=(t?encodeURIComponent(t)+":":"")+encodeURIComponent(r)+(a?":"+encodeURIComponent(a):""),n="/"+(i||"").replace(/^\/+/g,""),l=e.replace(/\/+$/g,""),s=`${l}/${o}/proxy${n}`;return s}async function s(e){const{store:t,queryService:r,resource:a,relatedPolicies:o,policy:l,time:s}=e;try{const e=n(r,16686),c=[];if(i()(o)){if(!l)throw new Error("Policy is undefined");c.push(d(t,e,l,s))}else null===o||void 0===o||o.forEach(r=>{const a=d(t,e,r,s);a&&c.push(a)});let p=await Promise.all(c);return p=p.flatMap(e=>null===e||void 0===e?void 0:e.data),u(t,p,a,o,l)}catch(c){console.warn("Error fetching Jaeger traces: "+c)}return null}function c(e){var t,r,a;let i=null;switch(null===e||void 0===e?void 0:e.kind){case"ClusterAdmissionPolicy":i="clusterwide-"+(null===e||void 0===e||null===(t=e.metadata)||void 0===t?void 0:t.name);break;case"AdmissionPolicy":i=`namespaced-${null===e||void 0===e||null===(r=e.metadata)||void 0===r?void 0:r.namespace}-${null===e||void 0===e||null===(a=e.metadata)||void 0===a?void 0:a.name}`;break;default:break}return i}function d(e,t,r,a){let i=null;const o=c(r),n=a||"2d",l=`lookback=${n}&tags={"policy_id"%3A"${o}"}`;i="api/traces?service=kubewarden-policy-server&operation=validation&"+l;const s=""+(t+i);return e.dispatch("cluster/request",{url:s})}function u(e,t,r,a,n){const l=e.getters["currentCluster"],s=[];function d(r){const a=c(r);return t.reduce((t,o)=>{var n;let s={};const c=o.spans.find(e=>"validation"===e.operationName),d=null===c||void 0===c||null===(n=c.tags)||void 0===n?void 0:n.find(e=>"policy_id"===(null===e||void 0===e?void 0:e.key)&&(null===e||void 0===e?void 0:e.value)===a);if(d){const e=p(c.tags);s={id:o.traceID,allowed:e.allowed,mode:r.spec.mode,name:e.name,operation:e.operation,kind:e.kind,namespace:e.namespace||null,startTime:c.startTime,duration:c.duration,responseMessage:e.response_message,responseCode:e.response_code,mutated:e.mutated}}return i()(s)||(t.push(s),e.dispatch("kubewarden/updatePolicyTraces",{policyName:r.metadata.name,cluster:null===l||void 0===l?void 0:l.id,updatedTrace:s})),t},[])}if(r===o["f"].POLICY_SERVER)for(const o of a){const e=d(o);i()(e)||s.push({policyName:o.metadata.name,cluster:null===l||void 0===l?void 0:l.id,traces:e})}else{const e=d(n);i()(e)||s.push({policyName:n.metadata.name,cluster:null===l||void 0===l?void 0:l.id,traces:e})}return s}function p(e){const t={};for(const r of e)switch(r.type){case"string":t[r.key]=r.value;break;case"int64":t[r.key]=parseInt(r.value,10);break;case"float64":t[r.key]=parseFloat(r.value);break;case"bool":t[r.key]="true"===r.value;break;default:t[r.key]=r.value}return t}},5523:function(e,t,r){var a=r("5eaa");t=a(!1),t.push([e.i,".relative[data-v-a88dafa8]{position:relative}.policy__mode[data-v-a88dafa8]{display:flex;align-items:center}.policy__mode i[data-v-a88dafa8]{margin-left:5px;font-size:22px;color:var(--warning)}.gauges[data-v-a88dafa8],.gaugesContainer[data-v-a88dafa8]{display:flex}.gauges[data-v-a88dafa8]{justify-content:space-around;flex-wrap:wrap;justify-content:left}.gauges .count-gauge[data-v-a88dafa8]{width:46%;margin-bottom:10px;flex:initial}.gauges>*[data-v-a88dafa8]{flex:1;margin-right:1.75%}",""]),e.exports=t},"55e7":function(e,t,r){var a=r("749a");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var i=r("0ed3").default;i("5f488408",a,!0,{sourceMap:!1,shadowMode:!1})},"5cfc":function(e,t,r){var a=r("89d1");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var i=r("0ed3").default;i("52f6271b",a,!0,{sourceMap:!1,shadowMode:!1})},6403:function(e,t,r){"use strict";r("b549")},"733f":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e._self._c;return t("PolicyDetail",{attrs:{value:e.value,mode:e.mode,resource:e.resource}})},i=[],o=r("da25"),n=r("80db"),l={name:"AdmissionPolicy",props:{mode:{type:String,default:o["r"]},resource:{type:String,default:null},value:{type:Object,required:!0}},components:{PolicyDetail:n["a"]}},s=l,c=r("d802"),d=Object(c["a"])(s,a,i,!1,null,null,null);t["default"]=d.exports},"749a":function(e,t,r){var a=r("5eaa");t=a(!1),t.push([e.i,".checklist__container[data-v-f489d41c]{display:flex;justify-content:center;flex-direction:column;border:1px solid var(--border);padding:10px}.checklist__config[data-v-f489d41c],.checklist__step[data-v-f489d41c]{display:flex;flex-direction:row;justify-content:flex-start;align-items:center}.checklist__step[data-v-f489d41c]{min-height:40px}",""]),e.exports=t},"7d12":function(e,t,r){"use strict";r("55e7")},"80db":function(e,t,r){"use strict";var a=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"mb-20"},[t("h3",[e._v(e._s(e.t("namespace.resources")))])]),t("ResourceTabs",{attrs:{"data-testid":"kw-policy-detail-tabs",mode:e.mode,"need-related":e.hasRelationships},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},[e.policyReadme?t("Tab",{attrs:{name:"policy-readme",label:"Readme",weight:99}},[t("Markdown",{attrs:{"data-testid":"kw-policy-detail-readme"},model:{value:e.policyReadme,callback:function(t){e.policyReadme=t},expression:"policyReadme"}})],1):e._e(),e.hasRules?t("Tab",{attrs:{name:"policy-rules",label:"Rules",weight:98}},[t("RulesTable",{attrs:{rows:e.rulesRows,"data-testid":"kw-policy-detail-rules-table"}})],1):e._e(),t("Tab",{attrs:{name:"policy-tracing",label:"Tracing",weight:97}},[t("TraceTable",{attrs:{resource:e.resource,policy:e.value,"data-testid":"kw-policy-detail-trace-table"}})],1),t("Tab",{attrs:{name:"policy-metrics",label:"Metrics",weight:96},scopedSlots:e._u([{key:"default",fn:function(r){return[t("MetricsTab",{attrs:{resource:e.resource,"policy-obj":e.value,active:r.active}})]}}])})],1)],1)},i=[],o=r("9ce4"),n=r("330a"),l=r.n(n),s=r("da25"),c=r("f390"),d=r("305c"),u=r("56dc"),p=r("c422"),v=r("38de"),h=r("90cd"),m=r("3f46"),f=function(){var e=this,t=e._self._c;return t("div",[e.rows.length>0?t("SortableTable",{attrs:{"data-testid":"kw-policy-rules-sortable-table",rows:e.rows,headers:e.RULE_HEADERS,"table-actions":!1,"row-actions":!1,"key-field":"traceID","default-sort-by":"startTime"},scopedSlots:e._u([{key:"col:apiGroup",fn:function({row:r}){return[t("td",[t("span",[e._v(e._s(r.apiGroups||"-"))])])]}},{key:"col:apiVersion",fn:function({row:r}){return[t("td",[t("span",[e._v(e._s(r.apiVersions||"-"))])])]}},{key:"col:operations",fn:function({row:r}){return[t("td",[t("span",[e._v(e._s(e.joinColumn(r.operations)))])])]}},{key:"col:resources",fn:function({row:r}){return[t("td",[t("span",[e._v(e._s(e.joinColumn(r.resources)))])])]}}],null,!1,1857136105)}):t("div",[t("Banner",{staticClass:"type-banner mb-20 mt-0",attrs:{color:"warning",label:e.t("kubewarden.policies.noRules")}})],1)],1)},b=[],g=r("6418"),y=r("0fb1"),k=r("5191"),w={props:{rows:{type:Array,default:()=>[]}},components:{Banner:g["a"],SortableTable:y["a"]},data(){return{RULE_HEADERS:k["g"]}},methods:{joinColumn(e){return(null===e||void 0===e?void 0:e.join(", "))||""}}},_=w,S=r("d802"),C=Object(S["a"])(_,f,b,!1,null,null,null),T=C.exports,O=r("00ce"),A={name:"PolicyDetail",components:{Markdown:u["a"],MetricsTab:m["a"],ResourceTabs:p["a"],RulesTable:T,Tab:v["a"],TraceTable:O["a"]},mixins:[d["a"]],props:{mode:{type:String,default:s["r"]},resource:{type:String,default:null},value:{type:Object,default:()=>{}}},async mounted(){var e;if(null!==(e=this.value)&&void 0!==e&&null!==(e=e.metadata)&&void 0!==e&&null!==(e=e.annotations)&&void 0!==e&&e[h["b"]])try{const e=await this.value.artifactHubPackageVersion();e&&!e.error&&e.readme&&(this.policyReadme=JSON.parse(JSON.stringify(e.readme)))}catch(t){console.warn("Unable to fetch artifacthub package: "+t)}},data(){return{policyReadme:null}},computed:{...Object(o["b"])(["currentCluster"]),...Object(c["b"])(),dashboardVars(){var e;return{policy_name:"clusterwide-"+(null===(e=this.value)||void 0===e?void 0:e.id)}},hasRelationships(){var e;return!(null===(e=this.value)||void 0===e||null===(e=e.metadata)||void 0===e||!e.relationships)},hasRules(){var e;return!l()(null===(e=this.rulesRows)||void 0===e?void 0:e[0])},rulesRows(){var e;return null===(e=this.value)||void 0===e||null===(e=e.spec)||void 0===e?void 0:e.rules}}},R=A,E=Object(S["a"])(R,a,i,!1,null,null,null);t["a"]=E.exports},"89d1":function(e,t,r){var a=r("5eaa");t=a(!1),t.push([e.i,".policy-table-container[data-v-7b599723]{display:flex;flex-direction:column;gap:1rem}.filter[data-v-7b599723]{display:flex;flex-direction:row;justify-content:flex-end;align-self:flex-end;align-items:center}.filter>*[data-v-7b599723]{margin:10px;max-width:33%}.filter[data-v-7b599723]>:first-child{margin-left:0}.filter[data-v-7b599723]>:last-child{margin-right:0}.filter__category[data-v-7b599723]{min-width:200px;height:unset}.filter__reset[data-v-7b599723],.filter__search[data-v-7b599723]{height:61px}",""]),e.exports=t},b3e2:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e._self._c;return t("PolicyDetail",{attrs:{value:e.value,mode:e.mode,resource:e.resource}})},i=[],o=r("da25"),n=r("80db"),l={name:"ClusterAdmissionPolicy",props:{mode:{type:String,default:o["r"]},resource:{type:String,default:null},value:{type:Object,required:!0}},components:{PolicyDetail:n["a"]}},s=l,c=r("d802"),d=Object(c["a"])(s,a,i,!1,null,null,null);t["default"]=d.exports},b549:function(e,t,r){var a=r("dfc3");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var i=r("0ed3").default;i("0215b630",a,!0,{sourceMap:!1,shadowMode:!1})},b7b9:function(e,t,r){var a=r("5523");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var i=r("0ed3").default;i("5b3b0e05",a,!0,{sourceMap:!1,shadowMode:!1})},cb8a:function(e,t,r){var a={"./kubewarden-dashboard-policy.json":["ec40",8],"./kubewarden-dashboard-policyserver.json":["82e7",9]};function i(e){if(!r.o(a,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=a[e],i=t[0];return r.e(t[1]).then((function(){return r.t(i,3)}))}i.keys=function(){return Object.keys(a)},i.id="cb8a",e.exports=i},dfc3:function(e,t,r){var a=r("5eaa");t=a(!1),t.push([e.i,".checklist__container[data-v-52eaefc6]{display:flex;justify-content:center;flex-direction:column;border:1px solid var(--border);padding:10px}.checklist__config[data-v-52eaefc6],.checklist__step[data-v-52eaefc6]{display:flex;flex-direction:row;justify-content:flex-start;align-items:center}.checklist__step[data-v-52eaefc6]{min-height:40px}.conflicting-banner[data-v-52eaefc6]{display:flex;flex-direction:column}",""]),e.exports=t}}]);
//# sourceMappingURL=kubewarden-2.1.4.umd.min.detail.js.map