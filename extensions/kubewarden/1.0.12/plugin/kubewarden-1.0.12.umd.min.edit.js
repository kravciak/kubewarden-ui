(("undefined"!==typeof self?self:this)["webpackJsonpkubewarden_1_0_12"]=("undefined"!==typeof self?self:this)["webpackJsonpkubewarden_1_0_12"]||[]).push([[4],{"0c46":function(e,t,a){var s=a("e509");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a("0ed3").default;i("6211eec7",s,!0,{sourceMap:!1,shadowMode:!1})},"4b1c":function(e,t,a){"use strict";a("e1aa")},5402:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return e.isCreate?t("Create",{attrs:{value:e.value,mode:e.mode}}):t("CruResource",{attrs:{resource:e.value,mode:e.realMode,"can-yaml":!1},on:{finish:e.finish}},[t("Config",{attrs:{value:e.value,mode:e.realMode},on:{updateYamlValues:e.updateYamlValuesFromEdit}})],1)},i=[],o=a("7838"),r=a.n(o),l=a("da25"),n=a("305c"),d=a("fd5f"),c=a("8b5f"),u=a("e9a3"),p=a("666d"),h=a("81fb"),v={name:"AdmissionPolicy",props:{value:{type:Object,required:!0},mode:{type:String,default:l["v"]},realMode:{type:String,default:l["v"]}},components:{CruResource:d["a"],Config:p["a"],Create:h["a"]},mixins:[n["a"]],provide(){return{chartType:this.value.type,realMode:this.realMode}},computed:{isCreate(){return this.realMode===l["t"]}},methods:{async finish(e){try{Object(c["a"])(this.value),await this.save(e)}catch(t){Object(u["a"])({error:t,store:this.$store})}},updateYamlValuesFromEdit(e){const t=r.a.load(e);Object(c["a"])(t),Object.assign(this.value,t)}}},b=v,m=a("d802"),y=Object(m["a"])(b,s,i,!1,null,null,null);t["default"]=y.exports},"546b":function(e,t,a){"use strict";a("6166")},6166:function(e,t,a){var s=a("801c");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a("0ed3").default;i("224a7bda",s,!0,{sourceMap:!1,shadowMode:!1})},"666d":function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;return e.$fetchState.pending?t("Loading"):t("Values",{attrs:{value:e.value,"chart-values":e.chartValues,"yaml-values":e.yamlValues,mode:e.mode},on:{updateYamlValues:function(t){return e.$emit("updateYamlValues",t)}}})},i=[],o=a("1fcb"),r=a.n(o),l=a("da25"),n=a("c5e6"),d=a("e24b"),c=a("15ca"),u=a("90cd"),p=a("9c6e"),h={name:"Config",props:{mode:{type:String,default:l["C"]},value:{type:Object,default:()=>{}}},components:{Loading:c["a"],Values:p["a"]},async fetch(){},async mounted(){var e,t,a;if(this.chartValues={policy:this.value,questions:null},null!==(e=this.value)&&void 0!==e&&null!==(t=e.metadata)&&void 0!==t&&null!==(a=t.annotations)&&void 0!==a&&a[u["b"]])try{var s;const e=await this.value.artifactHubPackageVersion();if(e&&!e.error&&null!==(s=e.data)&&void 0!==s&&s[u["c"].QUESTIONS]){var i,o;const t=structuredClone(u["d"]),a=r()(t.spec.settings,null===(i=this.chartValues.policy)||void 0===i||null===(o=i.spec)||void 0===o?void 0:o.settings);Object(d["k"])(this.chartValues.policy.spec,"settings",a),this.policyQuestions=this.value.parsePackageMetadata(e.data[u["c"].QUESTIONS]),this.policyQuestions&&Object(d["k"])(this.chartValues,"questions",this.policyQuestions)}}catch(l){console.warn("Unable to fetch artifacthub package: "+l)}this.yamlValues=Object(n["d"])(this.value)},data(){return{chartValues:null,yamlValues:"",policyQuestions:null}}},v=h,b=a("d802"),m=Object(b["a"])(v,s,i,!1,null,null,null);t["a"]=m.exports},7089:function(e,t,a){var s=a("5eaa");t=s(!1),t.push([e.i,"[data-v-5ae37dc8] .step-container{height:auto}.step__basic[data-v-5ae37dc8]{display:flex;flex-direction:column;flex:1;overflow-x:hidden}.step__basic .spacer[data-v-5ae37dc8]{line-height:2}.step__values__controls[data-v-5ae37dc8]{display:flex;margin-bottom:15px}.step__values__controls[data-v-5ae37dc8]>:not(:last-of-type){margin-right:10px}.step__values__content[data-v-5ae37dc8],.step__values__controls--spacer[data-v-5ae37dc8]{flex:1}.step__values__content[data-v-5ae37dc8] .tab-container{overflow:auto}",""]),e.exports=t},"71ed":function(e,t,a){"use strict";a("8737")},"7b91":function(e,t,a){"use strict";a("0c46")},"801c":function(e,t,a){var s=a("5eaa");t=s(!1),t.push([e.i,".step__values__controls[data-v-d467cb12]{display:flex;margin-bottom:15px}.step__values__controls[data-v-d467cb12]>:not(:last-of-type){margin-right:10px}.step__values__content[data-v-d467cb12],.step__values__controls--spacer[data-v-d467cb12]{flex:1}.step__values__content[data-v-d467cb12] .tab-container{overflow:auto}",""]),e.exports=t},"81fb":function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;return e.$fetchState.pending?t("Loading",{attrs:{mode:"relative"}}):t("div",[e.hideArtifactHubBanner?e._e():[t("Banner",{staticClass:"type-banner mb-20 mt-0",attrs:{"data-testid":"kw-policy-create-ah-banner",color:"warning",closable:!0},on:{close:function(t){return e.closeBanner("updateHideBannerArtifactHub")}}},[t("div",[t("p",{directives:[{name:"clean-html",rawName:"v-clean-html",value:e.t("kubewarden.policies.noArtifactHub",{},!0),expression:"t('kubewarden.policies.noArtifactHub', {}, true)"}],staticClass:"mb-10"}),t("AsyncButton",{attrs:{mode:"artifactHub"},on:{click:e.addArtifactHub}})],1)])],e.hideAirgapBanner?e._e():[t("Banner",{staticClass:"type-banner mb-20 mt-0",attrs:{"data-testid":"kw-policy-create-ag-banner",color:"warning",closable:!0,label:e.t("kubewarden.policies.airgap.banner")},on:{close:function(t){return e.closeBanner("updateHideBannerAirgapPolicy")}}})],e.loadingPackages?t("Loading"):e._e(),e.value&&!e.loadingPackages?t("Wizard",{ref:"wizard",staticClass:"wizard",attrs:{"data-testid":"kw-policy-create-wizard",errors:e.errors,steps:e.steps,"edit-first-step":!0,"banner-title":e.bannerTitle,"banner-title-subtext":e.typeModule},on:{next:e.reset,cancel:e.done,finish:e.finish},scopedSlots:e._u([{key:"policies",fn:function(){return[t("PolicyGrid",{attrs:{"data-testid":"kw-policy-create-grid",value:e.packages},on:{selectType:function(t){return e.selectType(t)}},scopedSlots:e._u([{key:"customSubtype",fn:function(){return[t("div",{staticClass:"subtype custom",attrs:{"data-testid":"kw-grid-subtype-card-custom"},on:{click:function(t){return e.selectType("custom")}}},[t("div",{staticClass:"subtype__metadata"},[t("div",{staticClass:"subtype__body"},[t("div",{staticClass:"subtype__badge",style:{"background-color":"var(--darker)"}},[t("label",[e._v(e._s(e.t("kubewarden.customPolicy.badge")))])]),t("h4",{staticClass:"subtype__label"},[e._v(" "+e._s(e.t("kubewarden.customPolicy.title"))+" ")]),t("div",{staticClass:"subtype__description"},[e._v(" "+e._s(e.t("kubewarden.customPolicy.description"))+" ")])])])])]},proxy:!0}],null,!1,3987605579)})]},proxy:!0},{key:"readme",fn:function(){return[e.packageValues&&e.packageValues.readme?t("Markdown",{staticClass:"mb-20",attrs:{"data-testid":"kw-policy-create-readme",value:e.packageValues.readme}}):e._e()]},proxy:!0},{key:"values",fn:function(){return[t("Values",{attrs:{value:e.value,"chart-values":e.chartValues,"yaml-values":e.yamlValues,mode:e.mode,"custom-policy":e.customPolicy},on:{editor:t=>e.yamlOption=t,updateYamlValues:t=>e.yamlValues=t}})]},proxy:!0},{key:"finish",fn:function(){return[t("AsyncButton",{attrs:{"data-testid":"kw-policy-create-finish-button",disabled:!e.canFinish,mode:"finish"},on:{click:e.finish}})]},proxy:!0}],null,!1,1243871800),model:{value:e.value,callback:function(t){e.value=t},expression:"value"}}):e._e()],2)},i=[],o=a("7838"),r=a.n(o),l=a("1fcb"),n=a.n(l),d=a("330a"),c=a.n(d),u=a("9e74"),p=a.n(u),h=a("305c"),v=a("907c"),b=a("da25"),m=a("c5e6"),y=a("e24b"),f=a("6418"),g=a("d709"),_=a("15ca"),w=a("56dc"),k=a("ed59"),x=a("90cd"),C=a("8b5f"),V=a("e9a3"),O=a("f010"),M=function(){var e=this,t=e._self._c;return t("form",{staticClass:"create-resource-container step__policies"},[t("div",{staticClass:"filter"},[e.organizationOptions.length?t("LabeledSelect",{staticClass:"filter__organization",attrs:{"data-testid":"kw-grid-filter-organization",clearable:!0,taggable:!0,mode:e.mode,multiple:!0,label:e.t("kubewarden.utils.organization"),options:e.organizationOptions},model:{value:e.organizations,callback:function(t){e.organizations=t},expression:"organizations"}}):e._e(),t("LabeledSelect",{staticClass:"filter__keywords",attrs:{"data-testid":"kw-grid-filter-keywords",clearable:!0,taggable:!0,mode:e.mode,multiple:!0,label:e.t("kubewarden.utils.keyword"),options:e.keywordOptions},model:{value:e.keywords,callback:function(t){e.keywords=t},expression:"keywords"}}),t("LabeledSelect",{staticClass:"filter__category",attrs:{"data-testid":"kw-grid-filter-category",clearable:!0,searchable:!1,mode:e.mode,multiple:!0,placement:"bottom",label:e.t("kubewarden.utils.resource"),options:e.resourceOptions},model:{value:e.category,callback:function(t){e.category=t},expression:"category"}}),t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchQuery,expression:"searchQuery"}],ref:"searchQuery",staticClass:"input-sm filter__search",attrs:{"data-testid":"kw-grid-filter-search",type:"search",placeholder:e.t("catalog.charts.search")},domProps:{value:e.searchQuery},on:{input:function(t){t.target.composing||(e.searchQuery=t.target.value)}}}),t("button",{ref:"btn",staticClass:"btn, btn-sm, role-primary, filter__reset",attrs:{"data-testid":"kw-grid-filter-refresh",type:"button"},on:{click:e.refresh}},[e._v(" "+e._s(e.t("kubewarden.utils.resetFilter"))+" ")])],1),t("div",{staticClass:"grid"},[e._t("customSubtype"),e._l(e.filteredSubtypes,(function(s){return t("div",{key:s.package_id,staticClass:"subtype",attrs:{"data-testid":"kw-grid-subtype-card-"+s.package_id},on:{click:function(t){return e.$emit("selectType",s)}}},[t("div",{staticClass:"subtype__metadata"},[t("div",{staticClass:"subtype__body"},[e.hasAnnotation(s,"kubewarden/resources")?t("div",{staticClass:"subtype__badge"},[t("label",[e._v(e._s(e.resourceType(s.data["kubewarden/resources"])))])]):e._e(),t("div",{staticClass:"subtype__label"},[t("h4",[e._v(" "+e._s(s.display_name)+" ")])]),s.description?t("div",{staticClass:"subtype__description"},[e._v(" "+e._s(s.description)+" ")]):e._e()]),t("div",{staticClass:"subtype__footer"},[t("div",{staticClass:"subtype__left"},[s.signed?t("div",{staticClass:"subtype__signed"},[t("span",{directives:[{name:"clean-tooltip",rawName:"v-clean-tooltip",value:e.t("kubewarden.policyCharts.signedPolicy.tooltip",{signatures:e.subtypeSignature(s)}),expression:"t('kubewarden.policyCharts.signedPolicy.tooltip', { signatures: subtypeSignature(subtype) })"}]},[t("i",{staticClass:"icon icon-lock"})])]):e._e(),e.isOfficial(s)?t("div",{staticClass:"subtype__icon"},[t("img",{directives:[{name:"clean-tooltip",rawName:"v-clean-tooltip",value:e.t("kubewarden.policies.official"),expression:"t('kubewarden.policies.official')"}],staticClass:"ml-5",attrs:{src:a("c3ec"),alt:e.t("kubewarden.policies.official")}})]):e._e()]),t("div",{staticClass:"subtype__right"},[e.hasAnnotation(s,"kubewarden/mutation")?t("div",{staticClass:"subtype__mutation"},[t("span",{directives:[{name:"clean-tooltip",rawName:"v-clean-tooltip",value:e.t("kubewarden.policyCharts.mutationPolicy.tooltip"),expression:"t('kubewarden.policyCharts.mutationPolicy.tooltip')"}]},[e._v(" "+e._s(e.t("kubewarden.policyCharts.mutationPolicy.label"))+" ")])]):e._e(),e.hasAnnotation(s,"kubewarden/contextAwareResources")?t("div",{staticClass:"subtype__aware"},[t("span",{directives:[{name:"clean-tooltip",rawName:"v-clean-tooltip",value:e.t("kubewarden.policyCharts.contextAware.tooltip"),expression:"t('kubewarden.policyCharts.contextAware.tooltip')"}]},[e._v(" "+e._s(e.t("kubewarden.policyCharts.contextAware.label"))+" ")])]):e._e()])])])])}))],2)])},P=[],Y=a("d1f7"),S=a.n(Y),A=a("5000"),j=a("2cb5"),R=a("1d19"),T=a("466b");function E(e){var t;const a=[],s=null===e||void 0===e?void 0:e.flatMap(e=>{var t;const a=null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t["kubewarden/resources"];if(a)return a});return null===s||void 0===s||null===(t=s.flatMap(e=>{if(e){const t=e.split(",");t.length>1?t.forEach(e=>a.push(e.trim())):a.push(e)}return[]}))||void 0===t||t.sort(),a&&0!==(null===a||void 0===a?void 0:a.length)?[...new Set(a.filter(Boolean))]:[]}function $(e,t){if(e){var a,s;const i=null===(a=e.data)||void 0===a||null===(s=a["kubewarden/resources"])||void 0===s?void 0:s.split(",");let o=!1;if(i)for(const e of i)o=null===t||void 0===t?void 0:t.some(t=>{var a,s;return(null===t||void 0===t||null===(a=t.attributes)||void 0===a?void 0:a.kind)===e&&(!1===(null===t||void 0===t||null===(s=t.attributes)||void 0===s?void 0:s.namespaced)||void 0)});return o}return!1}var L={props:{mode:{type:String,default:b["t"]},value:{type:Array,default:()=>[]}},inject:["chartType"],components:{LabeledSelect:T["a"]},fetch(){const e=this.$route.query;this.category=e[b["c"]]||"",this.searchQuery=e[b["k"]]||""},data(){return{KUBEWARDEN_PRODUCT_NAME:x["k"],category:null,keywords:[],organizations:[],searchQuery:null}},beforeMount(){if(!c()(this.filteredSubtypes)){const e=this.filteredSubtypes.find(e=>this.isOfficial(e));this.$nextTick(()=>{var t;e&&null!==(t=e.repository)&&void 0!==t&&t.organization_display_name&&this.organizations.push(e.repository.organization_display_name)})}},computed:{allSchemas(){return this.$store.getters["cluster/all"](v["x"])},filteredPackages(){var e;const t=null===(e=this.value)||void 0===e?void 0:e.filter(e=>{const t=this.isPrerelease(e);return!(!this.showPreRelease&&t)&&(this.chartType!==x["f"].ADMISSION_POLICY||!$(e,this.allSchemas))});return t||[]},filteredSubtypes(){const e=this.filteredPackages||[],t=e.filter(e=>{var t,a;if(this.category&&(!this.hasAnnotation(e,"kubewarden/resources")||null===(t=e.data)||void 0===t||null===(a=t["kubewarden/resources"])||void 0===a||!a.includes(this.category)))return!1;if(this.searchQuery){const t=this.searchQuery.split(/\s*[, ]\s*/).map(e=>Object(j["e"])(e,!1));for(const a of t){var s;if((null===(s=e.display_name)||void 0===s||!s.match(a))&&e.description&&!e.description.match(a))return!1}}if(this.keywords.length)for(const n of this.keywords){var i,o;if(!e.keywords||0===(null===(i=e.keywords)||void 0===i?void 0:i.length)||null===(o=e.keywords)||void 0===o||!o.includes(n))return!1}if(this.organizations.length)for(const n of this.organizations){var r,l;const t=(null===(r=e.repository)||void 0===r?void 0:r.organization_display_name)||(null===(l=e.repository)||void 0===l?void 0:l.user_alias);if(!t||t!==n)return!1}return!0});return Object(R["a"])(t,["name"])},keywordOptions(){var e;const t=null===(e=this.filteredSubtypes)||void 0===e?void 0:e.flatMap(e=>{if(null!==e&&void 0!==e&&e.keywords&&e.keywords.length)return e.keywords});return t&&0!==(null===t||void 0===t?void 0:t.length)?[...new Set(t.filter(Boolean))]:[]},organizationOptions(){var e;const t=null===(e=this.filteredSubtypes)||void 0===e?void 0:e.flatMap(e=>{var t,a;const s=(null===e||void 0===e||null===(t=e.repository)||void 0===t?void 0:t.organization_display_name)||(null===e||void 0===e||null===(a=e.repository)||void 0===a?void 0:a.user_alias);return s||[]});return t&&0!==(null===t||void 0===t?void 0:t.length)?[...new Set(t)]:[]},resourceOptions(){return E(this.filteredSubtypes)},showPreRelease(){return this.$store.getters["prefs/get"](A["k"])}},methods:{hasAnnotation(e,t){var a,s;return!(null===(a=e.data)||void 0===a||!a[t]||"false"===(null===(s=e.data)||void 0===s?void 0:s[t]))},isPrerelease(e){const t=S.a.prerelease(e.version);return t&&"deprecated-api-versions"===e.name?!!t.includes("rc"):!!t},refresh(){this.category=null,this.keywords=[],this.organizations=[],this.searchQuery=null},resourceType(e){if(void 0===e)return null;const t=null===e||void 0===e?void 0:e.split(",");return(null===t||void 0===t?void 0:t.length)>1?"Multiple":"*"===e?"Global":e},isOfficial(e){var t,a;return(null===e||void 0===e||null===(t=e.repository)||void 0===t||null===(a=t.organization_name)||void 0===a?void 0:a.toLowerCase())===x["k"]},subtypeSignature(e){var t;return(null===(t=e.signatures)||void 0===t?void 0:t[0])||"unknown"}}},F=L,z=(a("4b1c"),a("d802")),N=Object(z["a"])(F,M,P,!1,null,"bd6d92b8",null),B=N.exports,q=a("9c6e"),Q={name:"Create",props:{mode:{type:String,default:b["t"]},value:{type:Object,default:()=>({})}},components:{AsyncButton:g["b"],Banner:f["a"],Loading:_["a"],Markdown:w["a"],Wizard:k["a"],PolicyGrid:B,Values:q["a"]},inject:["chartType"],mixins:[h["a"]],async fetch(){var e,t,a,s,i,o;this.errors=[],this.hasArtifactHub&&await this.getPackages(),this.value.apiVersion=`${null===(e=this.schema)||void 0===e||null===(t=e.attributes)||void 0===t?void 0:t.group}.${null===(a=this.schema)||void 0===a||null===(s=a.attributes)||void 0===s?void 0:s.version}`,this.value.kind=null===(i=this.schema)||void 0===i||null===(o=i.attributes)||void 0===o?void 0:o.kind},data(){return{errors:[],bannerTitle:null,loadingPackages:!1,packages:null,repository:null,type:null,typeModule:null,version:null,chartValues:{policy:{},questions:{}},yamlValues:"",hasCustomPolicy:!1,yamlOption:x["w"].FORM,stepPolicies:{hidden:!1,name:"policies",label:"Policies",ready:!1,weight:99},stepReadme:{hidden:!1,name:"readme",label:"Readme",ready:!0,weight:98},stepValues:{name:"values",label:"Values",ready:!0,weight:97}}},computed:{isAirgap(){return this.$store.getters["kubewarden/airGapped"]},isCreate(){return this.realMode===b["t"]},isSelected(){return!!this.type},customPolicy(){return"custom"===this.type},canFinish(){var e,t,a;return this.yamlOption===x["w"].YAML||!(null===(e=this.chartValues)||void 0===e||null===(t=e.policy)||void 0===t||null===(a=t.spec)||void 0===a||!a.module)&&this.hasRequired},hasArtifactHub(){return this.value.artifactHubWhitelist},hasRequired(){var e;if(!c()(null===(e=this.chartValues)||void 0===e?void 0:e.policy)&&this.chartValues.policy.spec){var t,a,s;const{rules:e,settings:i}=this.chartValues.policy.spec,o=["apiVersions","operations","resources"],r=this.acceptedValues(e,o),l=null===(t=this.chartValues)||void 0===t||null===(a=t.questions)||void 0===a||null===(s=a.questions)||void 0===s?void 0:s.map(e=>{if(e.required)return e.variable}).filter(Boolean),n=this.acceptedValues(i,l);if(!c()(r)&&(c()(l)||!c()(n)))return!0}return!1},hideArtifactHubBanner(){return this.$store.getters["kubewarden/hideBannerArtifactHub"]||!!this.hasArtifactHub||!!this.isAirgap},hideAirgapBanner(){return!this.isAirgap||this.$store.getters["kubewarden/hideBannerAirgapPolicy"]},packageValues(){var e,t,a;return null!==(e=this.type)&&void 0!==e&&null!==(t=e.repository)&&void 0!==t&&t.url?null===(a=this.packages)||void 0===a?void 0:a.find(e=>{var t;return(null===(t=e.repository)||void 0===t?void 0:t.url)===this.type.repository.url}):null},steps(){const e=[];return e.push(this.stepPolicies,this.stepReadme,this.stepValues),e.sort((e,t)=>t.weight-e.weight)}},methods:{acceptedValues(e,t){if(c()(t))return null;let a;return a=Array.isArray(e)?e.find(e=>this.checkProperties(e,t)):this.checkProperties(e,t),a},checkProperties(e,t){const a=[];if(!c()(t)){for(const s of t.values())c()(e[s])||a.push(s);if(t&&p()(a,t))return e}return null},async closeBanner(e,t=0){const a=await this.$store.dispatch("kubewarden/"+e,!0);0===t&&"error"===(null===a||void 0===a?void 0:a.type)&&500===(null===a||void 0===a?void 0:a.status)&&await this.close(t+1)},async createNamespace(e){const t=this.$store.getters["cluster/all"](v["n"]),a={type:v["n"],metadata:{name:e},disableOpenApiValidation:!1},s=null===t||void 0===t?void 0:t.find(t=>{var a;return(null===t||void 0===t||null===(a=t.metadata)||void 0===a?void 0:a.name)===e});if(!s){const e=await this.$store.dispatch("cluster/create",a);try{await e.save()}catch(i){this.errors.push(i)}}},async addArtifactHub(e){try{this.loadingPackages=!0,await this.value.updateWhitelist("artifacthub.io"),await this.getPackages(),e(!0),this.loadingPackages=!1}catch(t){Object(V["a"])({error:t,store:this.$store}),e(!1),this.loadingPackages=!1}},done(){var e;this.$router.replace({name:"c-cluster-product-resource",params:{cluster:this.$route.params.cluster,product:x["k"],resource:null===(e=this.schema)||void 0===e?void 0:e.id}})},async finish(e){try{var t;let o;var a,s,i;if(this.yamlOption===x["w"].YAML)o=r.a.load(this.yamlValues);else o=null!==(a=this.chartValues)&&void 0!==a&&a.policy?this.chartValues.policy:r.a.load(this.yamlValues);if(Object(C["a"])(o),n()(this.value,o),this.chartType===x["f"].ADMISSION_POLICY&&null!==(t=this.chartValues)&&void 0!==t&&t.isNamespaceNew)await this.createNamespace(null===(s=this.value)||void 0===s||null===(i=s.metadata)||void 0===i?void 0:i.namespace);await this.save(e)}catch(o){Object(V["a"])({error:o,store:this.$store}),console.error("Error creating policy",o)}},async getPackages(){if(this.repository=await this.value.artifactHubRepo(),this.repository&&this.repository.packages.length>0){const t=this.repository.packages.map(e=>this.packageDetails(e));try{const e=await Promise.all(t);this.packages=e.filter(e=>{var t;return"true"!==(null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t["kubewarden/hidden-ui"])})}catch(e){Object(V["a"])({error:e,store:this.$store}),console.warn("Error fetching packages",e)}}},async packageDetails(e){try{return await this.value.artifactHubPackage(e)}catch(t){}},policyQuestions(){var e;const t=structuredClone(x["d"]);if("custom"===this.type){const e={spec:{contextAwareResources:[]}};return n()(t,e),Object(y["k"])(this.chartValues,"policy",t),void(this.yamlValues=Object(m["d"])(t))}const a=this.packages.find(e=>{var t,a,s;return(null===(t=e.repository)||void 0===t?void 0:t.url)===(null===(a=this.type)||void 0===a||null===(s=a.repository)||void 0===s?void 0:s.url)}),s=this.value.parsePackageMetadata(null===a||void 0===a||null===(e=a.data)||void 0===e?void 0:e[O["a"].QUESTIONS]),i=`${a.repository.name}/${a.name}/${a.version}`,o=(e,t)=>{var s;const i=this.value.parsePackageMetadata(null===a||void 0===a||null===(s=a.data)||void 0===s?void 0:s[e]);return void 0!==(null===i||void 0===i?void 0:i[t])?i[t]:i||[]},r=e=>{var t;return void 0!==(null===a||void 0===a||null===(t=a.data)||void 0===t?void 0:t[e])&&JSON.parse(a.data[e])},l={apiVersion:this.value.apiVersion,kind:this.value.kind,metadata:{annotations:{[x["b"]]:i}},spec:{module:a.containers_images[0].image,contextAwareResources:o(O["a"].CONTEXT_AWARE,"contextAwareResources"),rules:o(O["a"].RULES,"rules"),mutating:r(O["a"].MUTATION)}};n()(t,l),Object(y["k"])(this.chartValues,"policy",t),this.yamlValues=Object(m["d"])(t),s&&Object(y["k"])(this.chartValues,"questions",s)},reset(e){this.$nextTick(()=>{var t;if((null===(t=e.step)||void 0===t?void 0:t.name)===this.stepPolicies.name){const e=["errors","bannerTitle","type","typeModule","version","hasCustomPolicy"];e.forEach(e=>{this[e]=null}),this.stepPolicies.ready=!1,this.stepReadme.hidden=!1,this.chartValues={policy:{},questions:{}},this.yamlOption=x["w"].FORM,this.yamlValues=""}})},selectType(e){var t,a;this.type=e;const s="custom"===e;s?(this.stepReadme.hidden=!0,this.$set(this,"hasCustomPolicy",!0)):(this.packageValues?this.stepReadme.hidden=!1:this.stepReadme.hidden=!0,this.$set(this,"hasCustomPolicy",!1)),this.policyQuestions(),this.stepPolicies.ready=!0,this.$refs.wizard.next(),this.bannerTitle=s?"Custom Policy":null===e||void 0===e?void 0:e.display_name,this.typeModule=null===(t=this.chartValues)||void 0===t||null===(a=t.policy)||void 0===a?void 0:a.spec.module}}},H=Q,I=(a("7b91"),Object(z["a"])(H,s,i,!1,null,"db2b144a",null));t["a"]=I.exports},8737:function(e,t,a){var s=a("7089");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a("0ed3").default;i("dec66a40",s,!0,{sourceMap:!1,shadowMode:!1})},"8b5f":function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var s=a("330a"),i=a.n(s),o=a("b506"),r=a.n(o);function l(e){return Object.keys(e).forEach(t=>{const a=e[t];void 0===a||null===a||""===a||Array.isArray(a)&&!a.length?delete e[t]:r()(a)&&(l(a),i()(a)&&delete e[t])}),i()(e)?null:e}},"8d6f":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("CruResource",{attrs:{resource:e.value,mode:e.realMode,"can-yaml":!1,"done-route":e.doneRoute,errors:e.errors,"validation-passed":e.validationPassed},on:{finish:e.finish,error:t=>e.errors=t}},[t("Values",{attrs:{value:e.value,"chart-values":e.chartValues,mode:e.mode},on:{"validation-passed":e.handleValidationPassed}})],1)},i=[],o=a("1fcb"),r=a.n(o),l=a("da25"),n=a("305c"),d=a("fd5f"),c=a("3ca3"),u=function(){var e=this,t=e._self._c;return e.$fetchState.pending?t("Loading",{attrs:{mode:"relative"}}):t("div",{staticClass:"scroll__container"},[e.isCreate||e.isEdit?t("div",{staticClass:"step__values__controls"},[t("ButtonGroup",{attrs:{"data-testid":"kw-policy-server-config-yaml-option",options:e.YAML_OPTIONS,"inactive-class":"bg-disabled btn-sm","active-class":"bg-primary btn-sm"},model:{value:e.yamlOption,callback:function(t){e.yamlOption=t},expression:"yamlOption"}})],1):e._e(),t("div",{staticClass:"scroll__content"},[e.showForm?[t("Tabbed",{ref:"tabs",staticClass:"step__values__content",attrs:{"side-tabs":!0},on:{changed:function(t){return e.tabChanged(t)}}},[t(e.valuesComponent,{tag:"component",attrs:{resource:e.value,mode:e.mode},on:{"validation-passed":e.handleValidationPassed},model:{value:e.values,callback:function(t){e.values=t},expression:"values"}})],1)]:!e.isCreate&&!e.isEdit||e.showForm?e._e():[t("YamlEditor",{ref:"yaml",staticClass:"step__values__content",attrs:{"data-testid":"kw-policy-server-config-yaml-editor",scrolling:!0,"initial-yaml-values":e.originalYamlValues,"editor-mode":e.editorMode,"hide-preview-buttons":!0},on:{onChanges:e.updateYamlValues},model:{value:e.currentYamlValues,callback:function(t){e.currentYamlValues=t},expression:"currentYamlValues"}})],t("ResourceCancelModal",{ref:"cancelModal",attrs:{"data-testid":"kw-policy-server-config-yaml-cancel","is-cancel-modal":!1,"is-form":!0},on:{"cancel-cancel":function(t){e.preYamlOption=e.yamlOption},"confirm-cancel":function(t){e.yamlOption=e.preYamlOption}}})],2)])},p=[],h=a("330a"),v=a.n(h),b=a("7838"),m=a.n(b),y=a("907c"),f=a("c5e6"),g=a("cc2d"),_=a("15ca"),w=a("6860"),k=a("0cb2"),x=a("870a"),C=a("90cd"),V={name:"Values",props:{mode:{type:String,default:l["t"]},chartValues:{type:Object,default:()=>{}},value:{type:Object,required:!0}},components:{ButtonGroup:g["a"],Loading:_["a"],ResourceCancelModal:w["a"],Tabbed:k["a"],YamlEditor:x["b"]},async fetch(){const e=this.generateYaml();this.currentYamlValues=e,this.originalYamlValues=e;try{await this.loadValuesComponent()}catch(t){console.error("Error loading values component: "+t)}},data(){return{YAML_OPTIONS:C["y"],currentYamlValues:"",originalYamlValues:"",showForm:!0,configValues:null,showQuestions:!0,showValuesComponent:!1,valuesComponent:null,preYamlOption:C["w"].FORM,yamlOption:C["w"].FORM,values:this.chartValues}},watch:{yamlOption(e,t){switch(e){case C["w"].FORM:this.showForm=!0;break;case C["w"].YAML:t===C["w"].FORM&&(this.currentYamlValues=this.generateYaml(),this.updateYamlValues()),this.showForm=!1;break}}},computed:{editorMode(){return x["a"].EDIT_CODE},isCreate(){return this.mode===l["t"]},isEdit(){return this.mode===l["v"]}},methods:{generateYaml(){var e;const t=this.$store.getters["cluster/all"](y["x"]),a=Object(f["b"])(t,null===(e=this.value)||void 0===e?void 0:e.type,this.chartValues),s=a.split("\n"),i=s.filter(e=>!e.includes("Error loading schema for array")),o=i.join("\n");return o},async loadValuesComponent(){this.value.haveComponent("kubewarden/policy-server")&&(this.valuesComponent=this.value.importComponent("kubewarden/policy-server"),await this.valuesComponent(),this.showValuesComponent=!0)},tabChanged(){window.scrollTop=0},updateYamlValues(){if(!v()(this.currentYamlValues)){const e=m.a.load(this.currentYamlValues);e&&r()(this.chartValues,e)}},handleValidationPassed(e){this.$emit("validation-passed",e)}}},O=V,M=(a("71ed"),a("d802")),P=Object(M["a"])(O,u,p,!1,null,"5ae37dc8",null),Y=P.exports,S={components:{CruResource:d["a"],Values:Y},mixins:[n["a"]],props:{mode:{type:String,default:l["v"]},realMode:{type:String,default:l["v"]},value:{type:Object,required:!0}},data(){return{errors:[],chartValues:this.value,validationPassed:!0}},created(){this.isCreate&&r()(this.chartValues,structuredClone(c["DEFAULT_POLICY_SERVER"]))},computed:{isCreate(){return this.realMode===l["t"]}},methods:{handleValidationPassed(e){this.validationPassed=e},async finish(e){["pod","container"].forEach(e=>{var t,a,s,i,o,r,l,n,d,c,u,p;null!==(t=this.chartValues)&&void 0!==t&&null!==(a=t.spec)&&void 0!==a&&null!==(s=a.securityContexts)&&void 0!==s&&null!==(i=s[e])&&void 0!==i&&i.seccompProfile&&!Object.keys(null===(o=this.chartValues)||void 0===o||null===(r=o.spec)||void 0===r||null===(l=r.securityContexts)||void 0===l||null===(n=l[e])||void 0===n?void 0:n.seccompProfile).length&&(null===(d=this.chartValues)||void 0===d||(null===(c=d.spec)||void 0===c||(null===(u=c.securityContexts)||void 0===u||(null===(p=u[e])||void 0===p||delete p.seccompProfile))))});try{await this.save(e)}catch(t){this.errors.push(t)}}}},A=S,j=Object(M["a"])(A,s,i,!1,null,null,null);t["default"]=j.exports},"9c6e":function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;return e.$fetchState.pending?t("Loading",{attrs:{mode:"relative"}}):t("div",[e.isCreate||e.isEdit?t("div",{staticClass:"step__values__controls"},[t("ButtonGroup",{attrs:{"data-testid":"kw-policy-config-yaml-option",options:e.YAML_OPTIONS,"inactive-class":"bg-disabled btn-sm","active-class":"bg-primary btn-sm"},model:{value:e.yamlOption,callback:function(t){e.yamlOption=t},expression:"yamlOption"}})],1):e._e(),t("div",{staticClass:"scroll__container"},[t("div",{staticClass:"scroll__content"},[e.showForm?[t("Tabbed",{ref:"tabs",staticClass:"step__values__content",attrs:{"side-tabs":!0},on:{changed:function(t){return e.tabChanged(t)}}},[e.valuesComponent?[t(e.valuesComponent,{tag:"component",attrs:{mode:e.mode,"custom-policy":e.customPolicy},model:{value:e.chartValues,callback:function(t){e.chartValues=t},expression:"chartValues"}})]:e._e()],2)]:!e.isCreate&&!e.isEdit||e.showForm?e._e():[t("YamlEditor",{ref:"yaml",staticClass:"step__values__content",attrs:{"data-testid":"kw-policy-config-yaml-editor",scrolling:!0,"initial-yaml-values":e.originalYamlValues,"editor-mode":e.editorMode,"hide-preview-buttons":!0},on:{onChanges:e.updateYamlValues},model:{value:e.currentYamlValues,callback:function(t){e.currentYamlValues=t},expression:"currentYamlValues"}})],t("ResourceCancelModal",{ref:"cancelModal",attrs:{"data-testid":"kw-policy-config-yaml-cancel","is-cancel-modal":!1,"is-form":!0},on:{"cancel-cancel":function(t){e.preYamlOption=e.yamlOption},"confirm-cancel":function(t){e.yamlOption=e.preYamlOption}}})],2)])])},i=[],o=a("330a"),r=a.n(o),l=a("da25"),n=a("907c"),d=a("c5e6"),c=a("e24b"),u=a("cc2d"),p=a("15ca"),h=a("6860"),v=a("0cb2"),b=a("870a"),m=a("90cd"),y={name:"Values",props:{mode:{type:String,default:l["C"]},chartValues:{type:Object,default:()=>{}},customPolicy:{type:Boolean,default:!1},value:{type:Object,required:!0},yamlValues:{type:String,default:""}},components:{ButtonGroup:u["a"],Loading:p["a"],ResourceCancelModal:h["a"],Tabbed:v["a"],YamlEditor:b["b"]},async fetch(){var e,t,a;if(r()(this.chartValues.questions)&&null!==(e=this.chartValues)&&void 0!==e&&null!==(t=e.policy)&&void 0!==t&&null!==(a=t.spec)&&void 0!==a&&a.settings)try{const e=await this.value.artifactHubPackageVersion();if(e&&!e.error){var s;const t=this.value.parsePackageMetadata(null===e||void 0===e||null===(s=e.data)||void 0===s?void 0:s["kubewarden/questions-ui"]);t&&Object(c["k"])(this.chartValues,"questions",t)}}catch(i){console.warn("Unable to fetch chart questions: "+i)}try{this.version=this.$store.getters["catalog/version"]({repoType:"cluster",repoName:"kubewarden",chartName:m["h"].CONTROLLER}),await this.loadValuesComponent()}catch(i){console.warn("Unable to fetch Version: "+i)}this.generateYaml()},data(){return{YAML_OPTIONS:m["y"],currentYamlValues:"",originalYamlValues:"",showForm:!0,valuesComponent:null,preYamlOption:m["w"].FORM,yamlOption:m["w"].FORM}},mounted(){var e,t,a,s,i;this.mode===l["t"]&&"ClusterAdmissionPolicy"===(null===(e=this.chartValues)||void 0===e||null===(t=e.policy)||void 0===t?void 0:t.kind)&&(null!==(a=this.chartValues)&&void 0!==a&&null!==(s=a.policy)&&void 0!==s&&null!==(i=s.spec)&&void 0!==i&&i.namespaceSelector||(this.chartValues.policy.spec.namespaceSelector={}),this.chartValues.policy.spec.namespaceSelector.matchExpressions=[m["s"]])},watch:{yamlOption(e,t){switch(e){case m["w"].FORM:this.showForm=!0,this.$emit("editor",e);break;case m["w"].YAML:t===m["w"].FORM&&(this.currentYamlValues=Object(d["d"])(this.chartValues.policy),this.updateYamlValues()),this.showForm=!1,this.$emit("editor",e);break}}},computed:{editorMode(){return b["a"].EDIT_CODE},isCreate(){return this.mode===l["t"]},isEdit(){return this.mode===l["v"]}},methods:{generateYaml(){var e,t;const a=this.$store.getters["cluster/all"](n["x"]),s=null!==(e=this.chartValues)&&void 0!==e&&e.policy?structuredClone(this.chartValues.policy):this.value;var i;null!==(t=this.yamlValues)&&void 0!==t&&t.length?this.currentYamlValues=this.yamlValues:this.currentYamlValues=Object(d["b"])(a,null===(i=this.value)||void 0===i?void 0:i.type,s)},async loadValuesComponent(){var e,t;null!==(e=this.value)&&void 0!==e&&e.haveComponent("kubewarden/admission")&&(this.valuesComponent=null===(t=this.value)||void 0===t?void 0:t.importComponent("kubewarden/admission"),await this.valuesComponent())},tabChanged(){window.scrollTop=0},updateYamlValues(){this.$emit("updateYamlValues",this.currentYamlValues)}}},f=y,g=(a("546b"),a("d802")),_=Object(g["a"])(f,s,i,!1,null,"d467cb12",null);t["a"]=_.exports},a102:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return e.isCreate?t("Create",{attrs:{value:e.value,mode:e.mode}}):t("CruResource",{attrs:{resource:e.value,mode:e.realMode,"can-yaml":!1},on:{finish:e.finish}},[t("Config",{attrs:{value:e.value,mode:e.realMode},on:{updateYamlValues:e.updateYamlValuesFromEdit}})],1)},i=[],o=a("7838"),r=a.n(o),l=a("da25"),n=a("305c"),d=a("fd5f"),c=a("8b5f"),u=a("e9a3"),p=a("666d"),h=a("81fb"),v={name:"ClusterAdmissionPolicy",props:{value:{type:Object,required:!0},mode:{type:String,default:l["v"]},realMode:{type:String,default:l["v"]}},components:{CruResource:d["a"],Config:p["a"],Create:h["a"]},mixins:[n["a"]],provide(){return{chartType:this.value.type,realMode:this.realMode}},computed:{isCreate(){return this.realMode===l["t"]}},methods:{async finish(e){try{Object(c["a"])(this.value),await this.save(e)}catch(t){Object(u["a"])({error:t,store:this.$store})}},updateYamlValuesFromEdit(e){const t=r.a.load(e);Object(c["a"])(t),Object.assign(this.value,t)}}},b=v,m=a("d802"),y=Object(m["a"])(b,s,i,!1,null,null,null);t["default"]=y.exports},a4ef:function(e,t,a){var s=a("5eaa");t=s(!1),t.push([e.i,"[data-v-bd6d92b8] .vs__selected{height:auto!important}.step__policies[data-v-bd6d92b8]{display:flex;flex-direction:column;flex:1;overflow-x:hidden}.step__policies .spacer[data-v-bd6d92b8]{line-height:2}.filter[data-v-bd6d92b8]{display:flex;flex-direction:row;justify-content:flex-end;align-self:flex-end;align-items:center}.filter>*[data-v-bd6d92b8]{margin:10px;max-width:33%}.filter[data-v-bd6d92b8]>:first-child{margin-left:0}.filter[data-v-bd6d92b8]>:last-child{margin-right:0}.filter__category[data-v-bd6d92b8]{min-width:200px;height:unset}.filter__reset[data-v-bd6d92b8],.filter__search[data-v-bd6d92b8]{height:61px}@media only screen and (max-width:1281px){.filter[data-v-bd6d92b8]{width:100%}}@media only screen and (min-width:1281px){.filter[data-v-bd6d92b8]{width:75%}}.grid[data-v-bd6d92b8]{display:flex;justify-content:flex-start;flex-wrap:wrap;margin:0 -10px}.grid .custom[data-v-bd6d92b8]{height:110px}.grid .subtype[data-v-bd6d92b8]{height:auto}@media only screen and (min-width:480px){.grid .subtype[data-v-bd6d92b8]{width:100%}}@media only screen and (min-width:768px){.grid .subtype[data-v-bd6d92b8]{width:calc(50% - 20px)}}@media only screen and (min-width:992px){.grid .subtype[data-v-bd6d92b8]{width:calc(33.33333% - 20px)}}@media only screen and (min-width:1281px){.grid .subtype[data-v-bd6d92b8]{width:calc(25% - 20px)}}@media only screen and (min-width:1600px){.grid .subtype__label[data-v-bd6d92b8]{max-width:100%}.grid .subtype h4[data-v-bd6d92b8]{white-space:nowrap}}.grid .disabled[data-v-bd6d92b8]{opacity:.5;cursor:not-allowed}.subtype__metadata[data-v-bd6d92b8]{height:100%;display:flex;flex-direction:column;justify-content:space-between;padding:5px 10px}.subtype__label[data-v-bd6d92b8]{max-width:205px}.subtype__label h4[data-v-bd6d92b8]{white-space:normal}.subtype__badge[data-v-bd6d92b8]{background-color:var(--darker);padding:4px 5px}.subtype__body[data-v-bd6d92b8]{height:auto}.subtype__footer[data-v-bd6d92b8]{display:flex;flex-direction:row;justify-content:space-between;margin-top:10px}.subtype__aware[data-v-bd6d92b8],.subtype__mutation[data-v-bd6d92b8]{border:1px solid var(--border);padding:0 5px;margin-left:2px}.subtype__left[data-v-bd6d92b8],.subtype__right[data-v-bd6d92b8]{display:flex;flex-direction:row}.subtype__left[data-v-bd6d92b8]{align-items:flex-start}.subtype__right[data-v-bd6d92b8]{align-items:flex-end}.subtype__icon[data-v-bd6d92b8]{width:20px}",""]),e.exports=t},e1aa:function(e,t,a){var s=a("a4ef");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a("0ed3").default;i("7da1d330",s,!0,{sourceMap:!1,shadowMode:!1})},e509:function(e,t,a){var s=a("5eaa");t=s(!1),t.push([e.i,"[data-v-db2b144a] .step-container{height:auto}[data-v-db2b144a] .header .step-sequence{display:block}[data-v-db2b144a] .header .step-sequence .steps .divider{top:22px}[data-v-db2b144a] .controls-row{position:relative;width:auto}[data-v-db2b144a] .controls-row .controls-steps{display:flex}[data-v-db2b144a] .custom{min-height:110px}[data-v-db2b144a] .subtype{height:110px;margin:10px;position:relative;border-radius:calc(var(--border-radius)*1.5);border:1px solid var(--border);text-decoration:none!important;color:var(--body-text)!important}[data-v-db2b144a] .subtype:hover:not(.disabled){box-shadow:0 0 30px var(--shadow);transition:box-shadow .1s ease-in-out;cursor:pointer;text-decoration:none!important}[data-v-db2b144a] .subtype__metadata{padding:10px}[data-v-db2b144a] .subtype__metadata__description,[data-v-db2b144a] .subtype__metadata__label{padding-right:20px}[data-v-db2b144a] .subtype__badge{position:absolute;right:0;top:0;padding:4px 5px;border-bottom-left-radius:var(--border-radius)}[data-v-db2b144a] .subtype__badge label{font-size:12px;line-height:12px;text-align:center;display:block;white-space:no-wrap;text-overflow:ellipsis;color:var(--app-rancher-accent-text);margin:0}[data-v-db2b144a] .subtype__label{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:4px;line-height:normal}[data-v-db2b144a] .subtype__description{margin-right:10px;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:3;line-clamp:3;overflow:hidden;text-overflow:ellipsis;color:var(--input-label)}.wizard[data-v-db2b144a]{position:relative;height:100%}",""]),e.exports=t}}]);
//# sourceMappingURL=kubewarden-1.0.12.umd.min.edit.js.map