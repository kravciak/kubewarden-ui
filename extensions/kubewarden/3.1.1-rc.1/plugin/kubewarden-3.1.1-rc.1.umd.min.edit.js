(("undefined"!==typeof self?self:this)["webpackChunkkubewarden_3_1_1_rc_1"]=("undefined"!==typeof self?self:this)["webpackChunkkubewarden_3_1_1_rc_1"]||[]).push([[739],{1056:function(e,t,a){var s=a(23072);s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.id,s,""]]),s.locals&&(e.exports=s.locals);var o=a(74825).A;o("0e38ba29",s,!0,{sourceMap:!1,shadowMode:!1})},5089:function(e,t,a){"use strict";a.r(t);var s=a(36758),o=a.n(s),r=a(40935),i=a.n(r),n=i()(o());n.push([e.id,"[data-v-055dee5c] .cru__footer{z-index:1}",""]),t["default"]=n},13346:function(e,t,a){"use strict";a.r(t);var s=a(36758),o=a.n(s),r=a(40935),i=a.n(r),n=i()(o());n.push([e.id,".step__values__controls[data-v-46245f73]{display:flex;margin-bottom:15px}.step__values__controls[data-v-46245f73]>:not(:last-of-type){margin-right:10px}.step__values__content[data-v-46245f73],.step__values__controls--spacer[data-v-46245f73]{flex:1}.step__values__content[data-v-46245f73] .tab-container{overflow:auto}",""]),t["default"]=n},15182:function(e,t,a){"use strict";a.d(t,{A:function(){return y}});var s=a(9274);const o={class:"policy-info-panel",style:"--banner-top-offset: 0px"},r={class:"slideIn__header"},i={key:0,class:"policy-info-content"},n={class:"policy-header pb-10"},l={class:"slideIn__header__buttons"},c={class:"policy-title mt-20"},d={class:"policy-info-title"};function u(e,t,a,u,p,h){const m=(0,s.resolveComponent)("ChartReadme");return(0,s.openBlock)(),(0,s.createElementBlock)("div",o,[p.showSlideIn?((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:0,class:"glass","data-testid":"extension-details-bg",onClick:t[0]||(t[0]=e=>h.hide())})):(0,s.createCommentVNode)("",!0),(0,s.createElementVNode)("div",{class:(0,s.normalizeClass)(["slideIn",{hide:!1,slideIn__show:p.showSlideIn}]),"data-testid":"extension-details"},[(0,s.createElementVNode)("div",r,[a.packageValues?((0,s.openBlock)(),(0,s.createElementBlock)("div",i,[(0,s.createElementVNode)("div",n,[(0,s.createElementVNode)("div",l,[(0,s.createElementVNode)("button",{class:"btn btn-sm role-link",onClick:t[1]||(t[1]=(...e)=>h.hide&&h.hide(...e))},[(0,s.createElementVNode)("span",null,(0,s.toDisplayString)(e.t("generic.close")),1),t[2]||(t[2]=(0,s.createElementVNode)("i",{class:"icon icon-chevron-right"},null,-1))])])]),(0,s.createElementVNode)("div",c,[(0,s.createElementVNode)("h2",d,(0,s.toDisplayString)(a.packageValues.display_name),1)]),(0,s.createVNode)(m,{class:"mt-20","version-info":a.packageValues},null,8,["version-info"])])):(0,s.createCommentVNode)("",!0)])],2)])}var p=a(65359),h=a(60724),m={props:{packageValues:{type:Object,required:!0}},components:{ChartReadme:h.A},data(){return{showSlideIn:!1,info:void 0,infoVersion:void 0,versionInfo:void 0,versionError:void 0,headerBannerSize:0}},computed:{...(0,p.L8)({theme:"prefs/theme"}),applyDarkModeBg(){return"dark"===this.theme?{"dark-mode":!0}:{}}},methods:{show(){this.showSlideIn=!0},hide(){this.showSlideIn=!1}}},f=(a(71167),a(47433));const v=(0,f.A)(m,[["render",u],["__scopeId","data-v-7158a949"]]);var y=v},17919:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return y}});var s=a(9274);function o(e,t,a,o,r,i){const n=(0,s.resolveComponent)("Create"),l=(0,s.resolveComponent)("Config"),c=(0,s.resolveComponent)("CruResource");return i.isCreate?((0,s.openBlock)(),(0,s.createBlock)(n,{key:0,value:a.value,mode:a.mode},null,8,["value","mode"])):((0,s.openBlock)(),(0,s.createBlock)(c,{key:1,resource:a.value,mode:a.realMode,"can-yaml":!1,onFinish:i.finish},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(l,{value:a.value,mode:a.realMode,onUpdateYamlValues:i.updateYamlValuesFromEdit},null,8,["value","mode","onUpdateYamlValues"])])),_:1},8,["resource","mode","onFinish"]))}var r=a(20246),i=a.n(r),n=a(14220),l=a(91825),c=a(82996),d=a(21426),u=a(63875),p=a(80819),h=a(98267),m={name:"AdmissionPolicy",props:{value:{type:Object,required:!0},mode:{type:String,default:n.G5},realMode:{type:String,default:n.G5}},components:{CruResource:c.A,Config:p.A,Create:h.A},mixins:[l.A],provide(){return{chartType:this.value.type,realMode:this.realMode}},computed:{isCreate(){return this.realMode===n.YQ}},methods:{async finish(e){try{(0,d.k)(this.value),await this.save(e)}catch(t){(0,u.q)({error:t,store:this.$store})}},updateYamlValuesFromEdit(e){const t=i().load(e);(0,d.k)(t),Object.assign(this.value,t)}}},f=(a(77680),a(47433));const v=(0,f.A)(m,[["render",o],["__scopeId","data-v-7064b576"]]);var y=v},18823:function(e,t,a){"use strict";a.d(t,{A:function(){return A}});var s=a(9274);const o={key:1},r={key:0,class:"step__values__controls"},i={class:"scroll__container"},n={class:"scroll__content"};function l(e,t,a,l,c,d){const u=(0,s.resolveComponent)("Loading"),p=(0,s.resolveComponent)("ButtonGroup"),h=(0,s.resolveComponent)("Tabbed"),m=(0,s.resolveComponent)("YamlEditor"),f=(0,s.resolveComponent)("ResourceCancelModal");return e.$fetchState.pending?((0,s.openBlock)(),(0,s.createBlock)(u,{key:0,mode:"relative"})):((0,s.openBlock)(),(0,s.createElementBlock)("div",o,[d.isCreate||d.isEdit?((0,s.openBlock)(),(0,s.createElementBlock)("div",r,[(0,s.createVNode)(p,{value:c.yamlOption,"onUpdate:value":t[0]||(t[0]=e=>c.yamlOption=e),"data-testid":"kw-policy-config-yaml-option",options:c.YAML_OPTIONS,"inactive-class":"bg-disabled btn-sm","active-class":"bg-primary btn-sm"},null,8,["value","options"])])):(0,s.createCommentVNode)("",!0),(0,s.createElementVNode)("div",i,[(0,s.createElementVNode)("div",n,[c.showForm?((0,s.openBlock)(),(0,s.createBlock)(h,{key:0,ref:"tabs","side-tabs":!0,class:"step__values__content",onChanged:t[1]||(t[1]=e=>d.tabChanged(e))},{default:(0,s.withCtx)((()=>[c.valuesComponent?((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(c.valuesComponent),{key:0,value:a.chartValues,mode:a.mode,"custom-policy":a.customPolicy},null,8,["value","mode","custom-policy"])):(0,s.createCommentVNode)("",!0)])),_:1},512)):!d.isCreate&&!d.isEdit||c.showForm?(0,s.createCommentVNode)("",!0):((0,s.openBlock)(),(0,s.createBlock)(m,{key:1,ref:"yaml",value:c.currentYamlValues,"onUpdate:value":t[2]||(t[2]=e=>c.currentYamlValues=e),"data-testid":"kw-policy-config-yaml-editor",class:"step__values__content",scrolling:!0,"initial-yaml-values":c.originalYamlValues,"editor-mode":d.editorMode,"hide-preview-buttons":!0,onOnChanges:d.updateYamlValues},null,8,["value","initial-yaml-values","editor-mode","onOnChanges"])),(0,s.createVNode)(f,{ref:"cancelModal","data-testid":"kw-policy-config-yaml-cancel","is-cancel-modal":!1,"is-form":!0,onCancelCancel:t[3]||(t[3]=e=>c.preYamlOption=c.yamlOption),onConfirmCancel:t[4]||(t[4]=e=>c.yamlOption=c.preYamlOption)},null,512)])])]))}var c=a(3514),d=a.n(c),u=a(14220),p=a(35664),h=a(52946),m=a(76978),f=a(17925),v=a(84409),y=a(49521),b=a(9740),g=a(36143),k=a(79442),w=a(4364),_={name:"Values",props:{mode:{type:String,default:u.nW},chartValues:{type:Object,default:()=>{}},customPolicy:{type:Boolean,default:!1},value:{type:Object,required:!0},yamlValues:{type:String,default:""}},components:{ButtonGroup:f.A,Loading:v.A,ResourceCancelModal:y.A,Tabbed:b.A,YamlEditor:g.A},async fetch(){if(d()(this.chartValues.questions)&&this.chartValues?.policy?.spec?.settings)try{const e=await this.value.artifactHubPackageVersion();if(e&&!e.error){const t=this.value.parsePackageMetadata(e?.data?.["kubewarden/questions-ui"]);t&&(0,m.hZ)(this.chartValues,"questions",t)}}catch(e){w.warn(`Unable to fetch chart questions: ${e}`)}try{this.version=this.$store.getters["catalog/version"]({repoType:"cluster",repoName:"kubewarden",chartName:k.j6.CONTROLLER}),this.loadValuesComponent()}catch(e){w.warn(`Unable to fetch Version: ${e}`)}this.generateYaml()},data(){return{YAML_OPTIONS:k.Nv,currentYamlValues:"",originalYamlValues:"",showForm:!0,valuesComponent:null,preYamlOption:k.FU.FORM,yamlOption:k.FU.FORM}},mounted(){this.mode===u.YQ&&"ClusterAdmissionPolicy"===this.chartValues?.policy?.kind&&(this.chartValues?.policy?.spec?.namespaceSelector||(this.chartValues.policy.spec.namespaceSelector={}),this.chartValues.policy.spec.namespaceSelector.matchExpressions=[k.hQ])},watch:{yamlOption(e,t){switch(e){case k.FU.FORM:this.showForm=!0,this.$emit("editor",e);break;case k.FU.YAML:t===k.FU.FORM&&(this.currentYamlValues=(0,h.Kq)(this.chartValues.policy),this.updateYamlValues()),this.showForm=!1,this.$emit("editor",e);break}}},computed:{editorMode(){return g.j.EDIT_CODE},isCreate(){return this.mode===u.YQ},isEdit(){return this.mode===u.G5}},methods:{generateYaml(){const e=this.$store.getters["cluster/all"](p.yx),t=(0,s.toRaw)(this.chartValues.policy),a=t?structuredClone(t):this.value;this.yamlValues?.length?this.currentYamlValues=this.yamlValues:this.currentYamlValues=(0,h.mH)(e,this.value?.type,a)},loadValuesComponent(){if(this.value?.haveComponent("kubewarden/admission")){const e=this.value.importComponent("kubewarden/admission");this.valuesComponent=(0,s.defineAsyncComponent)(e)}},tabChanged(){window.scrollTop=0},updateYamlValues(){this.$emit("updateYamlValues",this.currentYamlValues)}}},V=(a(62338),a(47433));const C=(0,V.A)(_,[["render",l],["__scopeId","data-v-46245f73"]]);var A=C},21426:function(e,t,a){"use strict";a.d(t,{k:function(){return n}});var s=a(3514),o=a.n(s),r=a(41580),i=a.n(r);function n(e){return Object.keys(e).forEach((t=>{const a=e[t];void 0===a||null===a||""===a||Array.isArray(a)&&!a.length?delete e[t]:i()(a)&&(n(a),o()(a)&&delete e[t])})),o()(e)?null:e}},23072:function(e,t,a){"use strict";a.r(t);var s=a(36758),o=a.n(s),r=a(40935),i=a.n(r),n=i()(o());n.push([e.id,"[data-v-082bb2d8] .step-container{height:auto}.step__basic[data-v-082bb2d8]{display:flex;flex-direction:column;flex:1;overflow-x:hidden}.step__basic .spacer[data-v-082bb2d8]{line-height:2}.step__values__controls[data-v-082bb2d8]{display:flex;margin-bottom:15px}.step__values__controls[data-v-082bb2d8]>:not(:last-of-type){margin-right:10px}.step__values__content[data-v-082bb2d8],.step__values__controls--spacer[data-v-082bb2d8]{flex:1}.step__values__content[data-v-082bb2d8] .tab-container{overflow:auto}",""]),t["default"]=n},27271:function(e,t,a){"use strict";a.r(t);var s=a(36758),o=a.n(s),r=a(40935),i=a.n(r),n=i()(o());n.push([e.id,".content[data-v-6e3a9c09]{position:relative;z-index:1}.banner__title[data-v-6e3a9c09]{padding-top:10px;margin-bottom:10px;border-bottom:1px solid var(--border);min-height:60px}.banner__readme-button[data-v-6e3a9c09]{padding:0 7px 0 0}",""]),t["default"]=n},29889:function(e,t,a){var s=a(5089);s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.id,s,""]]),s.locals&&(e.exports=s.locals);var o=a(74825).A;o("425e148e",s,!0,{sourceMap:!1,shadowMode:!1})},39697:function(e,t,a){"use strict";a.r(t);var s=a(36758),o=a.n(s),r=a(40935),i=a.n(r),n=i()(o());n.push([e.id,'.policy-table-container[data-v-950c9ca8]{display:flex;flex-direction:column;gap:1rem;padding:1rem}.policy-table-actions[data-v-950c9ca8]{display:flex;justify-content:space-between;align-items:center}.filter[data-v-950c9ca8]{width:100%;display:grid;grid-template-rows:1fr;grid-template-columns:repeat(2,1fr) .25fr;grid-template-areas:"attributes search reset";gap:1rem}.filter[data-v-950c9ca8]>*{margin:.5rem 0}.filter__attributes[data-v-950c9ca8]{grid-area:attributes}.filter__search[data-v-950c9ca8]{grid-area:search}.filter__reset[data-v-950c9ca8]{grid-area:reset}.filter__reset p[data-v-950c9ca8]{line-height:1.5;white-space:wrap}[data-v-950c9ca8] tr:hover{cursor:pointer}',""]),t["default"]=n},58123:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return Y}});var s=a(9274);function o(e,t,a,o,r,i){const n=(0,s.resolveComponent)("Loading"),l=(0,s.resolveComponent)("Values"),c=(0,s.resolveComponent)("CruResource");return e.$fetchState.pending?((0,s.openBlock)(),(0,s.createBlock)(n,{key:0,mode:"relative"})):((0,s.openBlock)(),(0,s.createBlock)(c,{key:1,resource:a.value,mode:a.realMode,"can-yaml":!1,"done-route":e.doneRoute,errors:r.errors,"validation-passed":i.validationPassed,onFinish:i.finish,onError:t[0]||(t[0]=e=>r.errors=e)},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(l,{value:a.value,"chart-values":r.chartValues,mode:a.mode},null,8,["value","chart-values","mode"])])),_:1},8,["resource","mode","done-route","errors","validation-passed","onFinish"]))}var r=a(82451),i=a.n(r),n=a(14220),l=a(91825),c=a(82996),d=a(84409),u=a(18368),p=a(79442);const h={key:1,class:"scroll__container"},m={key:0,class:"step__values__controls"},f={class:"scroll__content"};function v(e,t,a,o,r,i){const n=(0,s.resolveComponent)("Loading"),l=(0,s.resolveComponent)("ButtonGroup"),c=(0,s.resolveComponent)("Tabbed"),d=(0,s.resolveComponent)("YamlEditor"),u=(0,s.resolveComponent)("ResourceCancelModal");return e.$fetchState.pending?((0,s.openBlock)(),(0,s.createBlock)(n,{key:0,mode:"relative"})):((0,s.openBlock)(),(0,s.createElementBlock)("div",h,[i.isCreate||i.isEdit?((0,s.openBlock)(),(0,s.createElementBlock)("div",m,[(0,s.createVNode)(l,{value:r.yamlOption,"onUpdate:value":t[0]||(t[0]=e=>r.yamlOption=e),"data-testid":"kw-policy-server-config-yaml-option",options:r.YAML_OPTIONS,"inactive-class":"bg-disabled btn-sm","active-class":"bg-primary btn-sm"},null,8,["value","options"])])):(0,s.createCommentVNode)("",!0),(0,s.createElementVNode)("div",f,[r.showForm?((0,s.openBlock)(),(0,s.createBlock)(c,{key:0,ref:"tabs","side-tabs":!0,class:"step__values__content",onChanged:t[2]||(t[2]=e=>i.tabChanged(e))},{default:(0,s.withCtx)((()=>[((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(r.valuesComponent),{value:r.values,"onUpdate:value":t[1]||(t[1]=e=>r.values=e),resource:a.value,mode:a.mode,onValidationPassed:i.handleValidationPassed},null,40,["value","resource","mode","onValidationPassed"]))])),_:1},512)):!i.isCreate&&!i.isEdit||r.showForm?(0,s.createCommentVNode)("",!0):((0,s.openBlock)(),(0,s.createBlock)(d,{key:1,ref:"yaml",value:r.currentYamlValues,"onUpdate:value":t[3]||(t[3]=e=>r.currentYamlValues=e),"data-testid":"kw-policy-server-config-yaml-editor",class:"step__values__content",scrolling:!0,"initial-yaml-values":r.originalYamlValues,"editor-mode":i.editorMode,"hide-preview-buttons":!0,onOnChanges:i.updateYamlValues},null,8,["value","initial-yaml-values","editor-mode","onOnChanges"])),(0,s.createVNode)(u,{ref:"cancelModal","data-testid":"kw-policy-server-config-yaml-cancel","is-cancel-modal":!1,"is-form":!0,onCancelCancel:t[4]||(t[4]=e=>r.preYamlOption=r.yamlOption),onConfirmCancel:t[5]||(t[5]=e=>r.yamlOption=r.preYamlOption)},null,512)])]))}var y=a(3514),b=a.n(y),g=a(20246),k=a.n(g),w=a(35664),_=a(52946),V=a(17925),C=a(49521),A=a(9740),x=a(36143),B=a(4364),O={name:"Values",props:{mode:{type:String,default:n.YQ},chartValues:{type:Object,default:()=>{}},value:{type:Object,required:!0}},components:{ButtonGroup:V.A,Loading:d.A,ResourceCancelModal:C.A,Tabbed:A.A,YamlEditor:x.A},async created(){const e=this.generateYaml();this.currentYamlValues=e,this.originalYamlValues=e;try{await this.loadValuesComponent()}catch(t){B.error(`Error loading values component: ${t}`)}},data(){return{YAML_OPTIONS:p.Nv,currentYamlValues:"",originalYamlValues:"",showForm:!0,configValues:null,showQuestions:!0,showValuesComponent:!1,valuesComponent:null,preYamlOption:p.FU.FORM,yamlOption:p.FU.FORM,values:this.chartValues}},watch:{yamlOption(e,t){switch(e){case p.FU.FORM:this.showForm=!0;break;case p.FU.YAML:t===p.FU.FORM&&(this.currentYamlValues=this.generateYaml(),this.updateYamlValues()),this.showForm=!1;break}}},computed:{editorMode(){return x.j.EDIT_CODE},isCreate(){return this.mode===n.YQ},isEdit(){return this.mode===n.G5}},methods:{generateYaml(){const e=this.$store.getters["cluster/all"](w.yx),t=(0,_.mH)(e,this.value?.type,this.chartValues),a=t.split("\n"),s=a.filter((e=>!e.includes("Error loading schema for array"))),o=s.join("\n");return o},async loadValuesComponent(){if(this.value.haveComponent("kubewarden/policy-server")){const e=this.value.importComponent("kubewarden/policy-server");this.valuesComponent=(0,s.defineAsyncComponent)(e),this.showValuesComponent=!0}},tabChanged(){window.scrollTop=0},updateYamlValues(){if(!b()(this.currentYamlValues)){const e=k().load(this.currentYamlValues);e&&i()(this.chartValues,e)}},handleValidationPassed(e){this.$emit("validation-passed",e)}}},E=(a(1056),a(47433));const P=(0,E.A)(O,[["render",v],["__scopeId","data-v-082bb2d8"]]);var S=P,M={components:{CruResource:c.A,Loading:d.A,Values:S},mixins:[l.A],props:{mode:{type:String,default:n.G5},realMode:{type:String,default:n.G5},value:{type:Object,required:!0}},async fetch(){const e=this.$store.getters["cluster/schemaFor"](p.$v.POLICY_SERVER);await e.fetchResourceFields()},data(){return{errors:[],chartValues:this.value}},created(){this.isCreate&&i()(this.chartValues,structuredClone(u.DEFAULT_POLICY_SERVER))},computed:{isCreate(){return this.realMode===n.YQ},validationPassed(){return!!this.chartValues?.metadata?.name}},methods:{async finish(e){const t=this.chartValues?.spec?.securityContexts;t&&["pod","container"].forEach((e=>{const a=t[e]?.seccompProfile;a&&0===Object.keys(a).length&&delete t[e].seccompProfile}));try{await this.save(e)}catch(a){this.errors.push(a)}}}};const N=(0,E.A)(M,[["render",o]]);var Y=N},62338:function(e,t,a){var s=a(13346);s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.id,s,""]]),s.locals&&(e.exports=s.locals);var o=a(74825).A;o("1dfa2bba",s,!0,{sourceMap:!1,shadowMode:!1})},65904:function(e,t,a){"use strict";a.r(t);var s=a(36758),o=a.n(s),r=a(40935),i=a.n(r),n=i()(o());n.push([e.id,"[data-v-7064b576] .cru__footer{z-index:1}",""]),t["default"]=n},67455:function(e,t,a){"use strict";a.r(t);var s=a(36758),o=a.n(s),r=a(40935),i=a.n(r),n=i()(o());n.push([e.id,"[data-v-7158a949] .btn-sm{padding:0 7px 0 0}.policy-info-panel[data-v-7158a949]{position:fixed;top:0;left:0;z-index:2;overflow-y:auto;--banner-top-offset:0}.policy-info-panel .glass[data-v-7158a949]{left:0;width:100%;opacity:0}.policy-info-panel .glass[data-v-7158a949],.policy-info-panel .slideIn[data-v-7158a949]{position:fixed;top:calc(54px + var(--banner-top-offset));height:calc(100% - 54px - var(--banner-top-offset));overflow-y:auto}.policy-info-panel .slideIn[data-v-7158a949]{border-left:var(--header-border-size) solid var(--header-border);right:-45%;background-color:var(--topmenu-bg);width:45%;display:flex;flex-direction:column;box-shadow:-3px 0 5px rgba(0,0,0,.1);padding:10px;transition:right .5s ease}.policy-info-panel .slideIn__header[data-v-7158a949]{text-transform:capitalize}.policy-info-panel .slideIn .policy-info-content[data-v-7158a949]{display:flex;flex-direction:column;overflow-y:auto}.policy-info-panel .slideIn h3[data-v-7158a949]{font-size:14px;margin:0;opacity:.7;text-transform:uppercase}.policy-info-panel .slideIn .policy-header[data-v-7158a949]{border-bottom:1px solid var(--border);display:flex;align-items:center}.policy-info-panel .slideIn .policy-header .policy-title[data-v-7158a949]{flex:1}.policy-info-panel .slideIn__header[data-v-7158a949]{display:flex;align-items:center;justify-content:space-between}.policy-info-panel .slideIn__header__buttons[data-v-7158a949]{display:flex;align-items:center}.policy-info-panel .slideIn__header__button[data-v-7158a949]{cursor:pointer;display:flex;align-items:center;justify-content:center}.policy-info-panel .slideIn__header__button>i[data-v-7158a949]{font-size:20px;opacity:.5}.policy-info-panel .slideIn__header__button[data-v-7158a949]:hover{background-color:var(--wm-closer-hover-bg)}.policy-info-panel .slideIn__show[data-v-7158a949]{right:0}",""]),t["default"]=n},68208:function(e,t,a){"use strict";a.r(t);var s=a(36758),o=a.n(s),r=a(40935),i=a.n(r),n=i()(o());n.push([e.id,"[data-v-558524f4] .header{display:none}[data-v-558524f4] .controls-row{position:sticky;width:auto}[data-v-558524f4] .controls-row .controls-steps{display:flex}[data-v-558524f4] .custom{min-height:110px}[data-v-558524f4] .subtype{height:110px;margin:10px;position:relative;border-radius:calc(var(--border-radius)*1.5);border:1px solid var(--border);text-decoration:none!important;color:var(--body-text)!important}[data-v-558524f4] .subtype:hover:not(.disabled){box-shadow:0 0 30px var(--shadow);transition:box-shadow .1s ease-in-out;cursor:pointer;text-decoration:none!important}[data-v-558524f4] .subtype .subtype__metadata{padding:10px}[data-v-558524f4] .subtype .subtype__metadata__description,[data-v-558524f4] .subtype .subtype__metadata__label{padding-right:20px}[data-v-558524f4] .subtype .subtype__badge{position:absolute;right:0;top:0;padding:4px 5px;border-bottom-left-radius:var(--border-radius)}[data-v-558524f4] .subtype .subtype__badge label{font-size:12px;line-height:12px;text-align:center;display:block;white-space:no-wrap;text-overflow:ellipsis;color:var(--app-rancher-accent-text);margin:0}[data-v-558524f4] .subtype .subtype__label{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:4px;line-height:normal}[data-v-558524f4] .subtype .subtype__description{margin-right:10px;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:3;line-clamp:3;overflow:hidden;text-overflow:ellipsis;color:var(--input-label)}[data-v-558524f4] .footer-error{margin-top:15px}.wizard[data-v-558524f4]{position:relative;height:100%;z-index:1}.banner__title[data-v-558524f4]{padding-top:10px;margin-bottom:10px;border-bottom:1px solid var(--border);min-height:60px}.banner__readme-button[data-v-558524f4]{padding:0 7px 0 0}",""]),t["default"]=n},69840:function(e,t,a){var s=a(68208);s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.id,s,""]]),s.locals&&(e.exports=s.locals);var o=a(74825).A;o("2c91431f",s,!0,{sourceMap:!1,shadowMode:!1})},71167:function(e,t,a){var s=a(67455);s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.id,s,""]]),s.locals&&(e.exports=s.locals);var o=a(74825).A;o("ff5b4f70",s,!0,{sourceMap:!1,shadowMode:!1})},71313:function(e,t,a){var s=a(39697);s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.id,s,""]]),s.locals&&(e.exports=s.locals);var o=a(74825).A;o("f33a49bc",s,!0,{sourceMap:!1,shadowMode:!1})},77680:function(e,t,a){var s=a(65904);s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.id,s,""]]),s.locals&&(e.exports=s.locals);var o=a(74825).A;o("513986a3",s,!0,{sourceMap:!1,shadowMode:!1})},80819:function(e,t,a){"use strict";a.d(t,{A:function(){return _}});var s=a(9274);const o={key:1},r={class:"content"},i={class:"banner__title"},n={class:"banner__short-description"};function l(e,t,a,l,c,d){const u=(0,s.resolveComponent)("Loading"),p=(0,s.resolveComponent)("Values"),h=(0,s.resolveComponent)("PolicyReadmePanel");return e.$fetchState.pending?((0,s.openBlock)(),(0,s.createBlock)(u,{key:0})):((0,s.openBlock)(),(0,s.createElementBlock)("div",o,[(0,s.createElementVNode)("div",r,[(0,s.createElementVNode)("div",i,[c.shortDescription?((0,s.openBlock)(),(0,s.createElementBlock)(s.Fragment,{key:0},[(0,s.createElementVNode)("p",n,(0,s.toDisplayString)(c.shortDescription),1),c.policyReadme?((0,s.openBlock)(),(0,s.createElementBlock)("button",{key:0,class:"btn btn-sm role-link banner__readme-button",onClick:t[0]||(t[0]=(...e)=>d.showReadme&&d.showReadme(...e))},(0,s.toDisplayString)(e.t("kubewarden.policyConfig.description.showReadme")),1)):(0,s.createCommentVNode)("",!0)],64)):(0,s.createCommentVNode)("",!0)]),(0,s.createVNode)(p,{value:a.value,"chart-values":c.chartValues,"yaml-values":c.yamlValues,mode:a.mode,onUpdateYamlValues:t[1]||(t[1]=t=>e.$emit("updateYamlValues",t))},null,8,["value","chart-values","yaml-values","mode"])]),c.policyReadme?((0,s.openBlock)(),(0,s.createBlock)(h,{key:0,ref:"readmePanel","package-values":c.artifactHubPackage},null,8,["package-values"])):(0,s.createCommentVNode)("",!0)]))}var c=a(82451),d=a.n(c),u=a(14220),p=a(52946),h=a(76978),m=a(84409),f=a(79442),v=a(18823),y=a(15182),b=a(4364),g={name:"Config",props:{mode:{type:String,default:u.nW},value:{type:Object,default:()=>{}}},components:{Loading:m.A,Values:v.A,PolicyReadmePanel:y.A},async fetch(){},async mounted(){if(this.chartValues={policy:this.value,questions:null},this.value?.metadata?.annotations?.[f.zb])try{const e=await this.value.artifactHubPackageVersion();if(e&&!e.error&&(this.artifactHubPackage=e,e.description&&(this.shortDescription=e.description),e.readme&&(this.policyReadme=JSON.parse(JSON.stringify(e.readme))),e.data?.[f.Ip.QUESTIONS])){const t=structuredClone(f.zj),a=d()(t.spec.settings,this.chartValues.policy?.spec?.settings);(0,h.hZ)(this.chartValues.policy.spec,"settings",a),this.policyQuestions=this.value.parsePackageMetadata(e.data[f.Ip.QUESTIONS]),this.policyQuestions&&(0,h.hZ)(this.chartValues,"questions",this.policyQuestions)}}catch(e){b.warn(`Unable to fetch artifacthub package: ${e}`)}this.yamlValues=(0,p.Kq)(this.value)},data(){return{artifactHubPackage:null,chartValues:null,yamlValues:"",policyQuestions:null,shortDescription:"",policyReadme:null}},methods:{showReadme(){this.$refs.readmePanel.show()}}},k=(a(98311),a(47433));const w=(0,k.A)(g,[["render",l],["__scopeId","data-v-6e3a9c09"]]);var _=w},90722:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return y}});var s=a(9274);function o(e,t,a,o,r,i){const n=(0,s.resolveComponent)("Create"),l=(0,s.resolveComponent)("Config"),c=(0,s.resolveComponent)("CruResource");return i.isCreate?((0,s.openBlock)(),(0,s.createBlock)(n,{key:0,value:a.value,mode:a.mode},null,8,["value","mode"])):((0,s.openBlock)(),(0,s.createBlock)(c,{key:1,errors:e.errors,resource:a.value,mode:a.realMode,"can-yaml":!1,onFinish:i.finish},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(l,{value:a.value,mode:a.realMode,onUpdateYamlValues:i.updateYamlValuesFromEdit},null,8,["value","mode","onUpdateYamlValues"])])),_:1},8,["errors","resource","mode","onFinish"]))}var r=a(20246),i=a.n(r),n=a(14220),l=a(91825),c=a(82996),d=a(21426),u=a(63875),p=a(80819),h=a(98267),m={name:"ClusterAdmissionPolicy",props:{value:{type:Object,required:!0},mode:{type:String,default:n.G5},realMode:{type:String,default:n.G5}},components:{CruResource:c.A,Config:p.A,Create:h.A},mixins:[l.A],provide(){return{chartType:this.value.type,realMode:this.realMode}},computed:{isCreate(){return this.realMode===n.YQ},isClone(){return this.realMode===n.dT}},methods:{async finish(e){try{(0,d.k)(this.value),this.isClone&&this.value.isKubewardenDefaultPolicy&&"kubewarden-defaults"===this.value?.metadata?.labels?.["app.kubernetes.io/name"]&&delete this.value?.metadata?.labels?.["app.kubernetes.io/name"],await this.save(e),this.$emit("input",this.value)}catch(t){(0,u.q)({error:t,store:this.$store})}},updateYamlValuesFromEdit(e){const t=i().load(e);(0,d.k)(t),this.value={...t},this.$emit("input",this.value)}}},f=(a(29889),a(47433));const v=(0,f.A)(m,[["render",o],["__scopeId","data-v-055dee5c"]]);var y=v},98267:function(e,t,a){"use strict";a.d(t,{A:function(){return re}});var s=a(9274);const o={key:1},r={class:"mb-10"},i={class:"banner__title"},n={class:"banner__short-description"};function l(e,t,a,l,c,d){const u=(0,s.resolveComponent)("Loading"),p=(0,s.resolveComponent)("AsyncButton"),h=(0,s.resolveComponent)("Banner"),m=(0,s.resolveComponent)("PolicyTable"),f=(0,s.resolveComponent)("Values"),v=(0,s.resolveComponent)("Wizard"),y=(0,s.resolveComponent)("PolicyReadmePanel"),b=(0,s.resolveDirective)("clean-html");return e.$fetchState.pending?((0,s.openBlock)(),(0,s.createBlock)(u,{key:0,mode:"relative"})):((0,s.openBlock)(),(0,s.createElementBlock)("div",o,[d.hideArtifactHubBanner?(0,s.createCommentVNode)("",!0):((0,s.openBlock)(),(0,s.createBlock)(h,{key:0,"data-testid":"kw-policy-create-ah-banner",class:"type-banner mb-20 mt-0",color:"warning",closable:!0,onClose:t[0]||(t[0]=e=>d.closeBanner("updateHideBannerArtifactHub"))},{default:(0,s.withCtx)((()=>[(0,s.createElementVNode)("div",null,[(0,s.withDirectives)((0,s.createElementVNode)("p",r,null,512),[[b,e.t("kubewarden.policies.noArtifactHub",{},!0)]]),(0,s.createVNode)(p,{mode:"artifactHub",onClick:d.addArtifactHub},null,8,["onClick"])])])),_:1})),d.hideAirgapBanner?(0,s.createCommentVNode)("",!0):((0,s.openBlock)(),(0,s.createBlock)(h,{key:1,"data-testid":"kw-policy-create-ag-banner",class:"type-banner mb-20 mt-0",color:"warning",closable:!0,label:e.t("kubewarden.policies.airgap.banner"),onClose:t[1]||(t[1]=e=>d.closeBanner("updateHideBannerAirgapPolicy"))},null,8,["label"])),d.loadingPackages?((0,s.openBlock)(),(0,s.createBlock)(u,{key:2})):(0,s.createCommentVNode)("",!0),a.value&&!d.loadingPackages?((0,s.openBlock)(),(0,s.createBlock)(v,{key:3,ref:"wizard",value:a.value,"data-testid":"kw-policy-create-wizard",errors:e.errors,steps:d.steps,"show-banner":!1,"edit-first-step":!0,class:"wizard",onNext:d.reset,onCancel:d.done,onFinish:d.finish},{policies:(0,s.withCtx)((()=>[(0,s.createVNode)(m,{"data-testid":"kw-policy-create-table",value:d.packages,onSelectType:t[2]||(t[2]=e=>d.selectType(e))},null,8,["value"])])),values:(0,s.withCtx)((()=>[(0,s.createElementVNode)("div",i,[(0,s.createElementVNode)("h2",null,(0,s.toDisplayString)(c.bannerTitle),1),d.customPolicy?(0,s.createCommentVNode)("",!0):((0,s.openBlock)(),(0,s.createElementBlock)(s.Fragment,{key:0},[(0,s.createElementVNode)("p",n,(0,s.toDisplayString)(c.shortDescription),1),(0,s.createElementVNode)("button",{class:"btn btn-sm role-link banner__readme-button",onClick:t[3]||(t[3]=(...e)=>d.showReadme&&d.showReadme(...e))},(0,s.toDisplayString)(e.t("kubewarden.policyConfig.description.showReadme")),1)],64))]),(0,s.createVNode)(f,{value:a.value,"chart-values":c.chartValues,"yaml-values":c.yamlValues,mode:a.mode,"custom-policy":d.customPolicy,onEditor:t[4]||(t[4]=e=>c.yamlOption=e),onUpdateYamlValues:t[5]||(t[5]=e=>c.yamlValues=e)},null,8,["value","chart-values","yaml-values","mode","custom-policy"])])),finish:(0,s.withCtx)((()=>[(0,s.createVNode)(p,{"data-testid":"kw-policy-create-finish-button",disabled:!d.canFinish,mode:"finish",onClick:d.finish},null,8,["disabled","onClick"])])),_:1},8,["value","errors","steps","onNext","onCancel","onFinish"])):(0,s.createCommentVNode)("",!0),d.packageValues&&!d.customPolicy?((0,s.openBlock)(),(0,s.createBlock)(y,{key:4,ref:"readmePanel","package-values":d.packageValues},null,8,["package-values"])):(0,s.createCommentVNode)("",!0)]))}var c=a(20246),d=a.n(c),u=a(82451),p=a.n(u),h=a(3514),m=a.n(h),f=a(46343),v=a.n(f),y=a(91825),b=a(35664),g=a(14220),k=a(52946),w=a(76978),_=a(9980),V=a(5813),C=a(84409),A=a(8603),x=a(79442),B=a(21426),O=a(63875),E=a(36904);const P={class:"policy-table-container"},S={class:"filter"},M={class:"policy-table-actions"};function N(e,t,a,o,r,i){const n=(0,s.resolveComponent)("LabeledSelect"),l=(0,s.resolveComponent)("LabeledInput"),c=(0,s.resolveComponent)("Checkbox"),d=(0,s.resolveComponent)("SortableTableWrapper");return(0,s.openBlock)(),(0,s.createElementBlock)("div",P,[(0,s.createElementVNode)("div",S,[i.attributeOptions.length?((0,s.openBlock)(),(0,s.createBlock)(n,{key:0,value:r.attributes,"onUpdate:value":t[0]||(t[0]=e=>r.attributes=e),"data-testid":"kw-table-filter-source",clearable:!0,taggable:!0,mode:a.mode,multiple:!0,class:"filter__attributes","label-key":"kubewarden.utils.attributes.label",options:i.attributeOptions,onSelecting:t[1]||(t[1]=e=>i.handleAttributeSelect(e))},null,8,["value","mode","options"])):(0,s.createCommentVNode)("",!0),(0,s.createVNode)(l,{ref:"searchQuery",value:r.searchQuery,"onUpdate:value":t[2]||(t[2]=e=>r.searchQuery=e),"data-testid":"kw-table-filter-search",mode:a.mode,class:"input-sm filter__search",label:e.t("kubewarden.utils.search"),placeholder:e.t("kubewarden.generic.name")},null,8,["value","mode","label","placeholder"]),(0,s.createElementVNode)("button",{ref:"btn","data-testid":"kw-table-filter-refresh",class:"btn role-tertiary filter__reset",type:"button",onClick:t[3]||(t[3]=(...e)=>i.refresh&&i.refresh(...e))},[(0,s.createElementVNode)("p",null,(0,s.toDisplayString)(e.t("kubewarden.utils.resetFilter")),1)],512)]),(0,s.createElementVNode)("div",M,[(0,s.createVNode)(c,{value:r.showKubewardenOfficial,"onUpdate:value":t[4]||(t[4]=e=>r.showKubewardenOfficial=e),label:e.t("kubewarden.utils.official.label"),"data-testid":"kw-table-filter-official"},null,8,["value","label"]),(0,s.createElementVNode)("button",{ref:"btn","data-testid":"kw-table-custom-buttom",class:"btn role-tertiary",type:"button",onClick:t[5]||(t[5]=t=>e.$emit("selectType","custom"))},[(0,s.createElementVNode)("p",null,(0,s.toDisplayString)(e.t("kubewarden.utils.custom.create")),1)],512)]),(0,s.createVNode)(d,{rows:i.filteredSubtypes,headers:r.POLICY_TABLE_HEADERS,"table-actions":!1,"row-actions":!1,"key-field":"package_id","default-sort-by":"name",paging:!0,search:!1,onSelectRow:t[6]||(t[6]=t=>e.$emit("selectType",t))},null,8,["rows","headers"])])}var Y=a(2722),R=a.n(Y),$=a(91462),I=a(92043),F=a(74302),T=a(7286),L=a(48033),U=a(42200),D=a(65165);function q(e){const t=[],a=e?.flatMap((e=>{const t=e?.data?.["kubewarden/resources"];if(t)return t}));return a?.flatMap((e=>{if(e){const a=e.split(",");a.length>1?a.forEach((e=>t.push(e.trim()))):t.push(e)}return[]}))?.sort(),t&&0!==t?.length?[...new Set(t.filter(Boolean))]:[]}function Q(e,t){if(e){const a=e.data?.["kubewarden/resources"]?.split(",");let s=!1;if(a)for(const e of a)s=t?.some((t=>t?.attributes?.kind===e&&(!1===t?.attributes?.namespaced||void 0)));return s}return!1}function j(e,t,a,o,r,i){const n=(0,s.resolveComponent)("SortableTable");return(0,s.openBlock)(),(0,s.createElementBlock)("div",null,[(0,s.createVNode)(n,{ref:"sortableTable",rows:a.rows,headers:a.headers,"table-actions":a.tableActions,"row-actions":a.rowActions,"key-field":a.keyField,"default-sort-by":a.defaultSortBy,paging:a.paging,search:a.search},null,8,["rows","headers","table-actions","row-actions","key-field","default-sort-by","paging","search"])])}var z=a(68150),H={props:{rows:{type:Array,required:!0},headers:{type:Array,required:!0},tableActions:{type:Boolean,default:!1},rowActions:{type:Boolean,default:!1},keyField:{type:String,required:!0},defaultSortBy:{type:String,default:""},paging:{type:Boolean,default:!1},search:{type:Boolean,default:!1}},components:{SortableTable:z.A},data(){return{listeners:[]}},watch:{rows(){this.addRowClickListener()}},mounted(){this.addRowClickListener()},methods:{addRowClickListener(){this.$nextTick((()=>{const e=this.$refs.sortableTable?.$el?.querySelector("table");e&&(this.removeRowClickListener(),e.querySelectorAll("tbody tr").forEach(((e,t)=>{const a=()=>this.$emit("selectRow",this.rows[t]);e?.addEventListener("click",a),this.listeners.push({row:e,listener:a})})))}))},removeRowClickListener(){this.listeners?.forEach((({row:e,listener:t})=>e?.removeEventListener("click",t))),this.listeners=[]}}},K=a(47433);const G=(0,K.A)(H,[["render",j]]);var W=G,Z={props:{mode:{type:String,default:g.YQ},value:{type:Array,default:()=>[]}},inject:["chartType"],components:{Checkbox:U.S,LabeledSelect:T.A,LabeledInput:L.o,SortableTableWrapper:W},fetch(){const e=this.$route.query;this.category=e[g.XJ]||"",this.searchQuery=e[g.os]||""},data(){return{KUBEWARDEN_PRODUCT_NAME:x.bp,POLICY_TABLE_HEADERS:D.BM,attributes:[this.t("kubewarden.utils.attributes.optionLabels.all")],searchQuery:null,hidePackages:[],showKubewardenOfficial:!0}},computed:{allSchemas(){return this.$store.getters["cluster/all"](b.yx)},filteredPackages(){const e=this.value?.filter((e=>{const t=this.isPrerelease(e);return!(!this.showPreRelease&&t)&&(this.chartType!==x.$v.ADMISSION_POLICY||!Q(e,this.allSchemas))}));return e||[]},filteredSubtypes(){const e=this.filteredPackages||[],t=e.filter((e=>{if(this.showKubewardenOfficial&&!this.isOfficial(e))return!1;if(this.searchQuery){const t=this.searchQuery.split(/\s*[, ]\s*/).map((e=>(0,I.OF)(e,!1))),a=t.every((t=>e.display_name?.match(t)||e.description&&e.description.match(t)||e.keywords?.some((e=>e.match(t)))));if(!a)return!1}if(this.attributes.length){if(this.attributes.includes(this.t("kubewarden.utils.attributes.optionLabels.all")))return!0;const t=this.attributes.some((t=>{const a=this.featureOptions.includes(t);if(a){const a="Mutation"===t?"mutation":"contextAwareResources";return e.data?.[`kubewarden/${a}`]}return e.data?.["kubewarden/resources"]?.includes(t)}));if(!t)return!1}return!0}));return(0,F.Ul)(t,["name"])},attributeOptions(){const e=[];return this.resourceOptions.length&&e.push({kind:"group",label:this.t("kubewarden.utils.attributes.optionLabels.resource")},...this.resourceOptions),this.featureOptions.length&&e.push({kind:"group",label:this.t("kubewarden.utils.attributes.optionLabels.features")},...this.featureOptions),e.length&&e.unshift(this.t("kubewarden.utils.attributes.optionLabels.all"),{kind:"divider",label:"divider"}),e},featureOptions(){const e=[];for(const t of this.filteredPackages)"true"===t?.data?.["kubewarden/mutation"]&&e.push("Mutation"),t?.data?.["kubewarden/contextAwareResources"]&&e.push("Context Aware");return e&&0!==e.length?[...new Set(e.filter(Boolean))]:[]},keywordOptions(){const e=this.filteredPackages?.flatMap((e=>{if(e?.keywords&&e.keywords.length)return e.keywords}));return e&&0!==e?.length?[...new Set(e.filter(Boolean))]:[]},organizationOptions(){const e=this.filteredPackages?.flatMap((e=>{const t=e?.repository?.organization_display_name||e?.repository?.user_alias;return t||null}));return e&&0!==e.length?[...new Set(e.filter(Boolean))]:[]},resourceOptions(){return q(this.filteredPackages)},showPreRelease(){return this.$store.getters["prefs/get"]($.kJ)}},methods:{hasAnnotation(e,t){return!(!e.data?.[t]||"false"===e.data?.[t])},isPrerelease(e){const t=R().prerelease(e.version);return t&&"deprecated-api-versions"===e.name?!!t.includes("rc"):!!t},refresh(){this.category=null,this.attributes=[this.t("kubewarden.utils.attributes.optionLabels.all")],this.searchQuery=null},isOfficial(e){return e?.repository?.organization_name?.toLowerCase()===x.bp},handleAttributeSelect(e){const t=this.t("kubewarden.utils.attributes.optionLabels.all");e.includes(t)&&(1===e.length||0!==e.indexOf(t))?this.attributes=[t]:this.attributes=e.filter((e=>e!==t))}}};a(71313);const J=(0,K.A)(Z,[["render",N],["__scopeId","data-v-950c9ca8"]]);var X=J,ee=a(15182),te=a(18823),ae=a(4364),se={name:"Create",props:{mode:{type:String,default:g.YQ},value:{type:Object,default:()=>({})}},components:{AsyncButton:V.A,Banner:_.l,Loading:C.A,Wizard:A.A,PolicyTable:X,PolicyReadmePanel:ee.A,Values:te.A},inject:["chartType"],mixins:[y.A],async fetch(){if(this.hasArtifactHub){const e=await this.value.artifactHubRepo();await this.$store.dispatch("kubewarden/fetchPackages",{repository:e,value:this.value})}this.value.apiVersion=`${this.schema?.attributes?.group}.${this.schema?.attributes?.version}`,this.value.kind=this.schema?.attributes?.kind},data(){return{bannerTitle:null,shortDescription:null,type:null,typeModule:null,version:null,chartValues:{policy:{},questions:{}},yamlValues:"",hasCustomPolicy:!1,yamlOption:x.FU.FORM,finishAttempts:0,stepPolicies:{hidden:!1,name:"policies",label:"Policies",ready:!1,showSteps:!1,weight:99},stepValues:{name:"values",label:"Values",ready:!0,showSteps:!1,weight:98}}},computed:{isAirgap(){return this.$store.getters["kubewarden/airGapped"]},isCreate(){return this.realMode===g.YQ},isSelected(){return!!this.type},customPolicy(){return"custom"===this.type},canFinish(){return this.yamlOption===x.FU.YAML||!!this.chartValues?.policy?.spec?.module&&this.hasRequired},hasArtifactHub(){return this.value.artifactHubWhitelist},hasRequired(){if(!m()(this.chartValues?.policy)&&this.chartValues.policy.spec){const{rules:e,settings:t}=this.chartValues.policy.spec,a=["apiVersions","operations","resources"],s=this.acceptedValues(e,a),o=this.chartValues.policy.metadata.name,r=this.chartValues?.questions?.questions?.map((e=>{if(e.required)return e.variable})).filter(Boolean),i=this.acceptedValues(t,r);if(o&&!m()(s)&&(m()(r)||!m()(i)))return!0}return!1},hideArtifactHubBanner(){return this.$store.getters["kubewarden/hideBannerArtifactHub"]||!!this.hasArtifactHub||!!this.isAirgap},hideAirgapBanner(){return!this.isAirgap||this.$store.getters["kubewarden/hideBannerAirgapPolicy"]},packageValues(){return this.type?.repository?.url?this.packages?.find((e=>e.repository?.url===this.type.repository.url)):null},steps(){const e=[];return e.push(this.stepPolicies,this.stepValues),e.sort(((e,t)=>t.weight-e.weight))},packages(){return this.$store.getters["kubewarden/packages"]},packageDetailsByKey(){return this.$store.getters["kubewarden/packageDetailsByKey"]},loadingPackages(){return this.$store.getters["kubewarden/loadingPackages"]}},methods:{acceptedValues(e,t){if(m()(t))return null;let a;return a=Array.isArray(e)?e.find((e=>this.checkProperties(e,t))):this.checkProperties(e,t),a},checkProperties(e,t){const a=[];if(!m()(t)){for(const s of t.values())m()(e[s])||a.push(s);if(t&&v()(a,t))return e}return null},async closeBanner(e,t=0){const a=await this.$store.dispatch(`kubewarden/${e}`,!0);0===t&&"error"===a?.type&&500===a?.status&&await this.close(t+1)},async createNamespace(e){const t=this.$store.getters["cluster/all"](b.CU),a={type:b.CU,metadata:{name:e},disableOpenApiValidation:!1},s=t?.find((t=>t?.metadata?.name===e));if(!s){const e=await this.$store.dispatch("cluster/create",a);try{await e.save()}catch(o){this.errors.push(o)}}},async addArtifactHub(e){try{this.loadingPackages=!0,await this.value.updateWhitelist("artifacthub.io"),await this.getPackages(),e(!0),this.loadingPackages=!1}catch(t){(0,O.q)({error:t,store:this.$store}),e(!1),this.loadingPackages=!1}},done(){this.$router.replace({name:"c-cluster-product-resource",params:{cluster:this.$route.params.cluster,product:x.bp,resource:this.schema?.id}})},async finish(e){try{let t;t=this.yamlOption===x.FU.YAML?d().load(this.yamlValues):this.chartValues?.policy?this.chartValues.policy:d().load(this.yamlValues),(0,B.k)(t),this.finishAttempts>0?(Object.keys(this.value.spec).forEach((e=>{e in t.spec||this.$delete(this.value.spec,e)})),Object.keys(t.spec).forEach((e=>{this.value.spec.key=t.spec[e]}))):p()(this.value,t),this.chartType===x.$v.ADMISSION_POLICY&&this.chartValues?.isNamespaceNew&&await this.createNamespace(this.value?.metadata?.namespace),await this.attemptSave(e)}catch(t){ae.error("Error creating policy",t)}},async attemptSave(e){if(await this.save(e),this.errors&&this.errors.length>0){const e=new Error("Save operation failed");throw this.finishAttempts++,e}},async getPackages(){if(this.repository=await this.value.artifactHubRepo(),this.repository&&this.repository.packages.length>0){const t=this.repository.packages.filter((e=>!e?.repository?.url?.includes(x.Kf))),a=t.map((e=>this.packageDetails(e)));try{const e=await Promise.all(a);this.packages=e.filter((e=>"true"!==e?.data?.["kubewarden/hidden-ui"]))}catch(e){(0,O.q)({error:e,store:this.$store}),ae.warn("Error fetching packages",e)}}},packageDetails(e){return this.packageDetailsByKey(e?.package_id)},policyQuestions(){const e=structuredClone(x.zj);if(this.customPolicy){const t={spec:{contextAwareResources:[]}};return p()(e,t),(0,w.hZ)(this.chartValues,"policy",e),void(this.yamlValues=(0,k.Kq)(e))}const t=this.packages.find((e=>e.repository?.url===this.type?.repository?.url)),a=this.value.parsePackageMetadata(t?.data?.[E.I.QUESTIONS]),s=`${t?.repository?.name}/${t?.name}/${t?.version}`,o=(e,a)=>{const s=this.value.parsePackageMetadata(t?.data?.[e]);return void 0!==s?.[a]?s[a]:s||[]},r=e=>void 0!==t?.data?.[e]&&JSON.parse(t.data[e]),i={apiVersion:this.value.apiVersion,kind:this.value.kind,metadata:{annotations:{[x.zb]:s}},spec:{module:t?.containers_images[0].image,contextAwareResources:o(E.I.CONTEXT_AWARE,"contextAwareResources"),rules:o(E.I.RULES,"rules"),mutating:r(E.I.MUTATION)}};p()(e,i),(0,w.hZ)(this.chartValues,"policy",e),this.yamlValues=(0,k.Kq)(e),a&&(0,w.hZ)(this.chartValues,"questions",a),this.shortDescription=t?.description},reset(e){this.$nextTick((()=>{if(e.step?.name===this.stepPolicies.name){const e=["errors","bannerTitle","shortDescription","type","typeModule","version","hasCustomPolicy"];e.forEach((e=>{this[e]=null})),this.stepPolicies.ready=!1,this.stepValues.hidden=!1,this.chartValues={policy:{},questions:{}},this.yamlOption=x.FU.FORM,this.yamlValues=""}}))},selectType(e){this.type=e,this.customPolicy?this.hasCustomPolicy=!0:this.hasCustomPolicy=!1,this.policyQuestions(),this.stepPolicies.ready=!0,this.$refs.wizard.next(),this.bannerTitle=this.customPolicy?"Custom Policy":e?.display_name,this.typeModule=this.chartValues?.policy?.spec.module},showReadme(){this.$refs.readmePanel.show()}}};a(69840);const oe=(0,K.A)(se,[["render",l],["__scopeId","data-v-558524f4"]]);var re=oe},98311:function(e,t,a){var s=a(27271);s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.id,s,""]]),s.locals&&(e.exports=s.locals);var o=a(74825).A;o("7c1a947c",s,!0,{sourceMap:!1,shadowMode:!1})}}]);
//# sourceMappingURL=kubewarden-3.1.1-rc.1.umd.min.edit.js.map