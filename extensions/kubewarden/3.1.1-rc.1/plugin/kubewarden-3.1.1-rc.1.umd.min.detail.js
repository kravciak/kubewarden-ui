(("undefined"!==typeof self?self:this)["webpackChunkkubewarden_3_1_1_rc_1"]=("undefined"!==typeof self?self:this)["webpackChunkkubewarden_3_1_1_rc_1"]||[]).push([[332],{8905:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return O}});var o=r(9274);const a={key:1},n={key:0,class:"row"},i={class:"col span-6"},l={"data-testid":"kw-ps-detail-status-title"},s={class:"gauges mb-20"},c={key:0,class:"col span-6"},d={class:"gauges mb-20"};function p(e,t,r,p,u,m){const h=(0,o.resolveComponent)("Loading"),g=(0,o.resolveComponent)("CountGauge"),y=(0,o.resolveComponent)("BadgeState"),b=(0,o.resolveComponent)("ResourceTable"),f=(0,o.resolveComponent)("Tab"),v=(0,o.resolveComponent)("TraceTable"),k=(0,o.resolveComponent)("MetricsTab"),w=(0,o.resolveComponent)("ResourceTabs");return e.$fetchState.pending?((0,o.openBlock)(),(0,o.createBlock)(h,{key:0})):((0,o.openBlock)(),(0,o.createElementBlock)("div",a,[u.policyGauges?((0,o.openBlock)(),(0,o.createElementBlock)("div",n,[(0,o.createElementVNode)("template",null,[(0,o.createElementVNode)("div",i,[(0,o.createElementVNode)("h3",l,(0,o.toDisplayString)(e.t("kubewarden.policyServer.policyGauge.byStatus")),1),(0,o.createElementVNode)("div",s,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(u.policyGauges,((e,t)=>((0,o.openBlock)(),(0,o.createBlock)(g,{key:t,total:m.relatedPoliciesTotal,useful:e.count||0,graphical:!1,"primary-color-var":`--sizzle-${e.color}`,name:t},null,8,["total","useful","primary-color-var","name"])))),128))])])]),m.emptyTraces?(0,o.createCommentVNode)("",!0):((0,o.openBlock)(),(0,o.createElementBlock)("div",c,[(0,o.createElementVNode)("h3",null,(0,o.toDisplayString)(e.t("kubewarden.policyServer.policyGauge.traces")),1),(0,o.createElementVNode)("div",d,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(m.tracesGauges,((e,t)=>((0,o.openBlock)(),(0,o.createBlock)(g,{key:t,useful:e.count||0,total:m.traceGaugeTotals,graphical:!1,"primary-color-var":`--sizzle-${e.color}`,name:t},null,8,["useful","total","primary-color-var","name"])))),128))])]))])):(0,o.createCommentVNode)("",!0),(0,o.createVNode)(w,{value:r.value,mode:r.mode},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(f,{name:"related-policies",label:"Policies",weight:99},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(b,{rows:u.relatedPolicies||[],headers:u.RELATED_HEADERS,groupable:!0,"group-by":m.groupPreference,"table-actions":!0,"data-testid":"kw-ps-detail-related-policies-list"},{"col:operation":(0,o.withCtx)((({row:t})=>[(0,o.createElementVNode)("td",null,[(0,o.createVNode)(y,{"data-testid":`kw-ps-detail-${t.id}-state`,label:t.operation,color:e.color(t.operation)},null,8,["data-testid","label","color"])])])),_:1},8,["rows","headers","group-by"])])),_:1}),(0,o.createVNode)(f,{name:"policy-tracing",label:"Tracing",weight:98,class:"relative"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(v,{resource:u.resource,"related-policies":u.relatedPolicies},null,8,["resource","related-policies"])])),_:1}),(0,o.createVNode)(f,{name:"policy-metrics",label:"Metrics",weight:97,class:"relative"},{default:(0,o.withCtx)((e=>[(0,o.createVNode)(k,{resource:u.resource,"policy-server-obj":r.value,active:e.active},null,8,["resource","policy-server-obj","active"])])),_:1})])),_:1},8,["value","mode"])]))}var u=r(65359),m=r(3514),h=r.n(m),g=r(14220),y=r(88339),b=r(91825),f=r(91462),v=r(87102),k=r(777),w=r(84409),C=r(72551),E=r(18490),S=r(49584),A=r(65165),N=r(79442),_=r(63922),T=r(38958),V={name:"PolicyServer",components:{BadgeState:v.j,CountGauge:k.A,Loading:w.A,MetricsTab:_.A,ResourceTabs:C.A,ResourceTable:E.A,Tab:S.A,TraceTable:T.A},mixins:[b.A],props:{mode:{type:String,default:g.YQ},value:{type:Object,required:!0}},async fetch(){const e=await(0,y.kR)({relatedPolicies:this.value.allRelatedPolicies(),policyGauges:this.value.policyGauges()}),t=(e,t)=>{h()(t)||(this[e]=t)};t("relatedPolicies",e.relatedPolicies),t("policyGauges",e.policyGauges)},data(){return{RELATED_HEADERS:A.DD,policyGauges:null,relatedPolicies:null,reloadRequired:!1,resource:N.$v.POLICY_SERVER}},computed:{...(0,u.L8)(["currentCluster"]),...(0,u.L8)({policyTraces:"kubewarden/policyTraces"}),_group:(0,f.AN)(f.EI),filteredTraces(){return h()(this.policyTraces)?null:this.policyTraces.filter((e=>{if(this.currentCluster?.id===e.cluster)return e}))},emptyTraces(){return h()(this.filteredTraces)},groupPreference(){const e="namespace"===this._group?"kind":null;return e},relatedPoliciesTotal(){return h()(this.relatedPolicies)?0:this.relatedPolicies.length},tracesGauges(){return this.emptyTraces?null:this.value.tracesGauges(this.filteredTraces)},traceGaugeTotals(){return this.emptyTraces?0:this.filteredTraces?.flatMap((e=>e.traces)).length}},methods:{hasNamespaceSelector(e){return e.namespaceSelector}}},R=(r(87782),r(47433));const P=(0,R.A)(V,[["render",p],["__scopeId","data-v-4044d828"]]);var O=P},9551:function(e,t,r){var o={"./kubewarden-dashboard-policy.json":[18938,521],"./kubewarden-dashboard-policyserver.json":[65682,712]};function a(e){if(!r.o(o,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=o[e],a=t[0];return r.e(t[1]).then((function(){return r.t(a,19)}))}a.keys=function(){return Object.keys(o)},a.id=9551,e.exports=a},17081:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return p}});var o=r(9274);function a(e,t,r,a,n,i){const l=(0,o.resolveComponent)("PolicyDetail");return(0,o.openBlock)(),(0,o.createBlock)(l,{value:r.value,mode:r.mode,resource:n.resource},null,8,["value","mode","resource"])}var n=r(14220),i=r(79442),l=r(98618),s={name:"AdmissionPolicy",props:{mode:{type:String,default:n.YQ},value:{type:Object,required:!0}},components:{PolicyDetail:l.A},data(){return{resource:i.$v.ADMISSION_POLICY}}},c=r(47433);const d=(0,c.A)(s,[["render",a]]);var p=d},25552:function(e,t,r){"use strict";r.r(t);var o=r(36758),a=r.n(o),n=r(40935),i=r.n(n),l=i()(a());l.push([e.id,".checklist__container[data-v-9013874c]{display:flex;justify-content:center;flex-direction:column;border:1px solid var(--border);padding:10px}.checklist__config[data-v-9013874c],.checklist__step[data-v-9013874c]{display:flex;flex-direction:row;justify-content:flex-start;align-items:center}.checklist__step[data-v-9013874c]{min-height:40px}.conflicting-banner[data-v-9013874c]{display:flex;flex-direction:column}",""]),t["default"]=l},38958:function(e,t,r){"use strict";r.d(t,{A:function(){return pe}});var o=r(9274);const a={key:1},n={class:"text-bold"},i=["colspan"],l={class:"details"},s={class:"col"},c={class:"text-info text-capitalize"},d={class:"col"},p={class:"text-info"},u={class:"col"},m={class:"text-info"};function h(e,t,r,h,g,y){const b=(0,o.resolveComponent)("Loading"),f=(0,o.resolveComponent)("TraceChecklist"),v=(0,o.resolveComponent)("Banner"),k=(0,o.resolveComponent)("BadgeState"),w=(0,o.resolveComponent)("SortableTable");return e.$fetchState.pending||e.refreshingCharts?((0,o.openBlock)(),(0,o.createBlock)(b,{key:0,mode:"relative"})):((0,o.openBlock)(),(0,o.createElementBlock)("div",a,[y.showChecklist?((0,o.openBlock)(),(0,o.createBlock)(f,{key:0,"controller-app":y.controllerApp,"controller-chart":y.controllerChart,"tracing-configuration":y.tracingConfiguration,"jaeger-query-svc":y.jaegerQuerySvc,"open-tel-svc":y.openTelSvc,"outdated-telemetry-spec":g.outdatedTelemetrySpec,"unsupported-telemetry-spec":g.unsupportedTelemetrySpec,"incomplete-telemetry-spec":g.incompleteTelemetrySpec},null,8,["controller-app","controller-chart","tracing-configuration","jaeger-query-svc","open-tel-svc","outdated-telemetry-spec","unsupported-telemetry-spec","incomplete-telemetry-spec"])):!y.showChecklist&&y.emptyPolicies?((0,o.openBlock)(),(0,o.createBlock)(v,{key:1,color:"error",label:e.t("kubewarden.tracing.noRelatedPolicies")},null,8,["label"])):y.showTable?((0,o.openBlock)(),(0,o.createBlock)(w,{key:2,rows:y.filteredValidations,headers:g.TRACE_HEADERS,"table-actions":!1,"row-actions":!1,"key-field":"id","default-sort-by":"startTime","sub-expandable":!0,"sub-expand-column":!0,"sub-rows":!0,paging:!0,"rows-per-page":y.rowsPerPage},{"col:mode":(0,o.withCtx)((({row:e})=>[(0,o.createElementVNode)("td",null,[(0,o.createVNode)(k,{label:e.mode,color:y.modeColor(e.mode),class:"text-capitalize"},null,8,["label","color"])])])),"col:name":(0,o.withCtx)((({row:e})=>[(0,o.createElementVNode)("td",n,(0,o.toDisplayString)(e.name),1)])),"col:namespace":(0,o.withCtx)((({row:e})=>[(0,o.createElementVNode)("td",null,(0,o.toDisplayString)(e.namespace?e.namespace:"-"),1)])),"col:startTime":(0,o.withCtx)((({row:e})=>[(0,o.createElementVNode)("td",null,(0,o.toDisplayString)(y.formatTime(e.startTime)),1)])),"col:duration":(0,o.withCtx)((({row:e})=>[(0,o.createElementVNode)("td",null,(0,o.toDisplayString)(y.duration(e.duration)),1)])),"sub-row":(0,o.withCtx)((({row:e,fullColspan:r})=>[(0,o.createElementVNode)("td",{colspan:r,class:"sub-row"},[(0,o.createElementVNode)("div",l,[(0,o.createElementVNode)("section",s,[t[0]||(t[0]=(0,o.createElementVNode)("div",{class:"title"}," Response Message ",-1)),(0,o.createElementVNode)("span",c,(0,o.toDisplayString)(e.responseMessage?e.responseMessage:"-"),1)]),(0,o.createElementVNode)("section",d,[t[1]||(t[1]=(0,o.createElementVNode)("div",{class:"title"}," Response Code ",-1)),(0,o.createElementVNode)("span",p,(0,o.toDisplayString)(e.responseCode?e.responseCode:"-"),1)]),(0,o.createElementVNode)("section",u,[t[2]||(t[2]=(0,o.createElementVNode)("div",{class:"title"}," Mutated ",-1)),(0,o.createElementVNode)("span",m,(0,o.toDisplayString)(e.mutated),1)])])],8,i)])),_:1},8,["rows","headers","rows-per-page"])):((0,o.openBlock)(),(0,o.createBlock)(v,{key:3,color:"warning",label:e.t(y.emptyTracesLabel)},null,8,["label"]))]))}var g=r(65359),y=r(3514),b=r.n(y),f=r(2722),v=r.n(f),k=r(23464),w=r.n(k),C=r(25562),E=r.n(C),S=r(35664),A=r(2841),N=r(1804),_=r(88339),T=r(87102),V=r(9980),R=r(84409),P=r(68150),O=r(65165),B=r(79442),D=r(74947),x=r(99241),M=r.n(x),j=r(119),$=r.n(j),L=r(10279),I=r.n(L);w().extend(I());const q=1e3,Y=1e3*q,G=60*Y,U=60*G,W=24*U,z=[{unit:"d",microseconds:W,ofPrevious:24},{unit:"h",microseconds:U,ofPrevious:60},{unit:"m",microseconds:G,ofPrevious:60},{unit:"s",microseconds:Y,ofPrevious:1e3},{unit:"ms",microseconds:q,ofPrevious:1e3},{unit:"μs",microseconds:1,ofPrevious:1e3}];function Q(e){const[t,r]=M()(z,(({microseconds:t},r)=>r<z.length-1&&t>e));if(1e3===t.ofPrevious)return`${$()(e/t.microseconds,2)}${t.unit}`;const o=Math.floor(e/t.microseconds),a=`${o}${t.unit}`,n=Math.round(e/r.microseconds%t.ofPrevious),i=`${n}${r.unit}`;return 0===n?a:`${a} ${i}`}const K={class:"checklist__description mb-20","data-testid":"kw-tracing-checklist-description"},F={class:"checklist__prereq mb-20"},H={class:"checklist__container mt-20 mb-20"},J={class:"checklist__step mb-20","data-testid":"kw-tracing-checklist-step-open-tel"},X={class:"checklist__step mb-20","data-testid":"kw-tracing-checklist-step-jaeger"},Z={p:""},ee={class:"checklist__step mb-20","data-testid":"kw-tracing-checklist-step-config"},te={class:"checklist__config"},re=["disabled"];function oe(e,t,r,a,n,i){const l=(0,o.resolveComponent)("Banner"),s=(0,o.resolveDirective)("clean-html"),c=(0,o.resolveDirective)("clean-tooltip");return(0,o.openBlock)(),(0,o.createElementBlock)("div",null,[(0,o.createElementVNode)("p",K,(0,o.toDisplayString)(e.t("kubewarden.tracing.description")),1),(0,o.createElementVNode)("div",F,[(0,o.createElementVNode)("h2",null,(0,o.toDisplayString)(e.t("kubewarden.tracing.prerequisites.label")),1),(0,o.createElementVNode)("p",null,(0,o.toDisplayString)(e.t("kubewarden.tracing.prerequisites.description")),1)]),(0,o.createVNode)(l,{color:"warning",label:e.t("kubewarden.tracing.prerequisites.warning")},null,8,["label"]),(0,o.createElementVNode)("div",H,[(0,o.createElementVNode)("div",J,[(0,o.createElementVNode)("i",{class:(0,o.normalizeClass)(["icon mr-10",i.badgeIcon(r.openTelSvc)])},null,2),(0,o.withDirectives)((0,o.createElementVNode)("p",null,null,512),[[s,e.t("kubewarden.tracing.openTelemetry",{},!0)]])]),(0,o.createElementVNode)("div",X,[(0,o.createElementVNode)("i",{class:(0,o.normalizeClass)(["icon mr-10",i.badgeIcon(r.jaegerQuerySvc)])},null,2),(0,o.withDirectives)((0,o.createElementVNode)("p",Z,null,512),[[s,e.t("kubewarden.tracing.jaeger",{},!0)]])]),(0,o.createElementVNode)("div",null,[r.outdatedTelemetrySpec?((0,o.openBlock)(),(0,o.createBlock)(l,{key:0,color:"error",label:e.t("kubewarden.tracing.prerequisites.outdated")},null,8,["label"])):(0,o.createCommentVNode)("",!0),r.unsupportedTelemetrySpec?((0,o.openBlock)(),(0,o.createBlock)(l,{key:1,color:"error",label:e.t("kubewarden.tracing.prerequisites.unsupported")},null,8,["label"])):(0,o.createCommentVNode)("",!0),r.incompleteTelemetrySpec?((0,o.openBlock)(),(0,o.createBlock)(l,{key:2,color:"error",label:e.t("kubewarden.tracing.prerequisites.incomplete")},null,8,["label"])):(0,o.createCommentVNode)("",!0)]),(0,o.createElementVNode)("div",ee,[(0,o.createElementVNode)("i",{class:(0,o.normalizeClass)(["icon mr-10",i.badgeIcon(i.tracingEnabled)])},null,2),(0,o.createElementVNode)("div",te,[(0,o.withDirectives)((0,o.createElementVNode)("p",null,null,512),[[s,e.t("kubewarden.tracing.config.label",{},!0)]]),(0,o.withDirectives)(((0,o.openBlock)(),(0,o.createElementBlock)("button",{"data-testid":"kw-tracing-checklist-step-config-button",class:"btn role-primary ml-10",disabled:i.controllerLinkDisabled,onClick:t[0]||(t[0]=(...e)=>i.controllerAppRoute&&i.controllerAppRoute(...e))},[(0,o.createTextVNode)((0,o.toDisplayString)(e.t("kubewarden.tracing.config.link")),1)],8,re)),[[c,i.controllerLinkTooltip]])])])])])}var ae=r(14220),ne={props:{controllerApp:{type:Object,default:null},controllerChart:{type:Object,default:null},tracingConfiguration:{type:Object,default:null},jaegerQuerySvc:{type:Object,default:null},openTelSvc:{type:Object,default:null},outdatedTelemetrySpec:{type:Boolean,default:!1},unsupportedTelemetrySpec:{type:Boolean,default:!1},incompleteTelemetrySpec:{type:Boolean,default:!1}},components:{Banner:V.l},computed:{...(0,g.L8)(["currentCluster"]),controllerLinkTooltip(){return this.openTelSvc&&this.jaegerQuerySvc?this.controllerApp&&this.controllerChart?null:this.t("kubewarden.monitoring.prerequisites.tooltips.chartError",{chart:"Kubewarden Controller"},!0):this.t("kubewarden.monitoring.prerequisites.tooltips.prerequisites")},controllerLinkDisabled(){return!this.openTelSvc||!this.jaegerQuerySvc||!this.controllerApp||!this.controllerChart},tracingEnabled(){return this.tracingConfiguration?this.tracingConfiguration.enabled:null}},methods:{badgeIcon(e){return{"icon-dot-open":!e,"icon-checkmark":e,"text-success":e}},controllerAppRoute(){if(this.controllerApp){const e=this.controllerApp.spec?.chart?.metadata,t={[ae.CU]:e?.annotations?.[A.W8.NAMESPACE],[ae.o_]:e?.annotations?.[A.W8.RELEASE_NAME],[ae.xv]:e?.annotations?.["catalog.cattle.io/upstream-version"],[ae.NO]:e?.annotations?.[A.W8.SOURCE_REPO_NAME],[ae.Eo]:e?.annotations?.[A.W8.SOURCE_REPO_TYPE],[ae.RX]:e?.name};this.$router.push({name:"c-cluster-apps-charts-install",params:{cluster:this.currentCluster?.id||"_"},query:t})}}}},ie=(r(82142),r(47433));const le=(0,ie.A)(ne,[["render",oe],["__scopeId","data-v-7139a8b0"]]);var se=le;w().extend(E());var ce={props:{resource:{type:String,default:()=>""},relatedPolicies:{type:Array,default:()=>[]},policy:{type:Object,default:()=>{}}},components:{BadgeState:T.j,Banner:V.l,Loading:R.A,SortableTable:P.A,TraceChecklist:se},mixins:[N.A],async fetch(){const e=[S.W8.APP,S.W8.CLUSTER_REPO,S.YV],t=[];for(const r of e)this.$store.getters["cluster/canList"](r)&&t.push(this.$fetchType(r));if(await(0,_.kR)(t),this.jaegerQuerySvc){const e={store:this.$store,queryService:this.jaegerQuerySvc,resource:this.resource,relatedPolicies:null,policy:null};this.resource===B.$v.POLICY_SERVER?e.relatedPolicies=this.relatedPolicies:e.policy=this.policy,this.specificValidations=await(0,D.lq)(e)}this.controllerApp&&await this.controllerApp.fetchValues(!0)},data(){return{MODE_MAP:B.lN,TRACE_HEADERS:O.Tc,OPERATION_MAP:B.bq,specificValidations:null,outdatedTelemetrySpec:!1,unsupportedTelemetrySpec:!1,incompleteTelemetrySpec:!1}},computed:{...(0,g.L8)(["currentCluster"]),...(0,g.L8)({charts:"catalog/charts",refreshingCharts:"kubewarden/refreshingCharts"}),allApps(){return this.$store.getters["cluster/all"](S.W8.APP)},allServices(){return this.$store.getters["cluster/all"](S.YV)},controllerApp(){return this.allApps?.find((e=>e?.spec?.chart?.metadata?.name===B.j6.CONTROLLER))},controllerChart(){return this.charts?.find((e=>e?.chartName===B.j6.CONTROLLER))},groupField(){return this.isPolicyServer?"policy_id":null},isPolicyServer(){return this.resource===B.$v.POLICY_SERVER},emptyPolicies(){return this.resource===B.$v.POLICY_SERVER?b()(this.relatedPolicies):b()(this.policy)},emptyTraces(){return b()(this.filteredValidations)},emptyTracesLabel(){return this.resource===B.$v.POLICY_SERVER?"kubewarden.tracing.noRelatedTraces":"kubewarden.tracing.noTraces"},rowsPerPage(){return this.isPolicyServer?40:20},tracingConfiguration(){if(!this.controllerApp)return null;const e=this.controllerApp?.spec?.chart?.metadata?.version,t=this.controllerApp?.values?.telemetry;if(v().gte(e,"4.0.0-0")){const e=void 0===t?.tracing||"boolean"===typeof t?.tracing,r=!!t?.sidecar?.tracing?.jaeger?.endpoint;return"custom"===t?.mode?(this.handleTracingChecklist("unsupportedTelemetrySpec",!0),null):e?!0!==t?.tracing||r?!0!==t?.tracing?null:t?.sidecar?.tracing:(this.handleTracingChecklist("incompleteTelemetrySpec",!0),null):(this.handleTracingChecklist("outdatedTelemetrySpec",!0),null)}return t?.tracing?.enabled},jaegerServices(){return this.allServices?.filter((e=>"jaeger"===e?.metadata?.labels?.["app.kubernetes.io/part-of"]))},jaegerQuerySvc(){return b()(this.jaegerServices)?null:this.jaegerServices.find((e=>{const t=e?.spec?.ports;if(t.length)return t.find((e=>16685===e.port||16686===e.port))}))},openTelemetryServices(){return this.allServices?.filter((e=>"opentelemetry-operator"===e?.metadata?.labels?.[A.pS.MANAGED_NAME]))},openTelSvc(){return b()(this.openTelemetryServices)?null:this.openTelemetryServices.find((e=>{const t=e?.spec?.ports;if(t.length)return t.find((e=>8080===e.port))}))},showChecklist(){return!this.openTelSvc||!this.jaegerQuerySvc||!this.tracingConfiguration},showTable(){return!this.emptyPolicies&&!this.showChecklist&&!this.emptyTraces},filteredValidations(){return b()(this.specificValidations)?[]:this.specificValidations.flatMap((e=>this.currentCluster?.id===e.cluster?e.traces:[]))}},methods:{modeColor(e){return this.MODE_MAP[e]},opColor(e){return this.OPERATION_MAP[e]},formatTime(e){return w()(e/1e3)},duration(e){return Q(e)},handleTracingChecklist(e,t){this[e]=t}}};r(88492);const de=(0,ie.A)(ce,[["render",h],["__scopeId","data-v-01307b5c"]]);var pe=de},51568:function(e,t,r){var o=r(25552);o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[e.id,o,""]]),o.locals&&(e.exports=o.locals);var a=r(74825).A;a("8f0df8c6",o,!0,{sourceMap:!1,shadowMode:!1})},63922:function(e,t,r){"use strict";r.d(t,{A:function(){return le}});var o=r(9274);const a={key:1};function n(e,t,r,n,i,l){const s=(0,o.resolveComponent)("Loading"),c=(0,o.resolveComponent)("MetricsChecklist"),d=(0,o.resolveComponent)("Banner"),p=(0,o.resolveComponent)("DashboardMetrics");return e.$fetchState.pending?((0,o.openBlock)(),(0,o.createBlock)(s,{key:0,mode:"relative"})):((0,o.openBlock)(),(0,o.createElementBlock)("div",a,[l.showChecklist?((0,o.openBlock)(),(0,o.createBlock)(c,{key:0,"cattle-dashboard-ns":l.cattleDashboardNs,"conflicting-grafana-dashboards":l.conflictingGrafanaDashboards,"controller-app":l.controllerApp,"controller-chart":l.controllerChart,"kubewarden-service-monitor":l.kubewardenServiceMonitor,"kubewarden-dashboards":l.kubewardenGrafanaDashboards,"metrics-configuration":l.metricsConfiguration,"monitoring-app":l.monitoringApp,"monitoring-chart":l.monitoringChart,"open-tel-svc":l.openTelSvc,"policy-obj":r.policyObj,"policy-server-obj":r.policyServerObj,"outdated-telemetry-spec":i.outdatedTelemetrySpec,"unsupported-telemetry-spec":i.unsupportedTelemetrySpec,onUpdateServiceMonitors:l.updateServiceMonitors},null,8,["cattle-dashboard-ns","conflicting-grafana-dashboards","controller-app","controller-chart","kubewarden-service-monitor","kubewarden-dashboards","metrics-configuration","monitoring-app","monitoring-chart","open-tel-svc","policy-obj","policy-server-obj","outdated-telemetry-spec","unsupported-telemetry-spec","onUpdateServiceMonitors"])):(0,o.createCommentVNode)("",!0),l.showChecklist?(0,o.createCommentVNode)("",!0):((0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,{key:1},[l.monitoringApp&&!i.metricsProxy?((0,o.openBlock)(),(0,o.createBlock)(d,{key:0,color:"error",label:e.t("kubewarden.monitoring.warning.noProxy")},null,8,["label"])):(0,o.createCommentVNode)("",!0),i.metricsProxy&&r.active?((0,o.openBlock)(),(0,o.createBlock)(p,{key:1,"data-testid":"kw-ps-metrics-dashboard","detail-url":i.metricsProxy,"summary-url":i.metricsProxy,vars:{policy_name:l.policyName},"graph-height":"825px"},null,8,["detail-url","summary-url","vars"])):(0,o.createCommentVNode)("",!0)],64))]))}var i=r(65359),l=r(3514),s=r.n(l),c=r(12784),d=r.n(c),p=r(2722),u=r.n(p),m=r(35664),h=r(2841),g=r(97348),y=r(83416),b=r(88339),f=r(1804),v=r(83030),k=r(84409),w=r(9980),C=r(79442),E=r(63875),S=r(67541);async function A(e){const{store:t,type:r}=e;try{const e=await N(t);if(!s()(e)){const t=`/api/v1/namespaces/${e.metadata.namespace}/services`,o=`/http:${e.metadata.name}:80/proxy`,a=`/d/${r}?orgId=1&kiosk`;return t+o+a}}catch(o){(0,E.q)({error:o,store:t,type:"warning"})}return null}async function N(e){try{return await e.dispatch("cluster/find",{type:m.YV,id:"cattle-monitoring-system/rancher-monitoring-grafana"},{root:!0})}catch(t){(0,E.q)({error:t,store:e,type:"warning"})}}async function _(e){try{return await e.dispatch("cluster/findMatching",{type:m.K5,selector:"kubewarden/part-of=cattle-kubewarden-system"})}catch(t){(0,E.q)({error:t,store:e,type:"warning"})}}async function T(e){const{store:t,monitoringApp:o,controllerApp:a}=e;if(o&&a){const e=Object.values(C.YR);for(const i of e){const e=await r(9551)(`./${i}.json`),l=`${i}.json`,s=await _(t);if(s&&s?.metadata?.name===i)return;const c={[C.kl.DASHBOARD]:i,[C.kl.PART_OF]:a.metadata.namespace,[C.kl.APP]:"rancher-monitoring-grafana",[C.kl.GRAFANA_DASHBOARD]:"1","app.kubernetes.io/instance":o.metadata.name},d={[C.tQ.NAME]:o.metadata.name,[C.tQ.NAMESPACE]:o.metadata.namespace},p=await t.dispatch("cluster/create",{type:m.K5,metadata:{annotations:d,labels:c,name:i,namespace:"cattle-dashboards"},data:{[l]:JSON.stringify(e)}});try{await p.save()}catch(n){(0,E.q)({error:n,store:t})}}}}function V(e){const{policyObj:t,policyServerObj:r,allServiceMonitors:o}=e;if(!s()(o)){const e=t?t.spec?.policyServer:r?.id;return o?.find((t=>t?.spec?.selector?.matchLabels?.["app"]===`kubewarden-policy-server-${e}`))}}async function R(e){const{store:t,policyObj:r,policyServerObj:o,controllerNs:a,serviceMonitor:n}=e;if(t.getters["cluster/schemaFor"](m.Rp.SERVICEMONITOR)){const e=r?r.spec?.policyServer:o?.id,l={kind:"ServiceMonitor",type:m.Rp.SERVICEMONITOR,metadata:{name:e,namespace:a},spec:{endpoints:[{interval:"10s",port:"metrics"}],namespaceSelector:{matchNames:[a]},selector:{matchLabels:{app:`kubewarden-policy-server-${e}`}}}};if(!n){const e=await t.dispatch("cluster/create",l);try{await e.save()}catch(i){(0,E.q)({error:i,store:t})}}}}var P=r(74947);const O={class:"checklist__container"},B={class:"checklist__prereq mb-20"},D={class:"mt-20 mb-20"},x={class:"checklist__step mb-20","data-testid":"kw-monitoring-checklist-step-open-tel"},M={class:"checklist__step mb-20","data-testid":"kw-monitoring-checklist-step-monitoring-app"},j={class:"checklist__config"},$={p:""},L=["disabled"],I={class:"checklist__step mb-20","data-testid":"kw-monitoring-checklist-step-service-monitor-map"},q={class:"checklist__config"},Y={p:""},G={class:"checklist__step mb-20","data-testid":"kw-monitoring-checklist-step-config-map"},U={class:"checklist__config"},W={p:""},z={class:"conflicting-banner"},Q={class:"checklist__step mb-20","data-testid":"kw-monitoring-checklist-step-controller-config"},K={class:"checklist__config"},F={p:""},H=["disabled"];function J(e,t,r,a,n,i){const l=(0,o.resolveComponent)("Banner"),s=(0,o.resolveComponent)("AsyncButton"),c=(0,o.resolveComponent)("router-link"),d=(0,o.resolveDirective)("clean-html"),p=(0,o.resolveDirective)("clean-tooltip");return(0,o.openBlock)(),(0,o.createElementBlock)("div",O,[(0,o.createElementVNode)("div",B,[(0,o.createElementVNode)("h2",null,(0,o.toDisplayString)(e.t("kubewarden.monitoring.prerequisites.label")),1),(0,o.createElementVNode)("p",null,(0,o.toDisplayString)(e.t("kubewarden.monitoring.prerequisites.description")),1)]),(0,o.createVNode)(l,{color:"warning",label:e.t("kubewarden.monitoring.prerequisites.warning")},null,8,["label"]),(0,o.createElementVNode)("div",D,[(0,o.createElementVNode)("div",x,[(0,o.createElementVNode)("i",{class:(0,o.normalizeClass)(["icon mr-10",i.badgeIcon(r.openTelSvc)])},null,2),(0,o.withDirectives)((0,o.createElementVNode)("p",null,null,512),[[d,e.t("kubewarden.tracing.openTelemetry",{},!0)]])]),(0,o.createElementVNode)("div",M,[(0,o.createElementVNode)("i",{class:(0,o.normalizeClass)(["icon mr-10",i.badgeIcon(r.monitoringApp)])},null,2),(0,o.createElementVNode)("div",j,[(0,o.withDirectives)((0,o.createElementVNode)("p",$,null,512),[[d,e.t("kubewarden.monitoring.prerequisites.monitoringApp.label",{},!0)]]),r.monitoringApp?(0,o.createCommentVNode)("",!0):(0,o.withDirectives)(((0,o.openBlock)(),(0,o.createElementBlock)("button",{key:0,"data-testid":"kw-monitoring-checklist-step-config-button",class:"btn role-primary ml-10",disabled:!r.monitoringChart,onClick:t[0]||(t[0]=e=>i.monitoringAppRoute())},[(0,o.createTextVNode)((0,o.toDisplayString)(i.monitoringChartLink),1)],8,L)),[[p,i.monitoringLinkTooltip]])])]),(0,o.createElementVNode)("div",I,[(0,o.createElementVNode)("i",{class:(0,o.normalizeClass)(["icon mr-10",i.badgeIcon(r.kubewardenServiceMonitor)])},null,2),(0,o.createElementVNode)("div",q,[(0,o.withDirectives)((0,o.createElementVNode)("p",Y,null,512),[[d,e.t("kubewarden.monitoring.prerequisites.serviceMonitor.label",{},!0)]]),r.kubewardenServiceMonitor?(0,o.createCommentVNode)("",!0):(0,o.withDirectives)(((0,o.openBlock)(),(0,o.createBlock)(s,{key:0,"data-testid":"kw-monitoring-checklist-step-service-monitor-button",mode:"serviceMonitor",class:"ml-10",disabled:i.serviceMonitorButtonDisabled,onClick:i.addServiceMonitor},null,8,["disabled","onClick"])),[[p,i.serviceMonitorsTooltip]])])]),(0,o.createElementVNode)("div",G,[(0,o.createElementVNode)("i",{class:(0,o.normalizeClass)(["icon mr-10",i.badgeIcon(i.hasKubewardenDashboards)])},null,2),(0,o.createElementVNode)("div",U,[(0,o.withDirectives)((0,o.createElementVNode)("p",W,null,512),[[d,e.t("kubewarden.monitoring.prerequisites.configMap.label",{},!0)]]),i.hasKubewardenDashboards?(0,o.createCommentVNode)("",!0):(0,o.withDirectives)(((0,o.openBlock)(),(0,o.createBlock)(s,{key:0,"data-testid":"kw-monitoring-checklist-step-config-map-button",mode:"grafanaDashboard",class:"ml-10",disabled:i.dashboardButtonDisabled,onClick:i.addDashboards},null,8,["disabled","onClick"])),[[p,i.dashboardsTooltip]])])]),i.showConflictingDashboardsBanner?((0,o.openBlock)(),(0,o.createBlock)(l,{key:0,color:"error"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",z,[(0,o.createElementVNode)("p",null,(0,o.toDisplayString)(e.t("kubewarden.monitoring.prerequisites.configMap.conflictingDashboardsBanner",{count:r.conflictingGrafanaDashboards.length},!0)),1),((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(r.conflictingGrafanaDashboards,(e=>((0,o.openBlock)(),(0,o.createBlock)(c,{key:e.metadata.name,to:e.detailLocation,class:"text-bold"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(e.metadata.name),1)])),_:2},1032,["to"])))),128))])])),_:1})):(0,o.createCommentVNode)("",!0),(0,o.createElementVNode)("div",null,[r.outdatedTelemetrySpec?((0,o.openBlock)(),(0,o.createBlock)(l,{key:0,color:"error",label:e.t("kubewarden.monitoring.prerequisites.outdated")},null,8,["label"])):(0,o.createCommentVNode)("",!0),r.unsupportedTelemetrySpec?((0,o.openBlock)(),(0,o.createBlock)(l,{key:1,color:"error",label:e.t("kubewarden.monitoring.prerequisites.unsupported")},null,8,["label"])):(0,o.createCommentVNode)("",!0)]),(0,o.createElementVNode)("div",Q,[(0,o.createElementVNode)("i",{class:(0,o.normalizeClass)(["icon mr-10",i.badgeIcon(r.metricsConfiguration)])},null,2),(0,o.createElementVNode)("div",K,[(0,o.withDirectives)((0,o.createElementVNode)("p",F,null,512),[[d,e.t("kubewarden.monitoring.prerequisites.controllerConfig.label",{},!0)]]),r.metricsConfiguration?(0,o.createCommentVNode)("",!0):(0,o.withDirectives)(((0,o.openBlock)(),(0,o.createElementBlock)("button",{key:0,"data-testid":"kw-monitoring-checklist-step-config-button",class:"btn role-primary ml-10",disabled:i.controllerLinkDisabled,onClick:t[1]||(t[1]=e=>i.controllerAppRoute())},[(0,o.createTextVNode)((0,o.toDisplayString)(e.t("kubewarden.monitoring.prerequisites.controllerConfig.button")),1)],8,H)),[[p,i.controllerLinkTooltip]])])])])])}var X=r(14220),Z=r(5813),ee={props:{cattleDashboardNs:{type:Object,default:null},conflictingGrafanaDashboards:{type:Array,default:null},controllerApp:{type:Object,default:null},controllerChart:{type:Object,default:null},kubewardenServiceMonitor:{type:Object,default:null},kubewardenDashboards:{type:Array,default:null},metricsConfiguration:{type:Object,default:null},monitoringApp:{type:Object,default:null},monitoringChart:{type:Object,default:null},openTelSvc:{type:Object,default:null},policyObj:{type:Object,default:null},policyServerObj:{type:Object,default:null},outdatedTelemetrySpec:{type:Boolean,default:!1},unsupportedTelemetrySpec:{type:Boolean,default:!1}},components:{AsyncButton:Z.A,Banner:w.l},computed:{...(0,i.L8)(["currentCluster"]),...(0,i.L8)({t:"i18n/t"}),controllerLinkDisabled(){return!this.openTelSvc||!this.monitoringApp||!this.hasKubewardenDashboards||!this.controllerChart||!this.controllerApp},controllerLinkTooltip(){return this.controllerLinkDisabled?this.t("kubewarden.monitoring.prerequisites.tooltips.prerequisites"):this.controllerChart?null:this.t("kubewarden.monitoring.prerequisites.tooltips.chartError",{chart:"Kubewarden Controller"},!0)},dashboardsTooltip(){return this.monitoringApp?this.monitoringApp&&s()(this.cattleDashboardNs)?this.t("kubewarden.monitoring.prerequisites.tooltips.nsNotFound"):null:this.t("kubewarden.monitoring.prerequisites.tooltips.appNotInstalled",{app:"Rancher Monitoring"},!0)},dashboardButtonDisabled(){return!this.monitoringApp||s()(this.cattleDashboardNs)||!this.hasKubewardenDashboards&&!!this.conflictingGrafanaDashboards.length},hasKubewardenDashboards(){return!s()(this.kubewardenDashboards)},monitoringChartLink(){return this.monitoringApp?this.t("kubewarden.monitoring.prerequisites.monitoringApp.edit"):this.t("kubewarden.monitoring.prerequisites.monitoringApp.install")},monitoringLinkTooltip(){return this.monitoringChart?null:this.t("kubewarden.monitoring.prerequisites.tooltips.chartError",{chart:"Rancher Monitoring"},!0)},serviceMonitorButtonDisabled(){return!this.controllerApp||!this.monitoringApp},serviceMonitorsTooltip(){return this.monitoringApp?!this.kubewardenServiceMonitor&&this.controllerApp?this.t("kubewarden.monitoring.prerequisites.tooltips.monitorsNotFound",{namespace:this.controllerApp.metadata?.namespace},!0):null:this.t("kubewarden.monitoring.prerequisites.tooltips.prerequisites")},showConflictingDashboardsBanner(){return!this.hasKubewardenDashboards&&!s()(this.conflictingGrafanaDashboards)}},methods:{async addDashboards(e){try{await T({store:this.$store,monitoringApp:this.monitoringApp,controllerApp:this.controllerApp}),e(!0)}catch(t){(0,E.q)({error:t,store:this.$store}),e(!1)}},async addServiceMonitor(e){try{await R({store:this.$store,policyObj:this.policyObj,policyServerObj:this.policyServerObj,controllerNs:this.controllerApp?.metadata?.namespace,serviceMonitor:this.kubewardenServiceMonitor}),this.$emit("updateServiceMonitors"),e(!0)}catch(t){(0,E.q)({error:t,store:this.$store}),e(!1)}},badgeIcon(e){if(Array.isArray(e)){const t=s()(e);return{"icon-dot-open":t,"icon-checkmark":!t,"text-success":!t}}return{"icon-dot-open":!e,"icon-checkmark":e,"text-success":e}},monitoringAppRoute(){if(!this.monitoringApp&&this.monitoringChart&&this.monitoringChart.goToInstall(),this.monitoringApp){const e={[X.CU]:this.monitoringApp.metadata?.namespace,[X.o_]:this.monitoringApp.metadata?.name,[X.xv]:this.monitoringApp.spec?.chart?.metadata?.version,[X.NO]:this.monitoringApp.spec?.chart?.metadata?.annotations?.[h.W8.SOURCE_REPO_NAME],[X.Eo]:this.monitoringApp.spec?.chart?.metadata?.annotations?.[h.W8.SOURCE_REPO_TYPE],[X.RX]:this.monitoringApp.spec?.chart?.metadata?.name};this.$router.push({name:"c-cluster-apps-charts-install",params:{cluster:this.currentCluster?.id||"_"},query:e})}},controllerAppRoute(){if(this.controllerApp){const e=this.controllerApp.spec?.chart?.metadata,t={[X.CU]:e?.annotations?.[h.W8.NAMESPACE],[X.o_]:e?.annotations?.[h.W8.RELEASE_NAME],[X.xv]:e?.annotations?.["catalog.cattle.io/upstream-version"],[X.NO]:e?.annotations?.[h.W8.SOURCE_REPO_NAME],[X.Eo]:e?.annotations?.[h.W8.SOURCE_REPO_TYPE],[X.RX]:e?.name};this.$router.push({name:"c-cluster-apps-charts-install",params:{cluster:this.currentCluster?.id||"_"},query:t})}}}},te=(r(51568),r(47433));const re=(0,te.A)(ee,[["render",J],["__scopeId","data-v-9013874c"]]);var oe=re,ae=r(4364),ne={props:{active:{type:Boolean,default:null},resource:{type:String,default:null},policyObj:{type:Object,default:null},policyServerObj:{type:Object,default:null}},components:{Banner:w.l,DashboardMetrics:v.A,Loading:k.A,MetricsChecklist:oe},mixins:[f.A],async fetch(){this.debouncedRefreshCharts=d()(((e=!1)=>{(0,S.Xj)({store:this.$store,chartName:"rancher-monitoring",init:e})}),500);const e=[{name:m.W8.APP,property:this.allApps},{name:m.W8.CLUSTER_REPO,property:this.allRepos},{name:m.K5,property:this.allConfigMaps},{name:C.$v.POLICY_SERVER,property:this.allPolicyServers},{name:m.Rp.SERVICEMONITOR,property:this.allServiceMonitors},{name:m.CU,property:this.allNamespaces},{name:m.YV,property:this.allServices}],t=[];for(const o of e)s()(o.property)&&this.$store.getters["cluster/canList"](o.name)&&t.push(this.$fetchType(o.name));if(await(0,b.kR)(t),this.showChecklist&&!this.monitoringChart&&this.debouncedRefreshCharts(!0),this.monitoringStatus.installed)try{this.metricsProxy=await A({store:this.$store,type:this.METRICS_TYPE}),this.metricsProxy&&(this.metricsService=await(0,g.no)("v2",this.$store,this.currentCluster?.id,this.metricsProxy))}catch(r){const e={_statusText:"Error",message:`Error fetching Grafana Service: ${r}`};(0,E.q)({error:e,store:this.$store})}this.controllerApp&&await this.controllerApp.fetchValues(!0)},data(){const e=this.resource===C.$v.POLICY_SERVER?C.YR.POLICY_SERVER:C.YR.POLICY;return{METRICS_TYPE:e,[m.W8.APP]:null,[m.W8.CLUSTER_REPO]:null,[m.K5]:null,[m.Rp.SERVICEMONITOR]:null,[m.YV]:null,metricsProxy:null,metricsService:null,debouncedRefreshCharts:null,outdatedTelemetrySpec:!1,unsupportedTelemetrySpec:!1}},watch:{async grafanaService(){this.metricsProxy||(this.metricsProxy=await A({store:this.$store,type:this.METRICS_TYPE}),this.metricsProxy&&(this.metricsService=await(0,g.no)("v2",this.$store,this.currentCluster?.id,this.metricsProxy)))}},computed:{...(0,i.L8)(["currentCluster","productId"]),...(0,i.L8)({charts:"catalog/charts"}),...(0,y.dO)(),policyName(){return(0,P.OJ)(this.policyObj)},allApps(){return this.$store.getters["cluster/all"](m.W8.APP)},allRepos(){return this.$store.getters["cluster/all"](m.W8.CLUSTER_REPO)},allConfigMaps(){return this.$store.getters["cluster/all"](m.K5)},allNamespaces(){return this.$store.getters["cluster/all"](m.CU)},allPolicyServers(){return this.$store.getters["cluster/all"](C.$v.POLICY_SERVER)},allServiceMonitors(){return this.$store.getters["cluster/all"](m.Rp.SERVICEMONITOR)},allServices(){return this.$store.getters["cluster/all"](m.YV)},cattleDashboardNs(){return this.allNamespaces?.find((e=>"cattle-dashboards"===e?.metadata?.name))},conflictingGrafanaDashboards(){return this.allConfigMaps?.filter((e=>{const t=e?.metadata?.name;if(t)return t===C.YR.POLICY_SERVER||t===C.YR.POLICY}))},controllerApp(){return this.allApps?.find((e=>e?.spec?.chart?.metadata?.name===C.j6.CONTROLLER))},controllerChart(){return this.charts?.find((e=>e.chartName===C.j6.CONTROLLER))},grafanaService(){const e=this.allServices?.filter((e=>"rancher-monitoring"===e?.metadata?.labels?.["app.kubernetes.io/instance"]));return e?.find((e=>"grafana"===e?.metadata?.labels?.["app.kubernetes.io/name"]))},kubewardenGrafanaDashboards(){return this.allConfigMaps?.filter((e=>e?.metadata?.labels?.[C.kl.DASHBOARD]))},kubewardenServiceMonitor(){return V({policyObj:this.policyObj,policyServerObj:this.policyServerObj,controllerNs:this.controllerApp?.metadata?.namespace,allServiceMonitors:this.allServiceMonitors})},metricsConfiguration(){if(!this.controllerApp)return ae.log("# 0"),null;const e=this.controllerApp?.spec?.chart?.metadata?.version,t=this.controllerApp?.values?.telemetry;if(u().gte(e,"4.0.0-0")){const e=void 0===t?.metrics||"boolean"===typeof t?.metrics;return"custom"===t?.mode?(this.handleMetricsChecklist("unsupportedTelemetrySpec",!0),null):e?!0!==t?.metrics?null:t?.metrics:(this.handleMetricsChecklist("outdatedTelemetrySpec",!0),null)}return t?.metrics?.enabled},monitoringApp(){return this.allApps?.find((e=>"rancher-monitoring"===e?.spec?.chart?.metadata?.name))},monitoringChart(){return this.charts?.find((e=>"rancher-monitoring"===e.chartName))},openTelemetryServices(){return this.allServices?this.allServices.filter((e=>"opentelemetry-operator"===e?.metadata?.labels?.[h.pS.MANAGED_NAME])):null},openTelSvc(){return s()(this.openTelemetryServices)?null:this.openTelemetryServices.find((e=>{const t=e?.spec?.ports;if(t.length)return t.find((e=>8080===e.port))}))},policyServerSvcs(){if(!s()(this.allPolicyServers)){const e=this.allPolicyServers.map((e=>e?.metadata?.name)),t=[];for(const r of e)t.push(this.allServices?.find((e=>e?.metadata?.labels?.app===`kubewarden-policy-server-${r}`)));return t}return null},showChecklist(){const e=!s()(this.kubewardenGrafanaDashboards);return!this.openTelSvc||!this.monitoringApp||!this.kubewardenServiceMonitor||!this.metricsConfiguration||!e}},methods:{async updateServiceMonitors(){await this.$fetchType(m.Rp.SERVICEMONITOR)},handleMetricsChecklist(e,t){this[e]=t}}};const ie=(0,te.A)(ne,[["render",n]]);var le=ie},70540:function(e,t,r){"use strict";r.r(t);var o=r(36758),a=r.n(o),n=r(40935),i=r.n(n),l=i()(a());l.push([e.id,".policy-table-container[data-v-01307b5c]{display:flex;flex-direction:column;gap:1rem}.filter[data-v-01307b5c]{display:flex;flex-direction:row;justify-content:flex-end;align-self:flex-end;align-items:center}.filter[data-v-01307b5c]>*{margin:10px;max-width:33%}.filter[data-v-01307b5c]>:first-child{margin-left:0}.filter[data-v-01307b5c]>:last-child{margin-right:0}.filter__category[data-v-01307b5c]{min-width:200px;height:unset}.filter__reset[data-v-01307b5c],.filter__search[data-v-01307b5c]{height:61px}",""]),t["default"]=l},74947:function(e,t,r){"use strict";r.d(t,{OJ:function(){return d},lq:function(){return c}});var o=r(3514),a=r.n(o),n=r(79442);function i(e,t){const r=e?.links["view"],o=r.lastIndexOf("/");return l(r.slice(0,o),"http",e?.metadata.name,t)}function l(e,t,r,o,a){const n=(t?`${encodeURIComponent(t)}:`:"")+encodeURIComponent(r)+(o?`:${encodeURIComponent(o)}`:""),i=`/${(a||"").replace(/^\/+/g,"")}`,l=e.replace(/\/+$/g,""),s=`${l}/${n}/proxy${i}`;return s}var s=r(4364);async function c(e){const{store:t,queryService:r,resource:o,relatedPolicies:n,policy:l,time:c}=e;try{const e=i(r,16686),s=[];if(a()(n)){if(!l)throw new Error("Policy is undefined");s.push(p(t,e,l,c))}else n?.forEach((r=>{const o=p(t,e,r,c);o&&s.push(o)}));let d=await Promise.all(s);return d=d.flatMap((e=>e?.data)),u(t,d,o,n,l)}catch(d){s.warn(`Error fetching Jaeger traces: ${d}`)}return null}function d(e){let t=null;switch(e?.kind){case"ClusterAdmissionPolicy":t=`clusterwide-${e?.metadata?.name}`;break;case"AdmissionPolicy":t=`namespaced-${e?.metadata?.namespace}-${e?.metadata?.name}`;break;default:break}return t}function p(e,t,r,o){let a=null;const n=d(r),i=o||"2d",l=`lookback=${i}&tags={"policy_id"%3A"${n}"}`;a=`api/traces?service=kubewarden-policy-server&operation=validation&${l}`;const s=`${t+a}`;return e.dispatch("cluster/request",{url:s})}function u(e,t,r,o,i){const l=e.getters["currentCluster"],s=[];function c(r){const o=d(r);return t.reduce(((t,n)=>{let i={};const s=n.spans.find((e=>"validation"===e.operationName)),c=s?.tags?.find((e=>"policy_id"===e?.key&&e?.value===o));if(c){const e=m(s.tags);i={id:n.traceID,allowed:e.allowed,mode:r.spec.mode,name:e.name,operation:e.operation,kind:e.kind,namespace:e.namespace||null,startTime:s.startTime,duration:s.duration,responseMessage:e.response_message,responseCode:e.response_code,mutated:e.mutated}}return a()(i)||(t.push(i),e.dispatch("kubewarden/updatePolicyTraces",{policyName:r.metadata.name,cluster:l?.id,updatedTrace:i})),t}),[])}if(r===n.$v.POLICY_SERVER)for(const n of o){const e=c(n);a()(e)||s.push({policyName:n.metadata.name,cluster:l?.id,traces:e})}else{const e=c(i);a()(e)||s.push({policyName:i.metadata.name,cluster:l?.id,traces:e})}return s}function m(e){const t={};for(const r of e)switch(r.type){case"string":t[r.key]=r.value;break;case"int64":t[r.key]=parseInt(r.value,10);break;case"float64":t[r.key]=parseFloat(r.value);break;case"bool":t[r.key]="true"===r.value;break;default:t[r.key]=r.value}return t}},82142:function(e,t,r){var o=r(99678);o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[e.id,o,""]]),o.locals&&(e.exports=o.locals);var a=r(74825).A;a("29f75efb",o,!0,{sourceMap:!1,shadowMode:!1})},87782:function(e,t,r){var o=r(88230);o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[e.id,o,""]]),o.locals&&(e.exports=o.locals);var a=r(74825).A;a("f6fddd2e",o,!0,{sourceMap:!1,shadowMode:!1})},88230:function(e,t,r){"use strict";r.r(t);var o=r(36758),a=r.n(o),n=r(40935),i=r.n(n),l=i()(a());l.push([e.id,".relative[data-v-4044d828]{position:relative}.policy__mode[data-v-4044d828]{display:flex;align-items:center}.policy__mode i[data-v-4044d828]{margin-left:5px;font-size:22px;color:var(--warning)}.gauges[data-v-4044d828],.gaugesContainer[data-v-4044d828]{display:flex}.gauges[data-v-4044d828]{justify-content:space-around;flex-wrap:wrap;justify-content:left}.gauges .count-gauge[data-v-4044d828]{width:46%;margin-bottom:10px;flex:initial}.gauges[data-v-4044d828]>*{flex:1;margin-right:1.75%}",""]),t["default"]=l},88492:function(e,t,r){var o=r(70540);o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[e.id,o,""]]),o.locals&&(e.exports=o.locals);var a=r(74825).A;a("50a9f64e",o,!0,{sourceMap:!1,shadowMode:!1})},89977:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return p}});var o=r(9274);function a(e,t,r,a,n,i){const l=(0,o.resolveComponent)("PolicyDetail");return(0,o.openBlock)(),(0,o.createBlock)(l,{value:r.value,mode:r.mode,resource:n.resource},null,8,["value","mode","resource"])}var n=r(14220),i=r(79442),l=r(98618),s={name:"ClusterAdmissionPolicy",props:{mode:{type:String,default:n.YQ},value:{type:Object,required:!0}},components:{PolicyDetail:l.A},data(){return{resource:i.$v.ADMISSION_POLICY}}},c=r(47433);const d=(0,c.A)(s,[["render",a]]);var p=d},98618:function(e,t,r){"use strict";r.d(t,{A:function(){return R}});var o=r(9274);const a={class:"mb-20"};function n(e,t,r,n,i,l){const s=(0,o.resolveComponent)("Markdown"),c=(0,o.resolveComponent)("Tab"),d=(0,o.resolveComponent)("RulesTable"),p=(0,o.resolveComponent)("TraceTable"),u=(0,o.resolveComponent)("MetricsTab"),m=(0,o.resolveComponent)("ResourceTabs");return(0,o.openBlock)(),(0,o.createElementBlock)("div",null,[(0,o.createElementVNode)("div",a,[(0,o.createElementVNode)("h3",null,(0,o.toDisplayString)(e.t("namespace.resources")),1)]),(0,o.createVNode)(m,{value:r.value,"data-testid":"kw-policy-detail-tabs",mode:r.mode,"need-related":l.hasRelationships},{default:(0,o.withCtx)((()=>[i.policyReadme?((0,o.openBlock)(),(0,o.createBlock)(c,{key:0,name:"policy-readme",label:"Readme",weight:99},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(s,{value:i.policyReadme,"onUpdate:value":t[0]||(t[0]=e=>i.policyReadme=e),"data-testid":"kw-policy-detail-readme"},null,8,["value"])])),_:1})):(0,o.createCommentVNode)("",!0),l.hasRules?((0,o.openBlock)(),(0,o.createBlock)(c,{key:1,name:"policy-rules",label:"Rules",weight:98},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(d,{rows:l.rulesRows,"data-testid":"kw-policy-detail-rules-table"},null,8,["rows"])])),_:1})):(0,o.createCommentVNode)("",!0),(0,o.createVNode)(c,{name:"policy-tracing",label:"Tracing",weight:97},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(p,{resource:r.resource,policy:r.value,"data-testid":"kw-policy-detail-trace-table"},null,8,["resource","policy"])])),_:1}),(0,o.createVNode)(c,{name:"policy-metrics",label:"Metrics",weight:96},{default:(0,o.withCtx)((e=>[(0,o.createVNode)(u,{resource:r.resource,"policy-obj":r.value,active:e.active},null,8,["resource","policy-obj","active"])])),_:1})])),_:1},8,["value","mode","need-related"])])}var i=r(65359),l=r(3514),s=r.n(l),c=r(14220),d=r(83416),p=r(91825),u=r(36158),m=r(72551),h=r(49584),g=r(79442),y=r(63922);const b={key:1};function f(e,t,r,a,n,i){const l=(0,o.resolveComponent)("SortableTable"),s=(0,o.resolveComponent)("Banner");return(0,o.openBlock)(),(0,o.createElementBlock)("div",null,[r.rows.length>0?((0,o.openBlock)(),(0,o.createBlock)(l,{key:0,"data-testid":"kw-policy-rules-sortable-table",rows:r.rows,headers:n.RULE_HEADERS,"table-actions":!1,"row-actions":!1,"key-field":"traceID","default-sort-by":"startTime"},{"col:apiGroup":(0,o.withCtx)((({row:e})=>[(0,o.createElementVNode)("td",null,[(0,o.createElementVNode)("span",null,(0,o.toDisplayString)(e.apiGroups||"-"),1)])])),"col:apiVersion":(0,o.withCtx)((({row:e})=>[(0,o.createElementVNode)("td",null,[(0,o.createElementVNode)("span",null,(0,o.toDisplayString)(e.apiVersions||"-"),1)])])),"col:operations":(0,o.withCtx)((({row:e})=>[(0,o.createElementVNode)("td",null,[(0,o.createElementVNode)("span",null,(0,o.toDisplayString)(i.joinColumn(e.operations)),1)])])),"col:resources":(0,o.withCtx)((({row:e})=>[(0,o.createElementVNode)("td",null,[(0,o.createElementVNode)("span",null,(0,o.toDisplayString)(i.joinColumn(e.resources)),1)])])),_:1},8,["rows","headers"])):((0,o.openBlock)(),(0,o.createElementBlock)("div",b,[(0,o.createVNode)(s,{class:"type-banner mb-20 mt-0",color:"warning",label:e.t("kubewarden.policies.noRules")},null,8,["label"])]))])}var v=r(9980),k=r(68150),w=r(65165),C={props:{rows:{type:Array,default:()=>[]}},components:{Banner:v.l,SortableTable:k.A},data(){return{RULE_HEADERS:w.e1}},methods:{joinColumn(e){return e?.join(", ")||""}}},E=r(47433);const S=(0,E.A)(C,[["render",f]]);var A=S,N=r(38958),_=r(4364),T={name:"PolicyDetail",components:{Markdown:u.A,MetricsTab:y.A,ResourceTabs:m.A,RulesTable:A,Tab:h.A,TraceTable:N.A},mixins:[p.A],props:{mode:{type:String,default:c.YQ},resource:{type:String,default:null},value:{type:Object,default:()=>{}}},async mounted(){if(this.value?.metadata?.annotations?.[g.zb])try{const e=await this.value.artifactHubPackageVersion();e&&!e.error&&e.readme&&(this.policyReadme=JSON.parse(JSON.stringify(e.readme)))}catch(e){_.warn(`Unable to fetch artifacthub package: ${e}`)}},data(){return{policyReadme:null}},computed:{...(0,i.L8)(["currentCluster"]),...(0,d.dO)(),dashboardVars(){return{policy_name:`clusterwide-${this.value?.id}`}},hasRelationships(){return!!this.value?.metadata?.relationships},hasRules(){return!s()(this.rulesRows?.[0])},rulesRows(){return this.value?.spec?.rules}}};const V=(0,E.A)(T,[["render",n]]);var R=V},99678:function(e,t,r){"use strict";r.r(t);var o=r(36758),a=r.n(o),n=r(40935),i=r.n(n),l=i()(a());l.push([e.id,".checklist__container[data-v-7139a8b0]{display:flex;justify-content:center;flex-direction:column;border:1px solid var(--border);padding:10px}.checklist__config[data-v-7139a8b0],.checklist__step[data-v-7139a8b0]{display:flex;flex-direction:row;justify-content:flex-start;align-items:center}.checklist__step[data-v-7139a8b0]{min-height:40px}",""]),t["default"]=l}}]);
//# sourceMappingURL=kubewarden-3.1.1-rc.1.umd.min.detail.js.map